// ==UserScript==
// @name            Nova YouTube
// @namespace       https://github.com/raingart/Nova-YouTube-extension/
// @version         0.50.0.1
// @description     Powerful control on YouTube
// @name:en         Nova YouTube

// @author          raingart <raingart+scriptaddons@protonmail.com>
// @license         Apache-2.0
// @icon            https://raw.github.com/raingart/Nova-YouTube-extension/master/icons/48.png

// @homepageURL     https://github.com/raingart/Nova-YouTube-extension
// @supportURL      https://github.com/raingart/Nova-YouTube-extension/issues
// @contributionURL https://www.patreon.com/raingart
// @contributionURL https://www.buymeacoffee.com/raingart
// @contributionURL https://www.paypal.com/donate/?hosted_button_id=B44WLWHZ8AGU2

// @domain          youtube.com
// @include         http*://www.youtube.com/*
// @include         http*://m.youtube.com/*
// @include         http*://*.youtube-nocookie.com/embed/*
// @include         http*://youtube.googleapis.com/embed/*
// @include         http*://raingart.github.io/options.html*
// @include         http*://raingart.github.io/nova/*

// @exclude         http*://*.youtube.com/*.xml*
// @exclude         http*://*.youtube.com/error*
// @exclude         http*://music.youtube.com/*
// @exclude         http*://accounts.youtube.com/*
// @exclude         http*://studio.youtube.com/*
// @exclude         http*://*.youtube.com/redirect?*
// @exclude         http*://*.youtubetranscript.com/*

// @grant           GM_getResourceText
// @grant           GM_getResourceURL
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           GM_registerMenuCommand
// @grant           GM_notification
// @grant           GM_openInTab
// @grant           unsafeWindow

// @run-at          document-start

// @compatible      chrome >=80 Violentmonkey,Tampermonkey
// @compatible      firefox >=74 Tampermonkey
// ==/UserScript==
"undefined"==typeof GM_info&&alert("Direct Chromium is not supported now"),"MutationObserver"in window||errorAlert("MutationObserver not supported");try{document}catch(e){errorAlert("Your browser does not support chaining operator")}switch(GM_info.scriptHandler){case"Tampermonkey":case"Violentmonkey":case"ScriptCat":case"OrangeMonkey":break;case"FireMonkey":errorAlert(GM_info.scriptHandler+" incomplete support",!1);break;case"Greasemonkey":errorAlert(GM_info.scriptHandler+" is not supported");break;case"Stay":errorAlert(GM_info.scriptHandler+" is not tested!\nPlease inform the author about the working status");break;default:"function"!=typeof GM_getValue&&errorAlert("Your "+GM_info.scriptHandler+" does not support/no access the API being used. Contact the developer")}function errorAlert(e="",t=!0){if(alert(GM_info.script.name+" Error!\n"+e),t)throw GM_info.script.name+" crashed!\n"+e}window.nova_plugins=[],window.nova_plugins.push({id:"comments-visibility",title:"Collapse comments section","title:zh":"收起评论区","title:ja":"コメント欄を折りたたむ","title:pl":"Zwiń sekcję komentarzy",run_on_pages:"watch, -mobile",restart_on_location_change:!0,section:"comments",_runtime:e=>{NOVA.collapseElement({selector:"#comments",label:"comments",remove:"disable"==e.comments_visibility_mode})},options:{comments_visibility_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"collapse",value:"hide",selected:!0,"label:pl":"zwiń"},{label:"remove",value:"disable","label:pl":"usuń"}]}}}),window.nova_plugins.push({id:"square-avatars",title:"Square avatars","title:zh":"方形头像","title:ja":"正方形のアバター","title:pl":"Kwadratowe awatary",run_on_pages:"*, -live_chat",section:"comments",desc:"Make user images squared","desc:zh":"方形用户形象","desc:ja":"ユーザー画像を二乗する","desc:pl":"Awatary użytkowniów będą kwadratowe",_runtime:e=>{NOVA.css.push(["yt-img-shadow",".ytp-title-channel-logo","#player .ytp-title-channel","ytm-profile-icon","#ytd-player.ytd-watch-flexy","a.ytd-thumbnail","#search .ytd-searchbox"].join(",\n")+" {\nborder-radius: 0 !important;\n}\nhtml {\n--yt-button-border-radius: 0;\n}"),NOVA.waitUntil((()=>{if(window.yt&&(obj=yt?.config_?.EXPERIMENT_FLAGS)&&Object.keys(obj).length)return yt.config_.EXPERIMENT_FLAGS.web_rounded_thumbnails=!1,!0}),100)}}),window.nova_plugins.push({id:"comments-expand",title:"Expand comments","title:zh":"展开评论","title:ja":"コメントを展開","title:pl":"Rozwiń komentarze",run_on_pages:"watch, -mobile",section:"comments",_runtime:e=>{NOVA.css.push("#expander.ytd-comment-renderer {\noverflow-x: hidden;\n}"),NOVA.watchElements({selectors:["#comments #expander[collapsed] #more:not([hidden])"],attr_mark:"nova-comment-expanded",callback:t=>{const a=()=>t.click(),n=t.closest("#expander[collapsed]");switch(e.comments_expand_mode){case"onhover":n.addEventListener("mouseenter",a,{capture:!0,once:!0});break;case"always":a()}}}),NOVA.watchElements({selectors:["#replies #more-replies button","#replies #expander-contents ytd-continuation-item-renderer button"],attr_mark:"nova-replies-expanded",callback:t=>{const a=()=>t.click();switch(e.comments_view_reply){case"onhover":t.addEventListener("mouseenter",a,{capture:!0,once:!0});break;case"always":a()}}}),NOVA.queryURL.has("lc")&&(NOVA.waitSelector("#comment #linked-comment-badge + #body #expander[collapsed] #more:not([hidden])").then((e=>e.click())),NOVA.waitSelector("ytd-comment-thread-renderer:has(#linked-comment-badge) #replies #more-replies button").then((e=>e.click())))},options:{comments_expand_mode:{_tagName:"select",label:"Expand comment","label:zh":"展开评论","label:ja":"コメントを展開","label:pl":"Rozwiń komentarz",options:[{label:"always",value:"always",selected:!0,"label:zh":"每次","label:ja":"いつも","label:pl":"zawsze"},{label:"on hover",value:"onhover","label:zh":"悬停时","label:ja":"ホバー時に","label:pl":"przy najechaniu"},{label:"disable",value:!1}]},comments_view_reply:{_tagName:"select",label:"Expand reply","label:zh":"展开回复","label:ja":"返信を展開","label:pl":"Rozwiń odpowiedź",options:[{label:"always",value:"always","label:zh":"每次","label:ja":"いつも","label:pl":"zawsze"},{label:"on hover",value:"onhover",selected:!0,"label:zh":"悬停时","label:ja":"ホバー時に","label:pl":"przy najechaniu"},{label:"disable",value:!1}]}}}),window.nova_plugins.push({id:"comments-popup",title:"Comments section in popup","title:zh":"弹出窗口中的评论部分","title:ja":"ポップアップのコメントセクション","title:pl":"Sekcja komentarzy w osobnym oknie",run_on_pages:"watch, -mobile",section:"comments",_runtime:e=>{if("disable"==e.comments_visibility_mode)return;const t="html:not(:fullscreen) #page-manager #comments:not([hidden]):not(:empty)",a="data-counter";NOVA.runOnPageLoad((()=>{"watch"==NOVA.currentPage&&NOVA.waitSelector("ytd-comments-header-renderer #title #count:not(:empty)",{destroy_after_page_leaving:!0}).then((e=>{(count=NOVA.extractAsNum.int(e.textContent))&&document.body.querySelector(t)?.setAttribute(a,NOVA.numberFormat.abbr(count))}))})),NOVA.waitSelector("#masthead-container").then((n=>{NOVA.css.push(`${t},\n${t}:before {\nposition: fixed;\ntop: ${n.offsetHeight||56}px;\nright: 0;\nz-index: ${1+Math.max(getComputedStyle(n||movie_player)["z-index"],601)};\n}\n${t}:not(:hover):before {\ncontent: attr(${a}) " comments ▼";\ncursor: pointer;\nvisibility: visible;\nright: 3em;\npadding: 0 6px 2px;\nline-height: normal;\nfont-family: Roboto, Arial, sans-serif;\nfont-size: 11px;\ncolor: #eee;\nbackground-color: rgba(0, 0, 0, .3);\n}\n${t} {\n${100===e.comments_popup_width?"margin: 0 1%;":""}\npadding: 0 15px;\nbackground-color: var(--yt-spec-brand-background-primary);\nbackground-color: var(--yt-spec-menu-background);\nbackground-color: var(--yt-spec-raised-background);\ncolor: var(--yt-spec-text-primary);;\nborder: 1px solid #333;\nmax-width: ${e.comments_popup_width||40}%;\n${e["square-avatars"]?"":"border-radius: 12px"};\n}\n${t}:not(:hover) {\nvisibility: collapse;\n}\n${t}:hover {\nvisibility: visible !important;\n}\n${t} > #sections > #contents {\noverflow-y: auto;\nmax-height: 82.5vh;\npadding-top: 1em;\n}\n#expander.ytd-comment-renderer {\noverflow-x: hidden;\n}\n${t} #sections {\nmin-width: 500px;\n}\n${t} #contents::-webkit-scrollbar {\nheight: 8px;\nwidth: 10px;\n}\n${t} #contents::-webkit-scrollbar-button {\nheight: 0;\nwidth: 0;\n}\n${t} #contents::-webkit-scrollbar-corner {\nbackground-color: transparent;\n}\n${t} #contents::-webkit-scrollbar-thumb {\nbackground-color: #e1e1e1;\nborder: 0;\nborder-radius: 0;\n}\n${t} #contents::-webkit-scrollbar-thumb {}\n${t} #contents::-webkit-scrollbar-track {\nbackground-color: #666;\nborder: 0;\nborder-radius: 0;\n}\n${t} #contents::-webkit-scrollbar-track:hover {\nbackground-color: #666;\n}\nytd-comments-header-renderer {\nmargin: 10px 0 !important;\n}`),e.comments_popup_hide_textarea&&NOVA.css.push(`${t} > #sections > #contents {\noverflow-y: auto;\nmax-height: 88vh;\nborder-top: 1px solid #333;\npadding-top: 1em;\n}\n${t} #header #simple-box {\ndisplay: none;\n}\nytd-comments-header-renderer #title {\nmargin: 0 !important;\n}`)}))},options:{comments_popup_width:{_tagName:"input",label:"Width","label:zh":"宽度","label:ja":"幅","label:pl":"Szerokość",type:"number",title:"% of the screen width",placeholder:"%",step:5,min:10,max:100,value:40},comments_popup_hide_textarea:{_tagName:"input",label:"Hide textarea","label:zh":"隐藏文本区域","label:ja":"テキストエリアを隠す","label:pl":"Ukryj obszar tekstowy",type:"checkbox"}}}),window.nova_plugins.push({id:"comments-sort",title:"Comments sort","title:zh":"评论排序","title:ja":"コメントの並べ替え","title:pl":"Sortowanie komentarzy",run_on_pages:"watch, -mobile",section:"comments",opt_api_key_warn:!0,desc:"add modal",_runtime:e=>{const t=e["user-api-key"]&&+e.comments_sort_max||250,a="nova-modal-comments",n="modal-content",l="nova-replys",o=l+"-switch",i=NOVA.strToArray(e.comments_sort_blocklist?.toLowerCase());NOVA.waitSelector("#movie_player").then((function(){NOVA.waitSelector(e["comments-popup"]?"#masthead-container":"#comments ytd-comments-header-renderer #title").then((t=>{const l=document.createElement("span");l.setAttribute("data-open-modal",a),l.title="Nova Comments",l.textContent="►",l.addEventListener("click",(()=>{document.body.querySelector(`#${n} table`)||s(),l.dispatchEvent(new CustomEvent(a,{bubbles:!0,detail:"test"}))})),Object.assign(l.style,e["comments-popup"]?{position:"fixed",right:"0",top:"var(--ytd-masthead-height)",visibility:"visible","z-index":1+Math.max(NOVA.css.get(".ytp-chrome-top","z-index"),60),"font-size":"18px"}:{"font-size":"24px","text-decoration":"none",padding:"0 10px","background-color":"transparent",border:"none"},{color:"orange",cursor:"pointer"}),e["comments-popup"]?t.append(l):t.prepend(l),function(){NOVA.css.push(".modal {\n--animation-time: .2s;\nz-index: 9999;\nposition: fixed;\ntop: 0;\nleft: 0;\nbackground-color: rgba(0, 0, 0, .8);\ndisplay: flex;\nalign-items: center;\njustify-content: center;\nwidth: 100%;\nheight: 100%;\nbox-sizing: border-box;\nvisibility: hidden;\nopacity: 0;\n}\n.modal.modal-visible {\nanimation: microModalFadeIn var(--animation-time) cubic-bezier(0, 0, .2, 1);\nbackdrop-filter: blur(1em);\nvisibility: visible;\nopacity: 1;\n}\n@keyframes microModalFadeIn {\nfrom { opacity: 0; }\nto { opacity: 1; }\n}\n.modal-container {\nborder-radius: 4px;\nbackground-color: silver;\nposition: relative;\ndisplay: flex;\nbox-sizing: border-box;\noverflow-y: auto;\nmax-width: 70%;\nmax-height: 100vh;\ntransform: scale(0.9);\ntransition: scale var(--animation-time) ease-out;\n}\n.modal.modal-visible .modal-container {\ntransform: scale(1);\n}\n.modal-close {\nposition: absolute;\ntop: 0;\nright: 0;\ncursor: pointer;\nfont-size: 2em;\npadding: 0 5px;\ntransition: background-color var(--animation-time) ease-out;\n}\n.modal-close:hover {\nbackground-color: #ea3c3c;\n}\n.modal-content {\npadding: 2rem;\n}"),NOVA.css.push(".modal {}\n.modal-container {\nbackground-color: var(--yt-spec-brand-background-primary);\nbackground-color: var(--yt-spec-menu-background);\nbackground-color: var(--yt-spec-raised-background);\ncolor: var(--yt-spec-text-primary);\n}\n.modal-content {\nfont-size: 12px;\n}"),document.body.insertAdjacentHTML("beforeend",`<div id="${a}" class="modal" data-modal>\n<div class="modal-container">\n<div class="modal-close" data-close-modal>✕</div>\n<div class="modal-content" id="${n}"></div>\n</div>\n</div>`);const e="modal-visible";document.getElementById(a).addEventListener("click",(({target:e})=>{e.dispatchEvent(new CustomEvent(a,{bubbles:!0,detail:"test"}))})),document.addEventListener(a,(({target:t})=>{const a=t.hasAttribute("data-modal"),n=t.getAttribute("data-open-modal"),l=t.hasAttribute("data-close-modal");a?t.classList.remove(e):n&&(modal=document.getElementById(n))?modal.classList.add(e):l&&(modal=t.closest("[data-modal]"))&&modal.classList.remove(e)}))}(),NOVA.runOnPageLoad((()=>{"watch"==NOVA.currentPage&&(document.getElementById(n).innerHTML="<pre>Loading data...</pre>")}))}))}));let r=[];function s(l){const o={videoId:NOVA.queryURL.get("v")||movie_player.getVideoData().video_id,part:"snippet,replies",maxResults:Math.min(+e.comments_sort_max||100,100),order:"relevance"};l&&(o.pageToken=l),NOVA.request.API({request:"commentThreads",params:o,api_key:e["user-api-key"]}).then((l=>{if(l?.error)return l.reason?(document.getElementById(a).dispatchEvent(new CustomEvent(a,{bubbles:!0,detail:"test"})),alert(`Error [${l.code}]: ${l.reason}`)):document.getElementById(n).innerHTML=`<pre>Error [${l.code}]: ${l.reason}</pre>\n<pre>${l.error}</pre>`;l?.items?.forEach((e=>{(comment=e.snippet?.topLevelComment?.snippet)?r.push(Object.assign({totalReplyCount:e.snippet.totalReplyCount},{id:e.id},comment,e.replies)):console.warn("API is change",e)})),r.length>=t?c():l?.nextPageToken?(document.getElementById(n).innerHTML=`<pre>Loading: ${r.length+(e["user-api-key"]?"":"/"+t)}</pre>`,s(l?.nextPageToken)):c()}))}function c(){if(!r.length)return document.getElementById(n).innerHTML="<pre>Comments empty</pre>";const t=document.createElement("tbody"),a=(href=document.body.querySelector("#owner #upload-info #channel-name a[href]")?.href)&&new URL(href).pathname;function s(t,a){if(keyword=i?.find((e=>(a&&e?.startsWith("@")?a:t).toLowerCase().includes(e))))return void console.log("comment filter:",`"${keyword}\n"`,t.replace(keyword,`[${keyword}]`));if(e.comments_sort_clear_emoji){if(!(t=(e=>e.replace(/[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2580-\u27BF]|\uD83E[\uDD10-\uDDFF]/g," ").replace(/(?![*#0-9]+)[\p{Emoji}]/gu," ").replace(/([=:;/.()]{2,}|\))$/g," ").replace(/\s{2,}/g," ").replace(/(<br>){3,}/g,"<br><br>").replace(/<a[^>]+><\/a>/g,"").trim())(t)).length)return;if(+e.comments_sort_min_words&&((e="")=>e.trim().split(/\s+/).length)(t)<=+e.comments_sort_min_words)return}return t}r.sort(((e,t)=>t.likeCount-e.likeCount)).forEach((e=>{try{if(!(e.textDisplay=s(e.textDisplay,e.authorDisplayName)))return;if(e.textOriginal.length>100&&e.textOriginal.split(" ")?.some((e=>e.length>100)))return void console.debug("comment istoo long:\n",e.textOriginal);const n=`${l}-${e.id}`,i=document.createElement("tr");let r=0;if(i.className="item",a&&e.authorChannelUrl.includes(a)&&i.classList.add("author"),i.innerHTML=`<td>${e.likeCount}</td>\n<td sorttable_customkey="${e.totalReplyCount}" class="${o}">\n${e.comments?.length?`<a href="https://www.youtube.com/watch?v=${e.videoId}&lc=${e.id}" target="_blank" title="Open comment link">${e.totalReplyCount}</a> <label for="${n}"></label>`:""}</td>\n<td sorttable_customkey="${new Date(e.publishedAt).getTime()}">${NOVA.formatTimeOut.ago(new Date(e.publishedAt))}</td>\n<td>\n<a href="${e.authorChannelUrl}" target="_blank" title="${e.authorDisplayName}">\n<img src="${e.authorProfileImageUrl}" alt="${e.authorDisplayName}" />\n</a>\n</td>\n<td sorttable_customkey="${e.textOriginal.length}">\n<span class="text-overflow-dynamic-ellipsis">${e.textDisplay}</span>\n${function(){if(!+e.totalReplyCount)return"";const t=document.createElement("table");return t.className="nova-hide",t.setAttribute(l,n),e.comments?.forEach((e=>{if(!(e.snippet.textDisplay=s(e.snippet.textDisplay,e.snippet.authorDisplayName)))return;r++;const n=document.createElement("tr");a&&e.snippet.authorChannelUrl.includes(a)&&n.classList.add("author"),n.innerHTML=`<td>\n<a href="${e.snippet.authorChannelUrl}" target="_blank" title="${e.snippet.authorDisplayName}">\n<img src="${e.snippet.authorProfileImageUrl}" alt="${e.snippet.authorDisplayName}" />\n</a>\n</td>\n<td>\n<span class="text-overflow-dynamic-ellipsis">\n<div class="nova-reply-time-text">${e.snippet.likeCount?`${e.snippet.likeCount} likes`:""}</div>\n<div>${e.snippet.textDisplay}</div>\n</span>\n</td>`,t.append(n)})),t.outerHTML}()}\n</td>`,t.append(i),r){const e=document.createElement("input");e.type="checkbox",e.id=e.name=n,e.addEventListener("change",(({target:e})=>{document.body.querySelector(`table[${l}="${e.name}"]`).classList.toggle("nova-hide")})),i.querySelector("td label[for]")?.before(e)}}catch(t){console.error("Error comment generate:\n",t.stack+"\n",e)}}));const c="nova-search-comment";document.getElementById(n).innerHTML=`<table class="sortable" border="0" cellspacing="0" cellpadding="0">\n<thead id="${c}">\n<tr>\n<th class="sorttable_numeric">likes</th>\n<th class="sorttable_numeric">replys</th>\n<th class="sorttable_numeric">date</th>\n<th class="sorttable_nosort">avatar</th>\n<th class="sorttable_numeric">comments (${r.length})</th>\n</tr>\n</thead>\n\x3c!-- $ {ul.innerHTML} --\x3e\n</table>`,document.getElementById(c).after(t),(NOVA.css.push('table.sortable table {\nwidth: 100%;\n}\ntable.sortable thead {\nposition: sticky;\ntop: 0px\n}\ntable.sortable th {\ntext-transform: uppercase;\nwhite-space: nowrap;\n}\ntable.sortable th:not(.sorttable_nosort) {\ncursor: pointer;\n}\ntable.sortable th:not(.sorttable_sorted):not(.sorttable_sorted_reverse):not(.sorttable_nosort):hover:after {\nposition: absolute;\ncontent: " \\25B4\\25BE";\n}\nthead, th, td {\ntext-align: center;\n}\ntable tbody {\ncounter-reset: sortabletablescope;\n}\n'),NOVA.css.push(`#${n} table {}\n#${n} thead {\nbackground-color: #555;\nz-index: 1;\n}\n#${n} th {\npadding: 5px 3px;\nfont-weight: 500;\n}\n#${n} tr:nth-child(even) {\nbackground-color: var(--yt-spec-menu-background);\n}\n#${n} td .text-overflow-dynamic-ellipsis {\ndisplay: block;\nmax-height: 25vh;\noverflow-y: auto;\nscrollbar-width: thin;\ntext-align: left;\nfont-size: 1.2em;\nline-height: 1.4;\npadding: 10px 5px;\ntext-overflow: ellipsis;\nword-wrap: break-word;\n}\n#${n} tr.author {\n}\n#${n} .author > td > .text-overflow-dynamic-ellipsis {\nbackground-color: rgba(0, 47, 144, .2);\n}\n#${n} td a {\ntext-decoration: none;\ncolor: var(--yt-spec-call-to-action);\n}`),sorttable={selector_tables:"table.sortable",class_sort_bottom:"sortbottom",class_no_sort:"sorttable_nosort",class_sorted:"sorttable_sorted",class_sorted_reverse:"sorttable_sorted_reverse",id_sorttable_sortfwdind:"sorttable_sortfwdind",id_sorttable_sortfrevind:"sorttable_sortrevind",icon_up:"&nbsp;&#x25B4;",icon_down:"&nbsp;&#x25BE;",regex_non_decimal:/[^0-9\.\-]/g,regex_trim:/^\s+|\s+$/g,regex_any_sorttable_class:/\bsorttable_([a-z0-9]+)\b/,init:function(){arguments.callee.done||(arguments.callee.done=!0,sorttable.forEach(document.querySelectorAll(sorttable.selector_tables),sorttable.makeSortable))},insert_thead_in_table:function(e){0===e.getElementsByTagName("thead").length&&(thead_element=document.createElement("thead"),thead_element.appendChild(e.rows[0]),e.insertBefore(thead_element,e.firstChild))},forEach:function(e,t,a){if(e){var n=Object;if(e instanceof Function)n=Function;else{if(e.forEach instanceof Function)return void e.forEach(t,a);"string"==typeof e?n=String:"number"==typeof e.length&&(n=Array)}n.forEach(e,t,a)}},innerSortFunction:function(e){if(this.classList.contains(sorttable.class_sorted))return sorttable.reverse(this.sorttable_tbody),this.classList.remove(sorttable.class_sorted),this.classList.add(sorttable.class_sorted_reverse),this.removeChild(document.getElementById(sorttable.id_sorttable_sortfwdind)),sortrevind=document.createElement("span"),sortrevind.id=sorttable.id_sorttable_sortfrevind,sortrevind.innerHTML=sorttable.icon_up,this.appendChild(sortrevind),void e.preventDefault();if(this.classList.contains(sorttable.class_sorted_reverse))return sorttable.reverse(this.sorttable_tbody),this.classList.remove(sorttable.class_sorted_reverse),this.classList.add(sorttable.class_sorted),this.removeChild(document.getElementById(sorttable.id_sorttable_sortfrevind)),sortfwdind=document.createElement("span"),sortfwdind.id=sorttable.id_sorttable_sortfwdind,sortfwdind.innerHTML=sorttable.icon_down,this.appendChild(sortfwdind),void e.preventDefault();theadrow=this.parentNode,sorttable.forEach(theadrow.childNodes,(function(e){1==e.nodeType&&(e.classList.remove(sorttable.class_sorted_reverse),e.classList.remove(sorttable.class_sorted))})),sortfwdind=document.getElementById(sorttable.id_sorttable_sortfwdind),sortfwdind&&sortfwdind.parentNode.removeChild(sortfwdind),sortrevind=document.getElementById(sorttable.id_sorttable_sortfrevind),sortrevind&&sortrevind.parentNode.removeChild(sortrevind),this.classList.add(sorttable.class_sorted),sortfwdind=document.createElement("span"),sortfwdind.id=sorttable.id_sorttable_sortfwdind,sortfwdind.innerHTML=sorttable.icon_down,this.appendChild(sortfwdind),row_array=[],col=this.sorttable_columnindex,rows=this.sorttable_tbody.rows;for(var t=0;t<rows.length;t++)row_array[row_array.length]=[sorttable.getInnerText(rows[t].cells[col]),rows[t]];for(row_array.sort(this.sorttable_sortfunction),tb=this.sorttable_tbody,t=0;t<row_array.length;t++)tb.appendChild(row_array[t][1]);e.preventDefault(),delete row_array},makeSortable:function(e){if(sorttable.insert_thead_in_table(e),null==e.tHead&&(e.tHead=e.getElementsByTagName("thead")[0]),1==e.tHead.rows.length){for(var t=[],a=0;a<e.rows.length;a++)e.rows[a].classList.contains(sorttable.class_sort_bottom)&&(t[t.length]=e.rows[a]);if(t){if(null==e.tFoot){var n=document.createElement("tfoot");e.appendChild(n)}for(a=0;a<t.length;a++)n.appendChild(t[a])}var l=e.tHead.rows[0].cells;for(a=0;a<l.length;a++)l[a].classList.contains(sorttable.class_no_sort)||(mtch=l[a].className.match(sorttable.regex_any_sorttable_class),mtch&&(override=mtch[1]),mtch&&"function"==typeof sorttable["sort_"+override]?l[a].sorttable_sortfunction=sorttable["sort_"+override]:l[a].sorttable_sortfunction=sorttable.guessType(e,a),l[a].sorttable_columnindex=a,l[a].sorttable_tbody=e.tBodies[0],l[a].addEventListener("click",sorttable.innerSortFunction))}},guessType:function(e,t){return sorttable.sort_alpha},getInnerText:function(e){if(!e)return"";if(void 0!==e.dataset&&void 0!==e.dataset.value)return e.dataset.value;if(hasInputs="function"==typeof e.getElementsByTagName&&e.getElementsByTagName("input").length,null!=e.getAttribute("sorttable_customkey"))return e.getAttribute("sorttable_customkey");if(void 0!==e.textContent&&!hasInputs)return e.textContent.replace(sorttable.regex_trim,"");if(void 0!==e.innerText&&!hasInputs)return e.innerText.replace(sorttable.regex_trim,"");if(void 0!==e.text&&!hasInputs)return e.text.replace(sorttable.regex_trim,"");switch(e.nodeType){case 3:if("input"==e.nodeName.toLowerCase())return e.value.replace(sorttable.regex_trim,"");case 4:return e.nodeValue.replace(sorttable.regex_trim,"");case 1:case 11:for(var t="",a=0;a<e.childNodes.length;a++)t+=sorttable.getInnerText(e.childNodes[a]);return t.replace(sorttable.regex_trim,"");default:return""}},reverse:function(e){for(var t=[],a=0;a<e.rows.length;a++)t[t.length]=e.rows[a];for(a=t.length-1;a>=0;a--)e.appendChild(t[a])},sort_numeric:function(e,t){var a=parseFloat(e[0].replace(sorttable.regex_non_decimal,""));isNaN(a)&&(a=0);var n=parseFloat(t[0].replace(sorttable.regex_non_decimal,""));return isNaN(n)&&(n=0),a-n},sort_alpha:function(e,t){return e[0]==t[0]?0:e[0]<t[0]?-1:1},shaker_sort:function(e,t){for(var a=0,n=e.length-1,l=!0;l;){l=!1;for(var o=a;o<n;++o)if(t(e[o],e[o+1])>0){var i=e[o];e[o]=e[o+1],e[o+1]=i,l=!0}if(n--,!l)break;for(o=n;o>a;--o)t(e[o],e[o-1])<0&&(i=e[o],e[o]=e[o-1],e[o-1]=i,l=!0);a++}}}).makeSortable(document.body.querySelector("table.sortable")),document.body.querySelector("table.sortable thead").addEventListener("click",(({target:e})=>{["input","textarea","select"].includes(e.localName)||e.isContentEditable||(containerScroll=document.body.querySelector(".modal-container"))&&(containerScroll.scrollTop=0)})),function(e=required()){if("string"!=typeof e)return console.error('typeof "parent_selector_id":',typeof e);NOVA.css.push(`#${e} input {\nposition: absolute;\ntop: 0;\nright: 0;\n}\n#${e} input[type=search]:focus,\n#${e} input[type=text]:focus {\noutline: 1px solid #00b7fc;\n}\n.nova-mark-text {\nbackground-color: #ff0;\nbackground-color: mark;\n}`);const t=document.createElement("input");t.setAttribute("type","search"),t.setAttribute("placeholder","Filter"),["change","keyup"].forEach((e=>{t.addEventListener(e,(function(){NOVA.searchFilterHTML({keyword:this.value,filter_selectors:"tr.item",highlight_selector:".text-overflow-dynamic-ellipsis",highlight_class:"nova-mark-text"})})),t.addEventListener("click",(()=>{t.value="",t.dispatchEvent(new Event("change"))}))})),document.getElementById(e).append(t)}(c),NOVA.css.push(`.nova-hide {\ndisplay: none;\n}\ntable[${l}] {\nborder: 1px solid #444;\nwidth: auto !important;\n}\ntable[${l}] td {\npadding: auto 10px;\n}\n.nova-reply-time-text {\nfont-size: .5em;\nfont-style: italic;\n}\n.${o} input[type=checkbox] {\n--height: 1.5em;\n--disabled-opacity: .7;\nbackground-color: var(--dark-theme-divider-color);\ncolor: var(--dark-theme-text-color);\n--off-hover-bg: var(--light-theme-secondary-color);\n--checked-bg: #e85717;\n--checked-bg-active: var(--dark-theme-divider-color);\n--checked-color: var(--dark-theme-text-color);\n--text-on: 'HIDE';\n--text-on-press: 'SHOW';\n--text-off: 'ANS';\n--text-off-press: 'HIDE?';\nappearance: none;\n-webkit-appearance: none;\nposition: relative;\ncursor: pointer;\noutline: 0;\nborder: none;\noverflow: hidden;\n-webkit-user-select: none;\n-moz-user-select: none;\n-ms-user-select: none;\nuser-select: none;\n-webkit-backface-visibility: hidden;\nbackface-visibility: hidden;\nfont-size: 1em;\nwidth: 4em;\nheight: 1.7em;\nfont-weight: bold;\n}\n.${o} input[type=checkbox]:hover:before {\nbackground-color: var(--off-hover-bg);\n}\n.${o} input[type=checkbox]:after,\n.${o} input[type=checkbox]:before {\nposition: absolute;\ntransition: left 200ms ease-in-out;\nwidth: 100%;\nline-height: 1.8em;\ntext-align: center;\n}\n.${o} input[type=checkbox]:after {\nleft: 100%;\ncontent: var(--text-on);\nfont-weight: bold;\n}\n.${o} input[type=checkbox]:before {\nleft: 0;\ncontent: var(--text-off);\n}\n.${o} input[type=checkbox]:active {\nbackground-color: var(--checked-bg);\n}\n.${o} input[type=checkbox]:active:before {\nleft: -10%;\ncontent: var(--text-on-press);\n}\n.${o} input[type=checkbox]:checked {\ncolor: var(--checked-color);\nbackground-color: var(--checked-bg);\n}\n.${o} input[type=checkbox]:checked:before {\nleft: -100%;\n}\n.${o} input[type=checkbox]:checked:after {\nleft: 0;\n}\n.${o} input[type=checkbox]:checked:active:after {\nleft: 10%;\ncontent: var(--text-off-press);\nbackground-color: var(--checked-bg-active);\n}\n.${o} input[type=checkbox] [disabled] {\ncursor: not-allowed;\n}\n.${o} input[type=checkbox] [disabled] {\nopacity: var(--disabled-opacity);\n}\n`)}},options:{comments_sort_clear_emoji:{_tagName:"input",label:"Clear of emoji",type:"checkbox"},comments_sort_min_words:{_tagName:"input",label:"Min words count","label:zh":"最少字数","label:ja":"最小単語数","label:es":"Recuento mínimo de palabras","label:pl":"Minimalna liczba słów",type:"number",title:"0 - disable",placeholder:"0-10",min:0,max:10,value:2,"data-dependent":{comments_sort_clear_emoji:!0}},comments_sort_max:{_tagName:"input",label:"Max comments",type:"number",title:"0 - disable",placeholder:"0-1200",min:0,max:1200,value:100},comments_sort_blocklist:{_tagName:"textarea",label:"Words/users blocklist","label:zh":"被阻止的单词列表","label:ja":"ブロックされた単語のリスト","label:pl":"Lista blokowanych słów",title:'separator: "," or ";" or "new line"',"title:zh":'分隔器： "," 或 ";" 或 "新队"',"title:ja":'セパレータ： "," または ";" または "改行"',"title:pl":'separator: "," lub ";" lub "now linia"',placeholder:"text1\n@userA"}}}),window.nova_plugins.push({id:"player-loop",title:"Add repeat (loop) playback button","title:zh":"添加循环播放按钮","title:ja":"ループ再生ボタンを追加する","title:pl":"Dodaj przycisk odtwarzania pętli",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{NOVA.waitSelector("#movie_player .ytp-left-controls .ytp-play-button").then((t=>{const a=document.createElement("button");if(a.className="ytp-button nova-right-custom-button",a.style.opacity=.5,a.style.minWidth=getComputedStyle(t).width||"48px",a.title="Repeat",a.innerHTML='<svg viewBox="-6 -6 36 36" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M 7 7 L 17 7 L 17 10 L 21 6 L 17 2 L 17 5 L 5 5 L 5 11 L 7 11 L 7 7 Z M 7.06 17 L 7 14 L 3 18 L 7 22 L 7 19 L 19 19 L 19 13 L 17 13 L 17 17 L 7.06 17 Z"/>\n</g>\n</svg>',a.addEventListener("click",n),t.after(a),NOVA.waitSelector("#movie_player video").then((e=>{e.addEventListener("loadeddata",(({target:e})=>{movie_player.classList.contains("ad-showing")||(1!=a.style.opacity||e.loop||(e.loop=!0),e.loop&&(a.style.opacity=1))}))})),e.player_loop_hotkey){const t=e.player_loop_hotkey;document.addEventListener("keyup",(e=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(1===t.length?e.key:e.code)===t&&n()}))}function n(){if(!NOVA.videoElement)return console.error("btn > videoElement empty:",NOVA.videoElement);NOVA.videoElement.loop=!NOVA.videoElement.loop,a.style.opacity=NOVA.videoElement.loop?1:.5,NOVA.showOSD("Loop is "+Boolean(NOVA.videoElement.loop))}}))},options:{player_loop_hotkey:{_tagName:"select",label:"Hotkey",options:[{label:"none"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"]}}}),window.nova_plugins.push({id:"player-live-duration",title:"Show duration on live video","title:zh":"显示直播视频的时长","title:ja":"ライブビデオの表示時間","title:pl":"Pokaż czas trwania wideo na żywo",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{NOVA.waitSelector("#movie_player video").then((e=>{e.addEventListener("canplay",(()=>{movie_player.getVideoData().isLive&&(el=document.body.querySelector("#movie_player .ytp-chrome-controls .ytp-live .ytp-time-current"))&&(el.style.cssText="display: block !important; margin-right: 5px;")})),NOVA.css.push("#movie_player .ytp-chrome-controls .ytp-time-display.ytp-live {\ndisplay: flex !important;\n}")}))}}),window.nova_plugins.push({id:"player-control-autohide",title:"Hide player control panel if not hovered","title:zh":"播放器上的自动隐藏控件","title:ja":"プレーヤーのコントロールを自動非表示","title:pl":"Ukrywaj elementy w odtwarzaczu",run_on_pages:"watch, embed, -mobile",section:"control-panel",desc:"Hover controls to display it","desc:zh":"将鼠标悬停在它上面以显示它","desc:ja":"カーソルを合わせると表示されます","desc:pl":"Najedź, aby wyświetlić","plugins-conflict":"player-control-below",_runtime:e=>{if(e["player-control-below"])return;let t,a;if("player"===e.player_control_autohide_container)t="ytd-watch-flexy:not([fullscreen]) #movie_player:hover .ytp-chrome-bottom",a="#movie_player:not(:hover) .ytp-gradient-bottom",NOVA.waitSelector("#movie_player").then((e=>{!function({element:e=required(),callback:t=required()}){if(!(e instanceof HTMLElement))return console.error("triggerOnHoverElement:",typeof e);if("function"!=typeof t)return console.error("triggerOnHoverElement callback:",typeof t);const a=e=>e.parentElement.querySelector(":hover")===e;document.addEventListener("mousemove",(function n(){const l=a(e);if(l!==n.hovered)return n.hovered=l,t(l)}))}({element:e,callback:function(e){e?n.mouseMoveIntervalId=n():clearInterval(n.mouseMoveIntervalId)}})}));else t=".ytp-chrome-bottom:hover",a="#movie_player:has(.ytp-chrome-bottom:not(:hover)) .ytp-gradient-bottom";if(NOVA.css.push(`.ytp-chrome-bottom {\nopacity: 0;\n}\n${t} {\nopacity: 1;\n}`),NOVA.css.push(`${a} {\nopacity: 0;\n}`),e.player_control_autohide_show_on_seek){let e;document.addEventListener("seeked",(({target:t})=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||(el=document.body.querySelector("#movie_player .ytp-chrome-bottom"))&&(clearTimeout(e),el.style.opacity=1,e=setTimeout((()=>el.style.removeProperty("opacity")),1500))}))}function n(e=2e3){return setInterval((()=>{"watch"!==NOVA.currentPage&&"embed"!==NOVA.currentPage||"visible"!=document.visibilityState||!movie_player.classList.contains("playing-mode")||document.fullscreenElement||movie_player.wakeUpControls()}),e)}},options:{player_control_autohide_container:{_tagName:"select",label:"Hover container",options:[{label:"player",value:"player",selected:!0},{label:"control",value:"control"}]},player_control_autohide_show_on_seek:{_tagName:"input",label:"Show on seeked",type:"checkbox"}}}),window.nova_plugins.push({id:"player-control-below",title:"Control panel below the player","title:zh":"控制面板位于播放器下方","title:ja":"プレーヤーの下にあるコントロールパネル","title:pl":"Panel sterowania pod odtwarzaczem",run_on_pages:"watch, -mobile",section:"control-panel",_runtime:e=>{NOVA.waitSelector(".ytp-chrome-bottom").then((async t=>{if((heightPanel=NOVA.css.get(t,"height"))&&(heightProgressBar=NOVA.css.get(".ytp-progress-bar-container","height"))){const t=`calc(${heightPanel} + ${heightProgressBar})`||"51px";let a="ytd-watch-flexy:not([fullscreen])";["force","offset"].includes(e.player_full_viewport_mode)&&(a+=":not([theater])"),NOVA.css.push(`\n${a} .caption-window {\nmargin-bottom: 0;\n}\n${a} .ytp-gradient-bottom {\ntransform: translateY(${t});\ndisplay: block !important;\nopacity: 1 !important;\nheight: ${t} !important;\npadding: 0;\nbackground-color: #0f0f0f; \n}\n${a} .ytp-chrome-bottom {\ntransform: translateY(${t});\nopacity: 1 !important;\n}\n${a} .html5-video-player {\noverflow: visible;\n}\n${a} .ytp-player-content.ytp-iv-player-content {\nbottom: ${NOVA.css.get(".ytp-player-content.ytp-iv-player-content","left")||"12px"};\n}\n${a} .ytp-tooltip,\n${a} .ytp-settings-menu {\ntransform: translateY(${t});\n}\n${a}[theater] > #columns,\n${a}:not([theater]) #below {\nmargin-top: ${t} !important;\n}\n#ytd-player {\noverflow: visible !important;\n}\n`),e["player-float-progress-bar"]&&NOVA.css.push("#movie_player.ytp-autohide .ytp-chrome-bottom .ytp-progress-bar-container {\ndisplay: none !important;\n}"),function(t=2e3){if(e.player_hide_elements?.includes("time_display")||e["theater-mode"]&&["force","offset"].includes(e.player_full_viewport_mode))return;setInterval((()=>{e["theater-mode"]&&"smart"==e.player_full_viewport_mode&&"2020"!=NOVA.css.get(movie_player,"z-index")&&"fixed"!=NOVA.css.get(movie_player,"position")||"watch"==NOVA.currentPage&&"visible"==document.visibilityState&&movie_player.classList.contains("playing-mode")&&!document.fullscreenElement&&movie_player.wakeUpControls()}),t)}()}}))}}),window.nova_plugins.push({id:"player-hide-elements",title:"Hide some player buttons/elements","title:zh":"隐藏一些播放器按钮/元素","title:ja":"一部のプレーヤーのボタン/要素を非表示にする","title:pl":"Ukryj niektóre przyciski/elementy odtwarzacza",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{const t={ambient:"#cinematics-container",videowall_endscreen:".videowall-endscreen",card_endscreen:'[class^="ytp-ce-"]',watch_later_button:".ytp-chrome-top-buttons button.ytp-watch-later-button",info_button:".ytp-chrome-top-buttons button.ytp-cards-button",prev_button:".ytp-chrome-bottom .ytp-prev-button",play_button:".ytp-chrome-bottom .ytp-play-button",next_button:".ytp-chrome-bottom .ytp-next-button",volume_area:".ytp-chrome-bottom .ytp-volume-area",time_display:".ytp-chrome-bottom .ytp-time-display"+(e["time-remaining"]?" span > span:not([id])":""),time_duration_display:".ytp-chrome-bottom .ytp-time-duration, .ytp-chrome-bottom .ytp-time-separator",chapter_container:".ytp-chrome-bottom .ytp-chapter-container",autonav_toggle_button:'.ytp-chrome-bottom button.ytp-button[data-tooltip-target-id="ytp-autonav-toggle-button"]',subtitles_button:".ytp-chrome-bottom button.ytp-subtitles-button",settings_button:".ytp-chrome-bottom button.ytp-settings-button",cast_button:".ytp-chrome-bottom button.ytp-remote-button",size_button:".ytp-chrome-bottom button.ytp-size-button",miniplayer_button:".ytp-chrome-bottom button.ytp-miniplayer-button",logo_button:".ytp-chrome-bottom .yt-uix-sessionlink",fullscreen_button:".ytp-chrome-bottom button.ytp-fullscreen-button",brave_jump_button:".ytp-chrome-bottom button.ytp-jump-button"};let a=[];var n;(n=e.player_hide_elements,Array.isArray(n)?n:[n]).forEach((e=>(data=t[e])&&a.push(`#movie_player ${data}`))),a.length&&NOVA.css.push(a.join(",\n")+" {\ndisplay: none !important;\n}")},options:{player_hide_elements:{_tagName:"select",label:"Items",title:"[Ctrl+Click] to select several","title:zh":"[Ctrl+Click] 选择多个","title:ja":"「Ctrl+Click」して、いくつかを選択します","title:pl":"Ctrl+kliknięcie, aby zaznaczyć kilka",multiple:null,required:!0,size:10,options:[{label:"ambient",value:"ambient"},{label:"videowall (thumbs)",value:"videowall_endscreen"},{label:"card",value:"card_endscreen"},{label:"watch-later",value:"watch_later_button"},{label:"info (embed)",value:"info_button"},{label:"prev",value:"prev_button"},{label:"play / stop live",value:"play_button"},{label:"next",value:"next_button"},{label:"jump (for Brave)",value:"brave_jump_button",title:"Seek backwards/forward 10 seconds"},{label:"volume",value:"volume_area"},{label:"time",value:"time_display"},{label:"time duration",value:"time_duration_display"},{label:"chapter",value:"chapter_container"},{label:"autoplay next",value:"autonav_toggle_button"},{label:"subtitles",value:"subtitles_button"},{label:"settings",value:"settings_button"},{label:"cast",value:"cast_button"},{label:"size",value:"size_button"},{label:"miniplayer",value:"miniplayer_button"},{label:"logo (embed)",value:"logo_button"},{label:"fullscreen",value:"fullscreen_button"}]}}}),window.nova_plugins.push({id:"player-hotkeys-focused",title:"Player shortcuts always active","title:zh":"播放器热键始终处于活动状态","title:ja":"プレーヤーのホットキーは常にアクティブです","title:pl":"Klawisze skrótów dla graczy zawsze aktywne",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{function t(e){["input","textarea","select"].includes(e.localName)||e.isContentEditable||movie_player.focus({preventScroll:!0})}document.addEventListener("keyup",(a=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||(t(a.target),e.hotkeys_disable_numpad&&a.code.startsWith("Numpad")&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()))})),document.addEventListener("click",(e=>e.isTrusted&&t(e.target)))},options:{hotkeys_disable_numpad:{_tagName:"input",label:"Disable numpad",type:"checkbox"}}}),window.nova_plugins.push({id:"player-progress-bar-color",title:"Player progress bar color","title:zh":"播放器进度条颜色","title:ja":"プレーヤーのプログレスバーの色","title:pl":"Kolor paska postępu gracza",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{NOVA.css.push(`.ytp-swatch-background-color {\nbackground-color: ${e.player_progress_bar_color||"#f00"} !important;\n}`)},options:{player_progress_bar_color:{_tagName:"input",type:"color",value:"#0089ff",label:"Color","label:zh":"颜色","label:ja":"色","label:pl":"Kolor"}}}),window.nova_plugins.push({id:"player-float-progress-bar",title:"Float player progress bar","title:zh":"浮动播放器进度条","title:ja":"フロートプレーヤーのプログレスバー","title:pl":"Pływający pasek postępu odtwarzacza",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{if("embed"==NOVA.currentPage&&(document.URL.includes("live_stream")||["0","false"].includes(NOVA.queryURL.get("controls"))))return;const t="#movie_player.ytp-autohide",a="nova-player-float-progress-bar",n="#"+a,l="2px",o="nova-chapters-jump-active";NOVA.waitSelector(`${e["player-control-autohide"]?"#movie_player":t} video`).then((r=>{const s=function({init_container:i=movie_player,z_index:r=60}){if(!(i instanceof HTMLElement))return console.error("vid not HTMLElement:",i);return document.getElementById(a)||function(){if(i.insertAdjacentHTML("beforeend",`<div id="${a}" class="">\n<div class="container">\n<div id="${a}-buffer" class="ytp-load-progress"></div>\n<div id="${a}-progress" class="ytp-swatch-background-color"></div>\n</div>\n<div id="${a}-chapters"></div>\n</div>`),NOVA.css.push(`[id|=${a}] {\nposition: absolute;\nbottom: 0;\n}\n${n} {\n--opacity: ${+e.player_float_progress_bar_opacity||.7};\n--height: ${+e.player_float_progress_bar_height||3}px;\n--bg-color: ${NOVA.css.get(".ytp-progress-list","background-color")||"rgba(255,255,255,.2)"};\n--zindex: ${r};\nopacity: var(--opacity);\nz-index: var(--zindex);\nbackground-color: var(--bg-color);\nwidth: 100%;\nheight: var(--height);\nvisibility: hidden;\n}\n${t} ${n} {\nvisibility: visible;\n}\n${t} ${n}.transition [id|=${a}] {\ntransition: transform 200ms linear;\n}\n${n}-progress, ${n}-buffer {\nwidth: 100%;\nheight: 100%;\ntransform-origin: 0 0;\ntransform: scaleX(0);\n}\n${n}-progress {\nz-index: calc(var(--zindex) + 1);\n}\n${n}-chapters {\nposition: relative;\nwidth: 100%;\ndisplay: flex;\njustify-content: flex-end;\n}\n${n}-chapters span {\nheight: var(--height);\nz-index: calc(var(--zindex) + 1);\nbox-sizing: border-box;\npadding: 0;\nmargin: 0;\n}\n${n}-chapters > span:first-child:not([time$="0:00"]), \n${n}-chapters > span:not(:first-child) {\nborder-left: ${l} solid rgba(255,255,255,.7);\n}\n${n}-chapters > span {\nposition: relative;\n}\n${n}-chapters > span > span {\nposition: absolute;\n}\n.${o} {\nvisibility: visible !important;\n--height: 20px !important;\n}\n.${o}:not(:hover) {\n--bg-color: coral !important;\n}\n.${o} ${n}-chapters span:hover {\nborder-left: ${l} solid cornflowerblue !important;\ncursor: pointer;\nbackground-color: rgba(255,255,255,.7);\n}`),e["player-control-autohide"]){switch(e.player_control_autohide_container){case"player":NOVA.css.push(`${t}:not(:hover) ${n} {\nvisibility: visible !important;\n}`);break;case"control":NOVA.css.push(`.ytp-chrome-bottom:not(:hover) ~ ${n} {\nvisibility: visible !important;\n}`)}e.player_control_autohide_show_on_seek&&NOVA.css.push(`[style*="opacity: 1"] ~ ${n} {\nvisibility: hidden !important;\n}`)}return document.getElementById(a)}()}({init_container:movie_player,z_index:Math.max(NOVA.css.get(".ytp-chrome-bottom","z-index"),59)}),c=document.getElementById(`${a}-buffer`),d=document.getElementById(`${a}-progress`);function u(){m()||!isNaN(this.duration)&&this.buffered?.length&&(c.style.transform=`scaleX(${this.buffered.end(this.buffered.length-1)/this.duration})`)}function p(){s.style.display=movie_player.getVideoData().isLive?"none":"inherit",s.classList.remove("transition"),c.style.transform="scaleX(0)",d.style.transform="scaleX(0)",s.classList.add("transition"),i.init(r)}function m(){return"hidden"==document.visibilityState||movie_player.getVideoData().isLive}i.init(r),r.addEventListener("progress",(()=>s.classList.add("transition")),{capture:!0,once:!0}),r.addEventListener("loadeddata",p),document.addEventListener("yt-navigate-finish",p),r.addEventListener("timeupdate",(function(){m()||isNaN(this.duration)||(d.style.transform=`scaleX(${this.currentTime/this.duration})`)})),u.apply(r),r.addEventListener("progress",u.bind(r)),r.addEventListener("seeking",u.bind(r)),e.player_float_progress_bar_hotkey&&function(){let t;function n(n){if(("watch"==NOVA.currentPage||"embed"==NOVA.currentPage)&&!["input","textarea","select"].includes(n.target.localName)&&!n.target.isContentEditable&&(el=document.getElementById(a))&&el.querySelector("span[time]"))switch(n.type){case"keydown":const a=1===e.player_float_progress_bar_hotkey.length?n.key:n.code;e.player_float_progress_bar_hotkey!=a||t||(el.classList.add(o),t=!0);break;case"keyup":t&&(t=!1,el.classList.remove(o))}}document.addEventListener("keydown",n),document.addEventListener("keyup",n),document.getElementById(a).addEventListener("click",(({target:e})=>{if(!(secTime=e.getAttribute("time")))return;const t=NOVA.formatTimeOut.hmsToSec(secTime);"function"==typeof movie_player.seekBy?movie_player.seekTo(t):NOVA.videoElement&&(NOVA.videoElement.currentTime=t)}),{capture:!0})}()}));const i={async init(e){if("watch"==NOVA.currentPage&&!(e instanceof HTMLElement))return console.error("vid not HTMLElement:",chaptersContainer);switch(await NOVA.waitUntil((()=>!isNaN(e.duration)),1e3),NOVA.currentPage){case"watch":this.from_description(e.duration);break;case"embed":let t;await NOVA.waitUntil((()=>(t=document.body.querySelector(".ytp-chapters-container"))&&t?.children.length>1),1e3),this.renderChaptersMarkers(e.duration)||this.from_div(t)}},from_description(e=required()){if(isNaN(e))return console.error("duration isNaN:",e);if(1!==Math.sign(e))return console.error("duration not positive number:",e);const t='a[href*="&t="]';NOVA.waitSelector(`ytd-watch-metadata #description.ytd-watch-metadata ${t}`,{destroy_after_page_leaving:!0}).then((()=>this.renderChaptersMarkers(e))),NOVA.waitSelector(`#comments #comment #comment-content ${t}`,{destroy_after_page_leaving:!0}).then((()=>{document.body.querySelector(`${n}-chapters > span[time]`)||this.renderChaptersMarkers(e)}))},from_div(e=required()){if(!(e instanceof HTMLElement))return console.error("container not HTMLElement:",e);const t=parseInt(getComputedStyle(e).width),n=document.getElementById(`${a}-chapters`);for(const a of e.children){const e=document.createElement("span"),{width:l,marginLeft:o,marginRight:i}=getComputedStyle(a),r=parseInt(o)+parseInt(i);e.style.width=100*(parseInt(l)+r)/t+"%",n.append(e)}},renderChaptersMarkers(e=required()){if(isNaN(e))return console.error("duration isNaN:",e);(chaptersContainer=document.getElementById(`${a}-chapters`))&&(chaptersContainer.innerHTML="");const t=NOVA.getChapterList(e);return t?.forEach(((t,a,n)=>{const l=document.createElement("span"),o=n[a+1]?.sec||e;l.style.width=100*(o-t.sec)/e+"%",t.title&&(l.title=t.title),l.setAttribute("time",t.time),chaptersContainer&&chaptersContainer.append(l)})),t}}},options:{player_float_progress_bar_height:{_tagName:"input",label:"Height","label:zh":"高度","label:ja":"身長","label:pl":"Wysokość",type:"number",title:"in pixels",placeholder:"px",min:1,max:9,value:3},player_float_progress_bar_opacity:{_tagName:"input",label:"Opacity","label:zh":"不透明度","label:ja":"不透明度","label:pl":"Przejrzystość",type:"number",placeholder:"0-1",step:.05,min:0,max:1,value:.7},player_float_progress_bar_hotkey:{_tagName:"select",label:"Hotkey to chapters jump (by click)","label:zh":"章节跳转热键（点击）","label:ja":"章にジャンプするホットキー (クリックによる)",options:[{label:"none"},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"]}}}),window.nova_plugins.push({id:"player-quick-buttons",title:"Add custom player buttons","title:zh":"カスタム プレーヤー ボタンを追加する","title:ja":"カスタム プレーヤー ボタンを追加する","title:pl":"Dodaj własne przyciski odtwarzacza",run_on_pages:"watch, embed, -mobile",section:"control-panel",_runtime:e=>{const t="nova-right-custom-button",a="."+t;NOVA.waitSelector("#movie_player .ytp-right-controls").then((async n=>{if(NOVA.videoElement=await NOVA.waitSelector("video"),NOVA.css.push(`${a} {\nuser-select: none;\n}\n${a}:hover { color: #66afe9 !important; }\n${a}:active { color: #2196f3 !important; }`),NOVA.css.push(`${a}[tooltip]:hover::before {\ncontent: attr(tooltip);\nposition: absolute;\ntop: -3em;\ntransform: translateX(-30%);\nline-height: normal;\nbackground-color: rgba(28,28,28,.9);\nborder-radius: .3em;\npadding: 5px 9px;\ncolor: white;\nfont-weight: bold;\nwhite-space: nowrap;\n}\nhtml[data-cast-api-enabled] ${a}[tooltip]:hover::before {\nfont-weight: normal;\n}`),e.player_buttons_custom_items?.includes("picture-in-picture")){const m=document.createElement("button");function l(e){const t=document.createElement("svg");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("viewBox","-8 -6 36 36");const a=document.createElement("path");return a.setAttribute("fill","currentColor"),a.setAttribute("d",e?"M18.5,11H18v1h.5A1.5,1.5,0,0,1,20,13.5v5A1.5,1.5,0,0,1,18.5,20h-8A1.5,1.5,0,0,1,9,18.5V18H8v.5A2.5,2.5,0,0,0,10.5,21h8A2.5,2.5,0,0,0,21,18.5v-5A2.5,2.5,0,0,0,18.5,11Z M14.5,4H2.5A2.5,2.5,0,0,0,0,6.5v8A2.5,2.5,0,0,0,2.5,17h12A2.5,2.5,0,0,0,17,14.5v-8A2.5,2.5,0,0,0,14.5,4Z":"M2.5,17A1.5,1.5,0,0,1,1,15.5v-9A1.5,1.5,0,0,1,2.5,5h13A1.5,1.5,0,0,1,17,6.5V10h1V6.5A2.5,2.5,0,0,0,15.5,4H2.5A2.5,2.5,0,0,0,0,6.5v9A2.5,2.5,0,0,0,2.5,18H7V17Z M18.5,11h-8A2.5,2.5,0,0,0,8,13.5v5A2.5,2.5,0,0,0,10.5,21h8A2.5,2.5,0,0,0,21,18.5v-5A2.5,2.5,0,0,0,18.5,11Z"),t.append(a),t.outerHTML}m.className=`ytp-button ${t}`,m.setAttribute("tooltip","Picture in Picture (PiP)"),m.innerHTML=l(),m.addEventListener("click",(()=>document.pictureInPictureElement?document.exitPictureInPicture():NOVA.videoElement.requestPictureInPicture())),n.prepend(m),NOVA.videoElement?.addEventListener("enterpictureinpicture",(()=>m.innerHTML=l(2))),NOVA.videoElement?.addEventListener("leavepictureinpicture",(()=>m.innerHTML=l()))}if(-1!==e.player_buttons_custom_items?.indexOf("popup")&&!NOVA.queryURL.has("popup")){const h=document.createElement("button");h.className=`ytp-button ${t}`,h.setAttribute("tooltip","Open in popup"),h.innerHTML='<svg viewBox="-8 -8 36 36" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M18 2H6v4H2v12h12v-4h4V2z M12 16H4V8h2v6h6V16z M16 12h-2h-2H8V8V6V4h8V12z" />\n</g>\n</svg>',h.addEventListener("click",(()=>{const{width:e,height:t}=NOVA.aspectRatio.sizeToFit({srcWidth:NOVA.videoElement.videoWidth,srcHeight:NOVA.videoElement.videoHeight});url=new URL(document.head.querySelector('link[itemprop="embedUrl"][href]')?.href||location.origin+"/embed/"+movie_player.getVideoData().video_id),(currentTime=Math.trunc(NOVA.videoElement?.currentTime))&&url.searchParams.set("start",currentTime),url.searchParams.set("autoplay",1),url.searchParams.set("popup",!0),NOVA.openPopup({url:url.href,width:e,height:t})})),n.prepend(h)}if(e.player_buttons_custom_items?.includes("screenshot")){const b="nova-screenshot-result",y="#"+b;NOVA.css.push(y+` {\n--width: 400px;\n--height: 400px;\nposition: fixed;\ntop: 0;\nright: 0;\noverflow: hidden;\nmargin: 36px 30px; \nbox-shadow: 0 0 15px black;\nmax-width: var(--width);\nmax-height: var(--height);\n}\n${y} canvas {\nmax-width: var(--width);\nmax-height: var(--height);\n}\n${y} .close-btn {\nposition: absolute;\nbottom: 0;\nright: 0;\nbackground-color: rgba(0, 0, 0, .5);\ncolor: white;\ncursor: pointer;\nfont-size: 12px;\ndisplay: grid;\nheight: 100%;\nwidth: 25%;\n}\n${y} .close-btn:hover { background-color: rgba(0, 0, 0, .65); }\n${y} .close-btn > * { margin: auto; }`);const _=document.createElement("button");_.className=`ytp-button ${t}`,_.setAttribute("tooltip","Take screenshot"),_.innerHTML='<svg viewBox="0 -166 512 860" height="100%" width="100%">\n<g fill="currentColor">\n<circle cx="255.811" cy="285.309" r="75.217" />\n<path d="M477,137H352.718L349,108c0-16.568-13.432-30-30-30H191c-16.568,0-30,13.432-30,30l-3.718,29H34 c-11.046,0-20,8.454-20,19.5v258c0,11.046,8.954,20.5,20,20.5h443c11.046,0,20-9.454,20-20.5v-258C497,145.454,488.046,137,477,137 z M255.595,408.562c-67.928,0-122.994-55.066-122.994-122.993c0-67.928,55.066-122.994,122.994-122.994 c67.928,0,122.994,55.066,122.994,122.994C378.589,353.495,323.523,408.562,255.595,408.562z M474,190H369v-31h105V190z" />\n</g>\n</svg>',_.addEventListener("click",(()=>{const t=document.getElementById(b)||document.createElement("a"),a=t.querySelector("canvas")||document.createElement("canvas"),n=a.getContext("2d"),l=`image/${e.player_buttons_custom_screenshot||"png"}`;if(a.width=NOVA.videoElement.videoWidth,a.height=NOVA.videoElement.videoHeight,n.drawImage(NOVA.videoElement,0,0,a.width,a.height),a.title="Click to save",textString=document.body.querySelector(".caption-window")?.innerText){n.font=`bold ${Math.trunc(.05*a.height)}px Arial`,n.textAlign="buttom",n.textBaseline="middle",n.fillStyle=e.player_buttons_custom_screenshot_subtitle_color||"white",n.strokeStyle=e.player_buttons_custom_screenshot_subtitle_shadow_color||"black",n.lineWidth=a.height/1e3;let t=.9*a.height;textString.split("\n").forEach(((e,l)=>{const o=n.measureText(e),i=o.actualBoundingBoxAscent+o.actualBoundingBoxDescent,r=n.measureText(e).width,s=a.width/2-r/2;n.fillText(e,s,t),n.strokeText(e,s,t),t+=i}))}try{a.toBlob((a=>{t.href=URL.createObjectURL(a),e.player_buttons_custom_screenshot_to_clipboard&&navigator.clipboard?.write&&navigator.clipboard.write([new ClipboardItem({[l]:a})])}),l)}catch(e){}if(e.player_buttons_custom_screenshot_to_clipboard&&navigator.clipboard?.write)return NOVA.showOSD("Screenshot copied to clipboard");if(!t.id){t.id=b,t.target="_blank",(headerContainer=document.getElementById("masthead-container"))&&(t.style.marginTop=(headerContainer?.offsetHeight||0)+"px",t.style.zIndex=+getComputedStyle(headerContainer)["z-index"]+1),a.addEventListener("click",(a=>{a.preventDefault(),function(t,a="image/png"){const n=document.createElement("a"),l=[movie_player.getVideoData().title.replace(/[\\/:*?"<>|]+/g,"").replace(/\s+/g," ").trim(),(time=NOVA.formatTimeOut.HMS.abbr(NOVA.videoElement.currentTime))?`(${time})`:""].join(" ");n.href=t.toDataURL(a).replace(a,"image/octet-stream"),n.download=`${l}.${e.player_buttons_custom_screenshot||"png"}`,n.click()}(a.target,l),t.remove()}),{capture:!0}),t.append(a);const n=document.createElement("a");n.className="close-btn",n.innerHTML="<span>CLOSE</span>",n.title="Close",n.addEventListener("click",(e=>{e.preventDefault(),t.remove()})),t.append(n),document.body.append(t)}})),n.prepend(_)}if(e.player_buttons_custom_items?.includes("thumbnail")){const v=document.createElement("button");v.className=`ytp-button ${t}`,v.setAttribute("tooltip","View Thumbnail"),v.innerHTML="<svg viewBox=\"0 -10 21 40\" height=\"100%\" width=\"100%\">\n<g fill=\"currentColor\">\n<circle cx='8' cy='7.2' r='2'/>\n<path d='M0 2v16h20V2H0z M18 16H2V4h16V16z'/>\n<polygon points='17 10.9 14 7.9 9 12.9 6 9.9 3 12.9 3 15 17 15' />\n</g>\n</svg>",v.addEventListener("click",(async()=>{const e=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id,t=["maxres","sd","hq","mq",""];document.body.style.cursor="wait";for(const a of t){const t=`https://i.ytimg.com/vi/${e}/${a}default.jpg`,n=await fetch(t);if(200===n.status){const e=await n.blob(),a=new Image;a.src=URL.createObjectURL(e),a.addEventListener("load",(()=>{NOVA.openPopup({url:t,width:a.width,height:a.height})})),document.body.style.removeProperty("cursor");break}}})),n.prepend(v)}if(e.player_buttons_custom_items?.includes("rotate")){const g=e.player_buttons_custom_hotkey_rotate||"KeyR",f=document.createElement("button");function o(){let e=NOVA.extractAsNum.int(NOVA.videoElement.style.transform)||0;const t=0===e||180===e?movie_player.clientHeight/NOVA.videoElement.clientWidth:1;e+=90,NOVA.videoElement.style.transform=360===e?"":`rotate(${e}deg) scale(${t})`}f.className=`ytp-button ${t}`,f.setAttribute("tooltip",`Rotate video (${g.replace("Key","")})`),f.style.cssText="padding: 0 1.1em;",f.innerHTML='<svg viewBox="0 0 1536 1536" height="100%" width="100%">\n<g fill="currentColor">\n<path\nd="M1536 128v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l138-138Q969 256 768 256q-104 0-198.5 40.5T406 406 296.5 569.5 256 768t40.5 198.5T406 1130t163.5 109.5T768 1280q119 0 225-52t179-147q7-10 23-12 14 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109 132-264 204.5T768 1536q-156 0-298-61t-245-164-164-245T0 768t61-298 164-245T470 61 768 0q147 0 284.5 55.5T1297 212l130-129q29-31 70-14 39 17 39 59z"/>\n</path>\n</g>\n</svg>',f.addEventListener("click",o),document.addEventListener("keyup",(e=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(1===g.length?e.key:e.code)===g&&o()})),n.prepend(f)}if(e.player_buttons_custom_items?.includes("aspect-ratio")){const w=document.createElement("a"),k=[{"16:9":"scaleX(1.3333)"},{"4:3":"scaleX(.75)"},{"9:16":"scaleX(1.777777778)"},{"21:9":"scaleY(.7168)"},{default:"scale(1)"},,],N=(e=0)=>"next "+Object.keys(k[e]);w.className=`ytp-button ${t}`,w.style.textAlign="center",w.style.fontWeight="bold",w.setAttribute("tooltip",N()),w.innerHTML="default",w.addEventListener("click",(()=>{if(!NOVA.videoElement)return;const e=()=>this.listIdx<k.length-1?this.listIdx+1:0;this.listIdx=e(),NOVA.videoElement.style.transform=Object.values(k[this.listIdx]),w.setAttribute("tooltip",N(e())),w.textContent=Object.keys(k[this.listIdx])})),n.prepend(w)}if(e.player_buttons_custom_items?.includes("watch-later")&&NOVA.waitSelector(".ytp-watch-later-button").then((e=>{NOVA.css.push(`.${t} .ytp-spinner-container {\nposition: relative;\ntop: 0;\nleft: 0;\nscale: .5;\nmargin: 0;\n}\n.${t}.watch-later-btn svg {\nscale: .85;\n}`);const a=document.createElement("button");function n(){a.innerHTML=e.querySelector(".ytp-watch-later-icon")?.innerHTML}a.className=`ytp-button ${t} watch-later-btn`,a.setAttribute("tooltip","Watch later"),n(),a.addEventListener("click",(()=>{e.click(),n();const t=setInterval((()=>{e.querySelector("svg")&&(clearInterval(t),n())}),100)})),[...document.getElementsByClassName(t)].pop()?.after(a)})),e.player_buttons_custom_items?.includes("card-switch")&&!e.player_hide_elements?.includes("videowall_endscreen")&&!e.player_hide_elements?.includes("card_endscreen")){const A="nova-hide-endscreen",x=document.createElement("button");function i(e=required()){x.innerHTML=l(e),x.setAttribute("tooltip","The cards are currently "+(e?"hidden":"showing"))}function l(e){const t=document.createElement("svg");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("viewBox","-200 0 912 512");const a=document.createElement("g");return a.setAttribute("fill","currentColor"),a.innerHTML=e?'<path d="M 409 57.104 C 407.625 57.641, 390.907 73.653, 371.848 92.687 L 337.196 127.293 323.848 120.738 C 301.086 109.561, 283.832 103.994, 265.679 101.969 C 217.447 96.591, 148.112 134.037, 59.026 213.577 C 40.229 230.361, 4.759 265.510, 2.089 270 C -0.440 274.252, -0.674 281.777, 1.575 286.516 C 4.724 293.153, 67.054 352.112, 89.003 369.217 L 92.490 371.934 63.330 401.217 C 37.873 426.781, 34.079 430.988, 33.456 434.346 C 31.901 442.720, 38.176 452.474, 46.775 455.051 C 56.308 457.907, 41.359 471.974, 244.317 269.173 C 350.152 163.421, 429.960 82.914, 431.067 80.790 C 436.940 69.517, 428.155 55.840, 415.185 56.063 C 413.158 56.098, 410.375 56.566, 409 57.104 M 245.500 137.101 C 229.456 139.393, 201.143 151.606, 177.500 166.433 C 151.339 182.839, 120.778 206.171, 89.574 233.561 C 72.301 248.723, 42 277.649, 42 278.977 C 42 280.637, 88.281 323.114, 108.367 339.890 L 117.215 347.279 139.209 325.285 L 161.203 303.292 159.601 293.970 C 157.611 282.383, 157.570 272.724, 159.465 261.881 C 165.856 225.304, 193.011 195.349, 229.712 184.389 C 241.299 180.929, 261.648 179.996, 272.998 182.405 L 280.496 183.996 295.840 168.652 L 311.183 153.309 303.342 149.583 C 292.100 144.242, 277.007 139.186, 267.205 137.476 C 257.962 135.865, 254.565 135.806, 245.500 137.101 M 377.500 163.164 C 374.231 164.968, 369.928 169.297, 368.295 172.423 C 366.203 176.431, 366.351 184.093, 368.593 187.889 C 369.597 189.587, 375.944 195.270, 382.699 200.516 C 406.787 219.226, 444.129 252.203, 462.500 270.989 L 470.500 279.170 459 290.204 C 374.767 371.030, 302.827 418.200, 259.963 420.709 C 239.260 421.921, 213.738 412.918, 179.575 392.352 C 167.857 385.298, 166.164 384.571, 161.448 384.571 C 154.702 384.571, 149.091 388.115, 146.121 394.250 C 143.531 399.600, 143.472 403.260, 145.890 408.500 C 148.270 413.656, 150.468 415.571, 162 422.535 C 198.520 444.590, 230.555 455.992, 256 455.992 C 305.062 455.992, 376.663 414.097, 462 335.458 C 483.584 315.567, 509.652 289.051, 510.931 285.685 C 512.694 281.042, 512.218 273.876, 509.889 270 C 507.494 266.017, 484.252 242.741, 463.509 223.552 C 437.964 199.922, 398.967 167.566, 391.300 163.639 C 387.656 161.773, 380.470 161.526, 377.500 163.164 M 235.651 219.459 C 231.884 220.788, 226.369 223.351, 223.395 225.153 C 216.405 229.389, 206.759 239.019, 202.502 246.010 C 198.959 251.828, 193.677 266.197, 194.194 268.611 C 194.372 269.437, 205.637 258.890, 220.993 243.519 C 249.683 214.801, 249.910 214.427, 235.651 219.459 M 316.962 223.250 C 313.710 224.890, 311.876 226.720, 310.200 230 C 307.188 235.893, 307.781 240.006, 313.805 255 C 317.867 265.109, 318.470 267.589, 318.790 275.500 C 319.554 294.378, 313.786 309.236, 300.522 322.557 C 287.282 335.854, 274.164 341.408, 256 341.408 C 244.216 341.408, 238.392 340.027, 226.837 334.489 C 214.541 328.596, 204.996 330.563, 200.250 339.966 C 191.301 357.697, 210.339 372.220, 247.484 375.998 C 301.141 381.456, 350.063 339.760, 353.664 285.500 C 354.618 271.136, 351.039 249.928, 345.577 237.579 C 342.933 231.601, 337.061 224.600, 332.875 222.435 C 328.782 220.319, 322.095 220.661, 316.962 223.250" fill-rule="evenodd" />':'<path d="M 377.5 163.164 C 374.231 164.968 375.944 195.27 382.699 200.516 C 406.787 219.226 444.129 252.203 462.5 270.989 L 470.5 279.17 L 459 290.204 C 374.767 371.03 302.827 418.2 259.963 420.709 C 239.26 421.921 213.738 412.918 179.575 392.352 C 167.857 385.298 166.164 384.571 161.448 384.571 C 154.702 384.571 149.091 388.115 146.121 394.25 C 143.531 399.6 143.472 403.26 145.89 408.5 C 148.27 413.656 150.468 415.571 162 422.535 C 198.52 444.59 230.555 455.992 256 455.992 C 305.062 455.992 376.663 414.097 462 335.458 C 483.584 315.567 509.652 289.051 510.931 285.685 C 512.694 281.042 512.218 273.876 509.889 270 C 507.494 266.017 484.252 242.741 463.509 223.552 C 437.964 199.922 398.967 167.566 391.3 163.639 C 387.656 161.773 380.47 161.526 377.5 163.164 M 316.962 223.25 C 313.71 224.89 311.876 226.72 310.2 230 C 307.188 235.893 307.781 240.006 313.805 255 C 317.867 265.109 318.47 267.589 318.79 275.5 C 319.554 294.378 313.786 309.236 300.522 322.557 C 287.282 335.854 274.164 341.408 256 341.408 C 244.216 341.408 238.392 340.027 226.837 334.489 C 214.541 328.596 204.996 330.563 200.25 339.966 C 191.301 357.697 210.339 372.22 247.484 375.998 C 301.141 381.456 350.063 339.76 353.664 285.5 C 354.618 271.136 351.039 249.928 345.577 237.579 C 342.933 231.601 337.061 224.6 332.875 222.435 C 328.782 220.319 322.095 220.661 316.962 223.25"></path>\n<path d="M 377.487 163.483 C 374.218 165.287 369.915 169.616 368.282 172.742 C 366.19 176.75 366.338 184.412 368.58 188.208 C 369.584 189.906 375.931 195.589 382.686 200.835 C 406.774 219.545 444.116 252.522 462.487 271.308 L 470.487 279.489 L 458.987 290.523 C 374.754 371.349 302.814 418.519 259.95 421.028 C 239.247 422.24 213.725 413.237 179.562 392.671 C 167.844 385.617 166.151 384.89 161.435 384.89 C 154.689 384.89 149.078 388.434 146.108 394.569 C 143.518 399.919 143.459 403.579 145.877 408.819 C 148.257 413.975 150.455 415.89 161.987 422.854 C 198.507 444.909 230.542 456.311 255.987 456.311 C 305.049 456.311 376.65 414.416 461.987 335.777 C 483.571 315.886 509.639 289.37 510.918 286.004 C 512.681 281.361 512.205 274.195 509.876 270.319 C 507.481 266.336 484.239 243.06 463.496 223.871 C 437.951 200.241 398.954 167.885 391.287 163.958 C 387.643 162.092 380.457 161.845 377.487 163.483 M 316.949 223.569 C 313.697 225.209 311.863 227.039 310.187 230.319 C 307.175 236.212 307.768 240.325 313.792 255.319 C 317.854 265.428 318.457 267.908 318.777 275.819 C 319.541 294.697 313.773 309.555 300.509 322.876 C 287.269 336.173 274.151 341.727 255.987 341.727 C 244.203 341.727 238.379 340.346 226.824 334.808 C 214.528 328.915 204.983 330.882 200.237 340.285 C 191.288 358.016 210.326 372.539 247.471 376.317 C 301.128 381.775 350.05 340.079 353.651 285.819 C 354.605 271.455 351.026 250.247 345.564 237.898 C 342.92 231.92 337.048 224.919 332.862 222.754 C 328.769 220.638 322.082 220.98 316.949 223.569" transform="matrix(-1, 0, 0, -1, 512.000305, 558.092285)"></path>',t.append(a),t.outerHTML}NOVA.css.push(`#movie_player[${A}] .videowall-endscreen,\n#movie_player[${A}] .ytp-pause-overlay,\n#movie_player[${A}] [class^="ytp-ce-"] {\ndisplay: none !important;\n}`),x.className=`ytp-button ${t}`,x.innerHTML=l(),e.player_buttons_custom_card_switch&&i(movie_player.toggleAttribute(A)),x.addEventListener("click",(()=>i(movie_player.toggleAttribute(A)))),n.prepend(x)}if(e.player_buttons_custom_items?.includes("quick-quality")){const O="nova-quick-quality",E="."+O,S=document.createElement("a"),L=O+"-list",V="#"+L,z=document.createElement("ul"),C=O+"-title",M=document.createElement("span"),$={highres:{label:"4320p",badge:"8K"},hd2880:{label:"2880p",badge:"5K"},hd2160:{label:"2160p",badge:"4K"},hd1440:{label:"1440p",badge:"QHD"},hd1080:{label:"1080p",badge:"FHD"},hd720:{label:"720p",badge:"ᴴᴰ"},large:{label:"480p"},medium:{label:"360p"},small:{label:"240p"},tiny:{label:"144p"},auto:{label:"auto"}};function r(){(qualityList=document.getElementById(L))&&(qualityList.innerHTML="",movie_player.getAvailableQualityLevels().forEach((t=>{const a=document.createElement("li");if(qualityData=$[t]){if(a.textContent=qualityData.label,badge=qualityData.badge){const e=document.createElement("span");e.className="quality-menu-item-label-badge",e.textContent=badge,a.append(e)}if(movie_player.getPlaybackQuality()==t)a.className="active";else{const n="watch"==NOVA.currentPage||e["embed-popup"]&&NOVA.queryURL.has("popup")?screen.width:window.innerWidth;(NOVA.extractAsNum.int(qualityData.label)||0)<=1.3*n?a.addEventListener("click",(()=>{movie_player.setPlaybackQualityRange(t,t)}),{capture:!0}):(a.className="disable",a.title="Max (window viewport + 30%)")}qualityList.append(a)}})))}NOVA.css.push(E+` {\noverflow: visible !important;\nposition: relative;\ntext-align: center !important;\nvertical-align: top;\nfont-weight: bold;\n}\n${V} {\nposition: absolute;\nbottom: 2.5em !important;\nleft: -2.2em;\nlist-style: none;\npadding-bottom: 1.5em !important;\nz-index: ${1+Math.max(NOVA.css.get(".ytp-progress-bar","z-index"),31)};\n}\nhtml[data-cast-api-enabled] ${V} {\nmargin: 0;\npadding: 0;\nbottom: 3.3em;\n}\n.ytp-big-mode .ytp-menuitem-toggle-checkbox {\nwidth: 3.5em;\nheight: 1.6em;\n}\n${E}:not(:hover) ${V} {\ndisplay: none;\n}\n${V} li {\ncursor: pointer;\nwhite-space: nowrap;\nline-height: 1.4;\nbackground-color: rgba(28, 28, 28, 0.9);\nmargin: .3em 0;\npadding: .5em 3em;\nborder-radius: .3em;\ncolor: white;\n}\n${V} li .quality-menu-item-label-badge {\nposition: absolute;\nright: 1em;\nwidth: 1.7em;\n}\n${V} li.active { background-color: #720000; }\n${V} li.disable { color: #666; }\n${V} li:hover:not(.active) { background-color: #c00; }`),S.className=`ytp-button ${t} ${O}`,M.id=C,M.textContent=$[movie_player.getPlaybackQuality()]?.label||"[N/A]",z.id=L,movie_player.addEventListener("onPlaybackQualityChange",(e=>{document.getElementById(C).textContent=$[e]?.label||"[N/A]"})),S.prepend(M),S.append(z),n.prepend(S),r(),NOVA.videoElement?.addEventListener("loadeddata",r)}if(e.player_buttons_custom_items?.includes("clock")){const j=document.createElement("span");let P;function s(){P=setInterval((()=>{if("hidden"==document.visibilityState||movie_player.classList.contains("ytp-autohide"))return;const t=e.player_buttons_custom_clock_seconds?8:5,a=(new Date).toTimeString().slice(0,t);j.textContent=a}),1e3)}j.className="ytp-time-display",j.title="Now time",n.prepend(j),e.player_buttons_custom_clock_fullcreen?document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement?s():(clearInterval(P),j.textContent="")})):s()}if(e.player_buttons_custom_items?.includes("range-speed")){const T=document.createElement("input"),K="nova-range-speed-input",R="."+K;function c(t){!e.range_speed_unlimit&&t>2||(NOVA.videoElement.playbackRate=(+t).toFixed(2),d(t))}function d(e){T.title=`Speed (${e})`,T.setAttribute("tooltip",`Speed (${e})`)}NOVA.css.push(`${R}[type="range"] {\nheight: 100%;\n}`),T.className=`${t} ${K}`,T.title="Playback Rate",T.type="range",T.min=T.step=+e.rate_step||.1,T.max=e.range_speed_unlimit?+e.rate_default:2,T.value=NOVA.videoElement.playbackRate,d(NOVA.videoElement.playbackRate),NOVA.videoElement.addEventListener("ratechange",(function(){T.value=this.playbackRate,d(this.playbackRate)})),T.addEventListener("change",(({target:e})=>c(e.value))),T.addEventListener("wheel",(e=>{e.preventDefault();const t=NOVA.videoElement.playbackRate+T.step*Math.sign(e.wheelDelta);c(t),T.value=t}),{capture:!0}),n.prepend(T)}if(e.player_buttons_custom_items?.includes("toggle-speed")){const I=document.createElement("a"),D=e.player_buttons_custom_hotkey_toggle_speed||"KeyA",q="1x",H=()=>`Switch to ${NOVA.videoElement.playbackRate}>${I.textContent} (${D.replace("Key","")})`;let U={};function u(){if(Object.keys(U).length)B.set(U),U={},I.innerHTML=q;else{U="object"==typeof movie_player&&NOVA.videoElement.playbackRate%.25==0&&NOVA.videoElement.playbackRate<=2?{default:movie_player.getPlaybackRate()}:{html5:NOVA.videoElement.playbackRate};let e=Object.assign({},U);e[Object.keys(e)[0]]=1,B.set(e),I.textContent=U[Object.keys(U)[0]]+"x"}I.setAttribute("tooltip",H())}I.className=`ytp-button ${t}`,I.style.textAlign="center",I.style.fontWeight="bold",I.innerHTML=q,I.setAttribute("tooltip",H()),document.addEventListener("keyup",(e=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(1===D.length?e.key:e.code)===D&&u()})),I.addEventListener("click",u),NOVA.videoElement.addEventListener("ratechange",(function(){I.setAttribute("tooltip",H()),e["video-rate"]||NOVA.showOSD(this.playbackRate+"x")}));const B={set(e){e.hasOwnProperty("html5")||!movie_player?NOVA.videoElement.playbackRate=e.html5:movie_player.setPlaybackRate(e.default)}};function p(){Object.keys(U).length||(I.style.display=1===NOVA.videoElement?.playbackRate?"none":"")}n.prepend(I),p(),NOVA.videoElement?.addEventListener("ratechange",p),NOVA.videoElement?.addEventListener("loadeddata",(()=>{U={},I.textContent=q,p()}))}}))},options:{player_buttons_custom_items:{_tagName:"select",label:"Buttons","label:zh":"纽扣","label:ja":"ボタン","label:pl":"Przyciski",title:"[Ctrl+Click] to select several","title:zh":"[Ctrl+Click] 选择多个","title:ja":"「Ctrl+Click」して、いくつかを選択します","title:pl":"Ctrl+kliknięcie, aby zaznaczyć kilka",multiple:null,required:!0,size:7,options:[{label:"clock",value:"clock"},{label:"quick quality",value:"quick-quality","label:zh":"质量","label:ja":"品質","label:pl":"jakość"},{label:"range speed",value:"range-speed"},{label:"toggle speed",value:"toggle-speed","label:zh":"切换速度","label:ja":"トグル速度","label:pl":"szybkość"},{label:"card-switch",value:"card-switch"},{label:"screenshot",value:"screenshot","label:zh":"截屏","label:ja":"スクリーンショット"},{label:"picture-in-picture",value:"picture-in-picture","label:pl":"obraz w obrazie"},{label:"popup",value:"popup","label:zh":"弹出式播放器","label:ja":"ポップアッププレーヤー","label:pl":"w okienku"},{label:"rotate",value:"rotate","label:zh":"旋转","label:ja":"回転する","label:pl":"obróć"},{label:"aspect-ratio",value:"aspect-ratio"},{label:"watch later",value:"watch-later"},{label:"preview cover",value:"thumbnail","label:zh":"缩略图","label:ja":"サムネイル","label:pl":"miniaturka"}]},player_buttons_custom_hotkey_toggle_speed:{_tagName:"select",label:"Hotkey toggle speed","label:zh":"热键切换速度","label:ja":"速度を切り替えるためのホットボタン","label:pl":"Skrót przełączania prędkości",options:[{label:"none",value:!1},{label:"A",value:"KeyA",selected:!0},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"],"data-dependent":{player_buttons_custom_items:["toggle-speed"]}},player_buttons_custom_hotkey_rotate:{_tagName:"select",label:"Hotkey rotate",options:[{label:"none",value:!1},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR",selected:!0},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"],"data-dependent":{player_buttons_custom_items:["rotate"]}},player_buttons_custom_card_switch:{_tagName:"select",label:"Default card state",options:[{label:"show",value:!1,selected:!0},{label:"hide",value:!0}],"data-dependent":{player_buttons_custom_items:["card-switch"]}},player_buttons_custom_screenshot:{_tagName:"select",label:"Screenshot format",options:[{label:"png",value:"png",selected:!0},{label:"jpg",value:"jpg"},{label:"webp",value:"webp"}],"data-dependent":{player_buttons_custom_items:["screenshot"]}},player_buttons_custom_screenshot_to_clipboard:{_tagName:"input",label:"Screenshot copy to clipboard",type:"checkbox","data-dependent":{player_buttons_custom_items:["screenshot"]}},player_buttons_custom_screenshot_subtitle_color:{_tagName:"input",type:"color",value:"#ffffff",label:"Screenshot subtitle color","data-dependent":{player_buttons_custom_items:["screenshot"]}},player_buttons_custom_screenshot_subtitle_shadow_color:{_tagName:"input",type:"color",value:"#000000",label:"Screenshot subtitle shadow color","data-dependent":{player_buttons_custom_items:["screenshot"]}},range_speed_unlimit:{_tagName:"input",label:"Range speed unlimit",type:"checkbox","data-dependent":{player_buttons_custom_items:["range-speed"]}},range_speed_unlimit:{_tagName:"input",label:"Range speed unlimit",type:"checkbox","data-dependent":{player_buttons_custom_items:["range-speed"]}},player_buttons_custom_clock_seconds:{_tagName:"input",label:"Clock show seconds",type:"checkbox","data-dependent":{player_buttons_custom_items:["clock"]}},player_buttons_custom_clock_fullcreen:{_tagName:"input",label:"Clock only fullscreen",type:"checkbox","data-dependent":{player_buttons_custom_items:["clock"]}}}}),window.nova_plugins.push({id:"save-channel-state",title:'Add button "Save params for the channel"',"title:zh":"특정 채널에 저장","title:ja":"特定のチャンネル用に保存","title:pl":"Zapisz dla określonego kanału",run_on_pages:"watch, embed",section:"control-panel",_runtime:e=>{const t="nova-channels-state",a="#"+t,n="nova-right-custom-button",l=n+"-list",o="#"+l,i=n+"-title";function r(e){document.getElementById(i).style.setProperty("opacity",e?1:.3)}function s(){const t=document.createElement("ul");t.id=l;let a=[];if(a.push({name:"subtitles",getCurrentState:()=>(movie_player.toggleSubtitlesOn(),!0),customApply:()=>{document.addEventListener("playing",(()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||movie_player.toggleSubtitlesOn()}),{capture:!0,once:!0})}}),e["video-quality"]&&a.push({name:"quality",getCurrentState:movie_player.getPlaybackQuality}),e["video-rate"]&&a.push({name:"speed",getCurrentState:()=>NOVA.videoElement.playbackRate}),e["video-volume"]&&a.push({name:"volume",getCurrentState:()=>Math.round(movie_player.getVolume())}),e["player-resume-playback"]&&a.push({name:"ignore-playback",label:"unsave playback time",getCurrentState:()=>!0}),e["player-loop"]&&a.push({name:"loop"}),e.transcript&&a.push({name:"transcript"}),e["video-zoom"]&&a.push({name:"zoom",getCurrentState:()=>NOVA.extractAsNum.float(document.body.querySelector(".html5-video-container").style.transform)}),a.forEach((async e=>{const a=NOVA.storage_obj_manager._getParam(e.name),n=document.createElement("input");n.type="checkbox",n.id=`checkbox-${e.name}`,n.checked=Boolean(a),n.className="ytp-menuitem-toggle-checkbox";const l=document.createElement("li");l.innerHTML=`<label for="checkbox-${e.name}">\n${e.label||e.name} <span>${a||""}</span>\n</label>`,l.title=a?`Currently stored value ${a}`:"none",Boolean(a)&&e.hasOwnProperty("customApply")&&"function"==typeof e.customApply&&e.customApply(),n.addEventListener("change",(()=>{let t;n.checked&&(t=!e.hasOwnProperty("getCurrentState")||e.getCurrentState())?NOVA.storage_obj_manager.save({[e.name]:t}):NOVA.storage_obj_manager.remove(e.name),l.title=t?`Currently stored value ${t}`:"none",l.querySelector("span").textContent=t||"",r(Boolean(t))})),l.prepend(n),t.append(l)})),e["time-jump"]){const o="skip into",i="skip-into",s=+NOVA.storage_obj_manager._getParam(i),c=document.createElement("input");c.type="range",c.min=0,c.max=120,c.step=1,c.value=s||0;const d=document.createElement("li");function n({target:e}){(state=+e.value)?NOVA.storage_obj_manager.save({[i]:+e.value}):NOVA.storage_obj_manager.remove(i),d.title=state?`Currently stored value ${state}`:"none",d.querySelector("span").textContent=state||"",r(Boolean(state))}d.innerHTML=`<label for="checkbox-${i}">\n${o} <span>${s||""}</span>\n</label>`,d.title="Simple alternative SponsorBlock",c.addEventListener("change",n),c.addEventListener("input",n),c.addEventListener("wheel",(e=>{e.preventDefault(),e.target.value=+e.target.value+Math.sign(e.wheelDelta),n(e)})),d.prepend(c),t.append(d)}return t}NOVA.waitSelector("#movie_player .ytp-right-controls").then((e=>{NOVA.css.push(a+` {\noverflow: visible !important;\nposition: relative;\ntext-align: center !important;\nvertical-align: top;\nfont-weight: bold;\n}\n.ytp-left-controls {\noverflow: visible !important;\n}\n${o} {\nposition: absolute;\nbottom: 2.5em !important;\nleft: -2.2em;\nlist-style: none;\npadding-bottom: 1.5em !important;\nz-index: calc(${+NOVA.css.get(".ytp-progress-bar","z-index")} + 1);\n}\nhtml[data-cast-api-enabled] ${o} {\nmargin: 0;\npadding: 0;\nbottom: 3.3em;\n}\n${a}:not(:hover) ${o} {\ndisplay: none;\n}\n${o} li {\ncursor: pointer;\nwhite-space: nowrap;\nline-height: 1.4;\nbackground-color: rgba(28, 28, 28, .9);\nmargin: .3em 0;\npadding: .5em 1em;\nborder-radius: .3em;\ncolor: white;\ntext-align: left !important;\ndisplay: grid;\ngrid-template-columns: auto auto;\nalign-items: center;\njustify-content: start;\n}\n${o} li label {\ncursor: pointer;\npadding-left: 5px;\n}\n${o} li.active { background-color: #720000; }\n${o} li.disable { color: #666; }\n${o} li:not(:hover) { opacity: .8; }\n${o} li span:not(:empty):before { content: '('; }\n${o} li span:not(:empty):after { content: ')'; }\n${o} [type="checkbox"] {\nappearance: none;\noutline: none;\ncursor: pointer;\n}\n${o} [type="checkbox"]:checked {\nbackground-color: #f00;\n}\n${o} [type="checkbox"]:checked:after {\nleft: 20px;\nbackground-color: white;\n}`),NOVA.runOnPageLoad((async()=>{if("watch"==NOVA.currentPage||"embed"==NOVA.currentPage){if(await NOVA.storage_obj_manager.initStorage(),btn=document.getElementById(t))btn.append(s());else{const a=document.createElement("button");a.id=t,a.className=`ytp-button ${n}`,a.title="Save channel state";const l=document.createElement("span");l.id=i,l.style.display="flex",l.innerHTML='<svg width="100%" height="100%" viewBox="0 0 36 36">\n<g fill="currentColor">\n<path d="M23.4 24.2c-.3.8-1.1 1.4-2 1.4-.9 0-1.7-.6-2-1.4H9.3c-.3 0-.6-.3-.6-.6v-.3c0-.3.3-.6.6-.6h10.1c.3-.9 1.1-1.5 2.1-1.5s1.8.6 2.1 1.5h3.2c.3 0 .6.3.6.6v.3c0 .3-.3.6-.6.6h-3.4zm-7.7-5.3c-.3.9-1.1 1.5-2.1 1.5s-1.8-.6-2.1-1.5H9.3c-.3 0-.6-.3-.6-.6V18c0-.3.3-.6.6-.6h2.2c.3-.8 1.1-1.4 2.1-1.4s1.8.6 2.1 1.4h11.1c.3 0 .6.3.6.6v.3c0 .3-.3.6-.6.6H15.7zm7.9-5.4c-.3.8-1.1 1.4-2.1 1.4-.9 0-1.7-.6-2.1-1.4H9.3c-.3 0-.6-.3-.6-.6v-.3c0-.3.3-.6.6-.6h10.1c.3-.9 1.1-1.6 2.1-1.6s1.9.7 2.1 1.6h3.1c.3 0 .6.3.6.6v.3c0 .3-.3.6-.6.6h-3.1z" />\n</g>\n</svg>',a.prepend(l),a.append(s()),e.prepend(a)}r(Boolean(NOVA.storage_obj_manager.read()))}}))}))}}),window.nova_plugins.push({id:"time-remaining",title:"Remaining time","title:zh":"剩余时间","title:ja":"余日","title:pl":"Pozostały czas",run_on_pages:"watch, embed, -mobile",section:"control-panel",desc:"Remaining time until the end of the video","desc:zh":"距离视频结束的剩余时间","desc:ja":"ビデオの終わりまでの残り時間","desc:pl":"Czas pozostały do końca filmu",_runtime:e=>{const t="nova-player-time-remaining";let a;if("description"===e.time_remaining_position)a="#title h1";else a=".ytp-time-duration, ytm-time-display .time-display-content";NOVA.waitSelector(a).then((a=>{function n(){if(isNaN(this.duration)||movie_player.getVideoData().isLive||"embed"==NOVA.currentPage&&document.URL.includes("live_stream")||"hidden"==document.visibilityState||"description"!=e.time_remaining_position&&movie_player.classList.contains("ytp-autohide"))return;const t=Math.trunc(this.currentTime),n=Math.trunc(this.duration),o=n-t,i=e=>(e=>this.duration>3600?e.toFixed(2):this.duration>1500?e.toFixed(1):Math.round(e))(e?100*o/n:100*t/n)+"%",r=()=>"-"+NOVA.formatTimeOut.HMS.digit(o/this.playbackRate),s=e.time_remaining_format.replace(/duration(\*speed)|left(\*speed|%)?|done(%)?|'([^']|'')*'/g,(e=>{let a;switch(e){case"left*speed":a=r();break;case"left":a=NOVA.formatTimeOut.HMS.digit(o);break;case"left%":a=i("L");break;case"done":a=t;break;case"done%":a=i();break;case"duration*speed":a=NOVA.formatTimeOut.HMS.digit(n/this.playbackRate);break;case"duration":a=n}return a}));s&&l({text:s,container:a})}function l({text:e="",container:a=required()}){if(!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);(document.getElementById(t)||function(){const e=document.createElement("span");return e.id=t,a.after(e),e}()).textContent=" "+e}NOVA.waitSelector("video").then((e=>{e.addEventListener("timeupdate",n.bind(e)),e.addEventListener("ratechange",n.bind(e)),e.addEventListener("ended",(()=>l({container:a}))),document.addEventListener("yt-navigate-finish",(()=>l({container:a})))}))}))},options:{time_remaining_format:{_tagName:"select",label:"Time pattern",options:[{label:"left*speed",value:"left*speed",selected:!0},{label:"left*speed (done%)",value:"left*speed (done%)"},{label:"left*speed (left%)",value:"left*speed (left%)"},{label:"left",value:"left"},{label:"left%",value:"left%"},{label:"done%",value:"done%"},{label:"left/left*speed",value:"left/left*speed (done%)"},{label:"left*speed/duration*speed (done%)",value:"left*speed/duration*speed (done%)"}]},time_remaining_position:{_tagName:"select",label:"Render position",options:[{label:"player",value:"player",selected:!0},{label:"description",value:"description"}]}}}),window.nova_plugins.push({id:"embed-show-control-force",title:"Force enable control panel (for embed)","title:zh":"埋め込みでコントロール パネルを強制的に有効にする","title:ja":"强制启用嵌入的控制面板","title:pl":"Wymuś włączenie panelu sterowania w osadzeniu",run_on_pages:"embed",section:"control-panel",_runtime:e=>{const t=location.href.replace(/&amp;/g,"&");["0","false"].includes(NOVA.queryURL.get("controls",t))&&NOVA.updateUrl(NOVA.queryURL.remove("controls",t))}}),window.nova_plugins.push({id:"time-jump",title:"Jump time/chapter","title:zh":"时间跳跃","title:ja":"タイムジャンプ","title:pl":"Skok czasowy",run_on_pages:"watch, embed, -mobile",section:"control-panel",desc:"Use to skip the intro or ad inserts","desc:zh":"用于跳过介绍或广告插入","desc:ja":"イントロや広告挿入をスキップするために使用します","desc:pl":"Służy do pomijania wstępu lub wstawek reklamowych",_runtime:e=>{function t(t=10){if(!t&&!e.skip_into_sec_in_music&&NOVA.isMusic())return;e["player-resume-playback"]&&(saveTime=+sessionStorage.getItem("resume-playback-time:"+(NOVA.queryURL.get("v")||movie_player.getVideoData().video_id)))&&saveTime>this.duration-3||(isNaN(this.duration)||this.duration>30)&&this.currentTime<+t&&(this.currentTime=+t)}e.time_jump_title_offset&&(NOVA.css.push(".ytp-tooltip-text:after {\ncontent: attr(data-before);\ncolor: #ffcc00;\n}"),NOVA.waitSelector(".ytp-progress-bar").then((e=>{(tooltipEl=document.body.querySelector(".ytp-tooltip-text"))&&(e.addEventListener("mousemove",(()=>{if(movie_player.getVideoData().isLive||"embed"==NOVA.currentPage&&document.URL.includes("live_stream"))return;const e=NOVA.formatTimeOut.hmsToSec(tooltipEl.textContent)-NOVA.videoElement?.currentTime,t=e>=1?"+":-1===Math.sign(e)?"-":"";tooltipEl.setAttribute("data-before",` ${t+NOVA.formatTimeOut.HMS.digit(e)}`)})),e.addEventListener("mouseleave",(()=>tooltipEl.removeAttribute("data-before"))))}))),NOVA.waitSelector("#movie_player video").then((t=>{let a;function n(e){if("function"==typeof movie_player.seekBy)movie_player.seekTo(e);else{if(!NOVA.videoElement){const e='[time-jump] > "seekTime" detect player error';throw console.error(e),e}NOVA.videoElement.currentTime=e}}t.addEventListener("loadeddata",(()=>a=[])),function(e=required(),t=required()){let a,n,l,o=t;function i(i){if(!["input","textarea","select"].includes(i.target.localName)&&!i.target.isContentEditable){if(a=1===t.length||["Control","Shift"].includes(t)?i.key:i.code,n&&l===i.which&&a===o){if(n=!1,e&&"function"==typeof e)return e(i)}else n=!0,setTimeout((()=>n=!1),500);t||(o=a),l=i.which}}document.addEventListener("keyup",i)}((function(){if(movie_player.getVideoData().isLive||"embed"==NOVA.currentPage&&document.URL.includes("live_stream"))return;null===a||a?.length||(a=NOVA.getChapterList(movie_player.getDuration())||null);const t=movie_player.getCurrentTime(),l=a?.findIndex((e=>e.sec>t));let o;if(a?.length&&-1!==l){const e=a?.find((({sec:e})=>e>=t));n(e.sec+.5),o=e.title+" • "+e.time}else n(+e.time_jump_step+t),o=`+${e.time_jump_step} sec • `+NOVA.formatTimeOut.HMS.digit(t);NOVA.showOSD(o)}),e.time_jump_hotkey)})),e["save-channel-state"]?NOVA.waitSelector("#movie_player video").then((e=>{NOVA.runOnPageLoad((async()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||+sessionStorage.getItem("nova-resume-playback-time:"+(NOVA.queryURL.get("v")||movie_player.getVideoData().video_id))||NOVA.queryURL.has("t")||NOVA.queryURL.getHashParam("t")||!(userSeek=await NOVA.storage_obj_manager.getParam("skip-into"))||e.addEventListener("playing",t.apply(e,[userSeek]),{capture:!0,once:!0})}))})):!+e.skip_into_sec||NOVA.queryURL.has("t")||NOVA.queryURL.getHashParam("t")||NOVA.waitSelector("#movie_player video").then((a=>{NOVA.runOnPageLoad((()=>{"watch"==NOVA.currentPage&&a.addEventListener("playing",t.bind(a,e.skip_into_sec),{capture:!0,once:!0})}))}))},options:{time_jump_step:{_tagName:"input",label:"Step time","label:ja":"ステップ時間","label:zh":"步骤时间","label:pl":"Krok czasowy",type:"number",title:"In seconds",placeholder:"sec",min:3,max:300,value:30},time_jump_hotkey:{_tagName:"select",label:"Hotkey (double click)","label:zh":"热键（双击）","label:ja":"Hotkey (ダブルプレス)","label:pl":"Klawisz skrótu (podwójne kliknięcie)",title:"by default【Ctrl + Arrows】",options:[{label:"Shift (any)",value:"Shift"},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"Ctrl (any)",value:"Control"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight",selected:!0},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"]},time_jump_title_offset:{_tagName:"input",label:"Show time offset on progress bar","label:zh":"在进度条中显示时间偏移","label:ja":"プログレスバーに時間オフセットを表示する","label:pl":"Pokaż przesunięcie czasu na pasku postępu",type:"checkbox",title:"Time offset from current playback time","title:zh":"与当前播放时间的时间偏移","title:ja":"現在の再生時間からの時間オフセット","title:pl":"Przesunięcie czasu względem bieżącego czasu odtwarzania"},skip_into_sec:{_tagName:"input",label:"Start playback at","label:zh":"设置开始时间","label:ja":"開始時刻を設定","label:pl":"Ustaw czas rozpoczęcia",type:"number",title:"in sec / 0 - disable",placeholder:"1-30",step:1,min:0,max:30,value:0},skip_into_sec_in_music:{_tagName:"input",label:"Apply for music genre",type:"checkbox","data-dependent":{skip_into_sec:"!0"}}}}),window.nova_plugins.push({id:"download-video",title:"Download video","title:zh":"下载视频","title:ja":"ビデオをダウンロードする",run_on_pages:"watch, -mobile",section:"control-panel",_runtime:user_settings=>{NOVA.waitSelector("#movie_player .ytp-right-controls").then((e=>{const t="nova-video-download",a="."+t,n=document.createElement("a"),l=t+"-list",o="#"+l,i=document.createElement("ul"),r=t+"-title",s="#"+r,c=document.createElement("span");async function d(){if(menuList=document.getElementById(l)){APIs.videoId=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id;const e=c.outerHTML;c.textContent="🕓";let t=[];switch(user_settings.download_video_mode){case"cobalt":t=APIs.Cobalt();break;case"loader.to":t=APIs.loaderTo();break;case"third_party_methods":t=APIs.third_party();break;case"direct":t=await APIs.getInternalListUrls()}t.filter((e=>e?.codec)).forEach(((e,t)=>{const a=document.createElement("li");e.quality?a.textContent=`${e.codec} / ${e.quality}`:a.textContent=e.codec,a.addEventListener("click",(()=>{e.custom_fn&&"function"==typeof e.custom_fn?e.custom_fn(e):e.link_new_tab?window.open(e.link_new_tab,"_blank"):downloadFile(e.link)}),{capture:!0}),menuList.append(a)})),c.innerHTML=e}}NOVA.runOnPageLoad((()=>{"watch"==NOVA.currentPage&&(n.removeEventListener("click",d),i.innerHTML="",n.addEventListener("click",d,{capture:!0,once:!0}))})),NOVA.css.push(`${s} {\ndisplay: block;\nheight: inherit;\n}\n${s}[tooltip]:hover::before {\ncontent: attr(tooltip);\nposition: absolute;\ntop: -3em;\ntransform: translateX(-30%);\nline-height: normal;\nbackground-color: rgba(28,28,28,.9);\nborder-radius: .3em;\npadding: 5px 9px;\ncolor: white;\nfont-weight: bold;\nwhite-space: nowrap;\n}\nhtml[data-cast-api-enabled] ${s}[tooltip]:hover::before {\nfont-weight: normal;\n}`),NOVA.css.push(a+` {\noverflow: visible !important;\nposition: relative;\ntext-align: center !important;\nvertical-align: top;\nfont-weight: bold;\n}\n${a}:hover { color: #66afe9 !important; }\n${a}:active { color: #2196f3 !important; }\n${o} {\nposition: absolute;\nbottom: 2.5em !important;\nleft: -2.2em;\nlist-style: none;\npadding-bottom: 1.5em !important;\nz-index: ${1+Math.max(NOVA.css.get(".ytp-progress-bar","z-index"),31)};\n}\nhtml[data-cast-api-enabled] ${o} {\nmargin: 0;\npadding: 0;\nbottom: 3.3em;\n}\n${a}:not(:hover) ${o} {\ndisplay: none;\n}\n${o} li {\ncursor: pointer;\nwhite-space: nowrap;\nline-height: 1.4;\nbackground-color: rgba(28, 28, 28, .9);\nmargin: .1em 0;\npadding: .5em 2em;\nborder-radius: .3em;\ncolor: white;\n}\n${o} li:hover { background-color: #c00; }`),n.className=`ytp-button ${t} ${t}`,c.id=r,c.setAttribute("tooltip","Nova video download 🡇"),c.innerHTML='<svg viewBox="0 0 120 120" width="100%" height="100%" style="scale: .6;">\n<g fill="currentColor">\n<path d="M96.215 105h-72.18c-3.33 0-5.94-2.61-5.94-5.94V75.03c0-3.33 2.61-5.94 5.94-5.94 3.33 0 5.94 2.61 5.94 5.94v18h60.03v-18c0-3.33 2.61-5.94 5.94-5.94 3.33 0 5.94 2.61 5.94 5.94v24.03c.27 3.33-2.34 5.94-5.67 5.94Zm-32.4-34.47c-2.07 1.89-5.4 1.89-7.56 0l-18.72-17.19c-2.07-1.89-2.07-4.86 0-6.84 2.07-1.98 5.4-1.89 7.56 0l8.91 8.19V20.94c0-3.33 2.61-5.94 5.94-5.94 3.33 0 5.94 2.61 5.94 5.94V54.6l8.91-8.19c2.07-1.89 5.4-1.89 7.56 0 2.07 1.89 2.07 4.86 0 6.84l-18.54 17.28Z" />\n</g>\n</svg>',i.id=l,n.prepend(c),n.append(i),e.prepend(n)}));const APIs={getQualityAvailableList(){const e={highres:4320,hd2880:2880,hd2160:2160,hd1440:1440,hd1080:1080,hd720:720,large:480,medium:360,small:240,tiny:144};return movie_player.getAvailableQualityData().map((t=>e[t.quality]))},Cobalt(){const e=this.getQualityAvailableList();let t=[];return["h264","vp9"].forEach((n=>{e.forEach((e=>{t.push({codec:n.toLocaleUpperCase(),quality:e,data:{vCodec:n,vQuality:String(e)},custom_fn:a})}))})),[...t,{codec:"mp3",data:{isAudioOnly:!0,cCodec:"mp3"},custom_fn:a},{codec:"ogg",data:{isAudioOnly:!0,cCodec:"ogg"},custom_fn:a},{codec:"wav",data:{isAudioOnly:!0,cCodec:"wav"},custom_fn:a},{codec:"opus",data:{isAudioOnly:!0,cCodec:"opus"},custom_fn:a}];async function a(e){const t=await fetch("https://co.wuk.sh/api/json",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({url:encodeURI("https://www.youtube.com/watch?v="+APIs.videoId),filenamePattern:"basic",disableMetadata:!0,isNoTTWatermark:!0,...e.data})}).then((e=>e.json())).then((e=>e.url)).catch((e=>{console.warn(`Cobalt API: failed fetching: ${e}`)}));if(!t)return console.debug("CobaltAPI empty dlink:",t);downloadFile(t)}},loaderTo(){const e=e=>`https://loader.to/api/button/?url=${APIs.videoId}&f=${e}&color=0af`,t=this.getQualityAvailableList()?.filter((e=>e>240));let a=[];return["MP4"].forEach((l=>{t.forEach((t=>{a.push({codec:l.toLocaleUpperCase(),quality:t,link:e(t),custom_fn:n})}))})),[...a,{codec:"WEBM",quality:"4K",link:e("4k"),custom_fn:n},{codec:"WEBM",quality:"8K",link:e("8k"),custom_fn:n},{codec:"MP3",link:e("mp3"),custom_fn:n},{codec:"M4A",link:e("m4a"),custom_fn:n},{codec:"WEBM",link:e("webm"),custom_fn:n},{codec:"AAC",link:e("aac"),custom_fn:n},{codec:"FLAC",link:e("flac"),custom_fn:n},{codec:"OPUS",link:e("opus"),custom_fn:n},{codec:"OGG",link:e("ogg"),custom_fn:n},{codec:"WAV",link:e("wav"),custom_fn:n}];function n(e){NOVA.openPopup({url:e.url,width:420,height:80})}},third_party:()=>[{quality:"mp3,mp4",codec:"yt-download.org",link_new_tab:"https://yt-download.org/api/widgetv2?url=https://www.youtube.com/watch?v="+APIs.videoId},{quality:"mp3,mp4",codec:"Y2Mate.tools",link_new_tab:"https://www.y2mate.com/youtube/"+APIs.videoId},{quality:"mp3,mp4",codec:"TubeMP3.to",link_new_tab:"https://tubemp3.to/"+APIs.videoId},{quality:"mp3,mp4",codec:"yloader.ws",link_new_tab:"https://yloader.ws/yturlmp4/"+APIs.videoId},{quality:"mp3,mp4,ogg",codec:"yt5s.com",link_new_tab:"https://yt5s.com/watch?v="+APIs.videoId},{quality:"mp3,mp4,ogg",codec:"x2download.app",link_new_tab:"https://x2download.app/watch?v="+APIs.videoId},{quality:"mp3,mp4,ogg",codec:"savefrom.net",link_new_tab:"https://savefrom.net/https://www.youtube.com/watch?v="+APIs.videoId},{quality:"mp3,mp4",codec:"yt1s.ltd",codec:"yt1s.com",link_new_tab:"https://yt1s.com/watch?v="+APIs.videoId},{quality:"MP3,MP4,M4A,MP4,MKV",codec:"clipconverter.cc",link_new_tab:"https://www.clipconverter.cc/3/?url=https://www.youtube.com/watch?v="+APIs.videoId},{quality:"mp3",codec:"conv2.be",link_new_tab:"https://conv2.be/watch?v="+APIs.videoId},{quality:"mp3",codec:"YTMP3X.com",link_new_tab:"https://ytmp3x.com/"+APIs.videoId}],async getInternalListUrls(){let decryptSigFn;const URL=NOVA.queryURL.set({pbj:1}),headers={"x-youtube-client-name":1,"x-youtube-client-version":window.ytcfg.data_.INNERTUBE_CONTEXT_CLIENT_VERSION};return(token=window.ytcfg?.data_?.ID_TOKEN)&&(headers["x-youtube-identity-token"]=token),await fetch(URL,{headers:headers}).then((e=>e.json())).then((e=>e?.find((e=>e.playerResponse?.streamingData))?.playerResponse.streamingData)).then((async e=>{console.debug("streamingData",e);const t=[...e.formats,...e.adaptiveFormats];return decryptSigFn=t.find((e=>e.cipher||e.signatureCipher))&&await getDecryptSigFn(),t.map((e=>{if((dict=parseQuery(e.cipher||e.signatureCipher))&&(e.url=`${dict.url}&${dict.sp}=${encodeURIComponent(decsig(dict.s))}`),e.url){let t=e.mimeType?.match(/codecs="(.*?)"/i)[1].split(".")[0].toLocaleUpperCase();return e.mimeType?.includes("mp4a")||e.mimeType?.includes("audio")||(t+=" / No Sound"),e.mimeType?.includes("audio")?e.qualityLabel=fmtBitrate(e.bitrate):e.qualityLabel+=" "+fmtSize(e.contentLength),{codec:t,quality:e.qualityLabel,link_new_tab:e.url}}}))})).catch((e=>{throw console.error("Error get vids:",e),e}));function parseQuery(e){return e&&Object.fromEntries(e.split(/&/).map((e=>{const[t,...a]=e.split("=");return[t,decodeURIComponent(a.join("="))]}))||[])}async function getDecryptSigFn(){const basejsUrl=getBasejs()||document.querySelector('script[src$="/base.js"]')?.src,basejsBlob=await fetch(basejsUrl);return parseDecSig(await basejsBlob.text());function getBasejs(){if("object"==typeof ytplayer&&(endpoint=ytplayer.config?.assets?.js||ytplayer.web_player_context_config?.jsUrl))return"https://"+location.host+endpoint}function parseDecSig(text_content){const escapeRegExp=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");try{if(text_content.startsWith("var script")){const obj={};eval(text_content),text_content=obj.innerHTML}const fnNameResult=/=([a-zA-Z0-9\$_]+?)\(decodeURIComponent/.exec(text_content),fnName=fnNameResult[1],_argNameFnBodyResult=new RegExp(escapeRegExp(fnName)+"=function\\((.+?)\\){((.+)=\\2.+?)}").exec(text_content),[_,argname,fnBody]=_argNameFnBodyResult,helperNameResult=/;([a-zA-Z0-9$_]+?)\..+?\(/.exec(fnBody),helperName=helperNameResult[1],helperResult=new RegExp("var "+escapeRegExp(helperName)+"={[\\s\\S]+?};").exec(text_content),helper=helperResult[0];return new Function([argname],helper+"\n"+fnBody)}catch(e){console.error("parseDecSig",e)}}}function decsig(_sig){const sig=eval("("+decryptSigFn+') ("'+_sig+'")');return sig}}};function downloadFile(e=required()){const t=document.createElement("a");t.style.display="none",t.download=movie_player.getVideoData().title.replace(/[\\/:*?"<>|]+/g,"").replace(/\s+/g," ").trim()+".mp4",t.href=e,document.body.append(t),t.click(),t.remove()}function fmtBitrate(e){return fmtSize(e,["kbps","Mbps","Gbps"],1e3)}function fmtSize(e,t=["kB","MB","GB"],a=1024){if(0===(e=Math.abs(+e)))return"n/a";e/=a;for(let a=0;a<t.length;++a){if(e<10)return Math.round(100*e)/100+t[a];if(e<100)return Math.round(10*e)/10+t[a];if(e<1e3||a==t.length-1)return Math.round(e)+t[a]}}function convertSizeToBytes(e){const t={B:1,KB:1024,MB:1048576,GB:1073741824},a=e.match(/^(\d+(?:\.\d+)?)\s*([A-Z]+)$/i);if(!a)return 0;const n=parseFloat(a[1]),l=a[2].toUpperCase();return t.hasOwnProperty(l)?n*t[l]:0}},options:{download_video_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"Cobalt",value:"cobalt",selected:!0},{label:"loader.to",value:"loader.to"},{label:"multi 3rd party",value:"third_party_methods"},{label:"direct",value:"direct"}]}}}),window.nova_plugins.push({id:"auto-likes",title:"Auto-like",run_on_pages:"watch, -mobile",section:"details-buttons",_runtime:e=>{if(e["details-buttons"]&&(e.details_buttons_hide?.includes("all")||e.details_buttons_hide.includes("like_dislike")))return;const t="ytd-watch-metadata #actions like-button-view-model button";NOVA.waitSelector("#movie_player video").then((n=>{n.addEventListener("loadeddata",(()=>{e.auto_likes_for_subscribed||movie_player.getVideoData().isLive?a.disable=!0:a.reset.bind(a)})),n.addEventListener("playing",a.start.bind(a,n.playbackRate)),n.addEventListener("pause",a.pause.bind(a)),n.addEventListener("timeupdate",(function(){a.disable||isNaN(this.duration)||+a.progressTime/this.duration>(Math.trunc(e.auto_likes_percent)/100||.8)&&(a.disable=!0,function(){const e=document.body.querySelector(t);a()||e.click();function a(){return"true"==e.getAttribute("aria-pressed")}}(),NOVA.showOSD("Auto-like is activation"))}))})),NOVA.runOnPageLoad((async()=>{"watch"==NOVA.currentPage&&(NOVA.waitSelector(`${t}[aria-pressed="true"]`,{destroy_after_page_leaving:!0}).then((()=>{a.disable||(a.disable=!0,NOVA.showOSD("Auto-like is deactivated"))})),e.auto_likes_for_subscribed&&NOVA.waitSelector("#subscribe-button [subscribed]",{destroy_after_page_leaving:!0}).then((()=>{a.disable=!1,NOVA.showOSD("Auto-like is enable")})))}));const a={progressTime:0,start(e=1){this.disable||(this.timer=setInterval((function(){a.progressTime+=1*e}),1e3))},pause(){"number"==typeof this.timer&&clearInterval(this.timer)},reset(){this.disable=!1,this.progressTime=0}}},options:{auto_likes_percent:{_tagName:"input",label:"Watch threshold in %","label:zh":"观察阈值（%）","label:ja":"監視しきい値 (%)","label:pl":"Próg oglądania w%",type:"number",title:"10-90%",title:"Percentage of views at which a video is liked","title:zh":"视频在时间进度后被点赞","title:ja":"時間の経過後にビデオが「いいね！」される",placeholder:"%",step:5,min:10,max:90,value:80},auto_likes_for_subscribed:{_tagName:"input",label:"Only for subscribed",type:"checkbox"}}}),window.nova_plugins.push({id:"video-date-format",title:"Date format display","title:zh":"显示日期格式","title:ja":"日付形式の表示",run_on_pages:"watch, -mobile",section:"details",opt_api_key_warn:!0,_runtime:e=>{const t="nova-video-date:",a="nova-video-published-date";NOVA.runOnPageLoad((async()=>{"watch"==NOVA.currentPage&&(await NOVA.waitUntil((()=>"object"==typeof movie_player),1e3),NOVA.waitSelector("#title h1",{destroy_after_page_leaving:!0}).then((n=>function(n=required()){const l=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id;if((storage=sessionStorage.getItem(t+l))&&storage.format==e.video_date_format)return o({text:storage.date,container:n});function o({text:e="",container:t=required()}){if(!(t instanceof HTMLElement))return console.error("container not HTMLElement:",t);(document.getElementById(a)||(()=>{const e=document.createElement("span");return e.id=a,e.className="style-scope yt-formatted-string bold",e.style.cssText="font-size: 1.35rem; line-height: 2rem; font-weight:400;",t.after(e),e})()).textContent=e}NOVA.request.API({request:"videos",params:{id:l,part:"snippet,liveStreamingDetails"+(e.video_view_count?",statistics":"")},api_key:e["user-api-key"]}).then((a=>{if(a?.error)return alert(`Error [${a.code}]: ${a.reason}\n`+a.error);a?.items?.forEach((a=>{let i=[];if(e.video_view_count&&a.statistics.viewCount)if("friendly"===e.video_view_count)i.push(NOVA.numberFormat.friendly(a.statistics.viewCount),"views");else i.push(NOVA.numberFormat.abbr(a.statistics.viewCount),"views");if(a.liveStreamingDetails)if(movie_player.getVideoData().isLive||"live"==a.snippet.liveBroadcastContent)i.push("Active Livestream",NOVA.dateFormat.apply(new Date(a.liveStreamingDetails.actualStartTime),[e.video_date_format]));else if(a.liveStreamingDetails.actualEndTime){const t=new Date(a.liveStreamingDetails.actualStartTime),n=new Date(a.liveStreamingDetails.actualEndTime),l=t.getDay()===n.getDay();i.push(document.body.querySelector("ytd-watch-flexy")?.playerData?.videoDetails?.isLiveContent?"Streamed":"Premiered"),l||i.push("from"),i.push(NOVA.dateFormat.apply(t,[e.video_date_format])),l||i.push("until",NOVA.dateFormat.apply(n,[e.video_date_format]))}else"upcoming"==a.snippet.liveBroadcastContent&&i.push("Scheduled",NOVA.dateFormat.apply(new Date(a.liveStreamingDetails.scheduledStartTime),[e.video_date_format]));else if(a.snippet.publishedAt){const t=new Date(a.snippet.publishedAt);"ago"==e.video_date_format?i.push(NOVA.formatTimeOut.ago(t),"ago"):i.push(NOVA.dateFormat.apply(t,[e.video_date_format]))}i.length&&(o({text:i.join(" "),container:n}),sessionStorage.setItem(t+l,JSON.stringify({date:i.join(" "),format:e.video_date_format})))}))}))}(n))))}))},options:{video_view_count:{_tagName:"select",label:"Show views count format",options:[{label:"disable",value:!1},{label:"9.9K",value:"abbr",selected:!0},{label:"9,999",value:"friendly"}]},video_date_format:{_tagName:"select",label:"Date pattern",options:[{label:"ago",value:"ago"},{label:"January 20, 1999",value:"MMMM D, YYYY"},{label:"20 Jan 1999",value:"D MMM YYYY"},{label:"20 Jan 1999 at 23:59",value:"D MMM YYYY at H:mm",selected:!0},{label:"Mon 20/01/1999 23:59",value:"DDD DD/MM/YYYY H:mm"},{label:"Monday 20/01/1999 23:59",value:"DDDD DD/MM/YYYY H:mm"},{label:"1999/01/20",value:"YYYY/MM/DD"},{label:"1999/01/20 at 23:59",value:"YYYY/MM/DD at H:mm"},{label:"1999-01-20",value:"YYYY-MM-D"},{label:"1999-01-20 at 23:59",value:"YYYY-MM-D at H:mm"},{label:"1999.1.20",value:"YYYY.M.D"},{label:"1999.1.20 at 23:59",value:"YYYY.M.D at H:mm"},{label:"01/20/1999",value:"MM/DD/YYYY"},{label:"01/20/1999 at 23:59",value:"MM/DD/YYYY at H:mm"},{label:"01-20-1999",value:"MM-D-YYYY"},{label:"01-20-1999 at 23:59",value:"MM-D-YYYY at H:mm"},{label:"01.20.1999",value:"MM.D.YYYY"},{label:"01.20.1999 at 23:59",value:"MM.D.YYYY at H:mm"}]}}}),window.nova_plugins.push({id:"transcript",title:"Show transcript",run_on_pages:"watch, -mobile",section:"details-buttons",_runtime:e=>{const t="nova-transcript-button",a="#"+t;switch(NOVA.runOnPageLoad((async()=>{if("watch"==NOVA.currentPage)if(await NOVA.storage_obj_manager.getParam("transcript"))NOVA.waitSelector(a,{destroy_after_page_leaving:!0}).then((t=>{switch(t.style.display="flex",e.transcript_visibility_mode){case"button":n();break;case"external":case"external-popup":l()}}));else if("expand"===e.transcript_visibility_mode)NOVA.waitSelector('[target-id="engagement-panel-searchable-transcript"][visibility="ENGAGEMENT_PANEL_VISIBILITY_HIDDEN"]',{destroy_after_page_leaving:!0}).then((e=>{e.setAttribute("visibility","ENGAGEMENT_PANEL_VISIBILITY_EXPANDED")}));else NOVA.waitSelector(a,{destroy_after_page_leaving:!0}).then((e=>{e.style.display=document.body.querySelector('#description ytd-video-description-transcript-section-renderer button, [target-id="engagement-panel-searchable-transcript"]')?"flex":"none"}))})),e.transcript_visibility_mode){case"button":NOVA.waitSelector("ytd-watch-metadata #actions #top-level-buttons-computed").then((e=>{o({container:e,position:"beforebegin"}).addEventListener("click",n)}));break;case"external":case"external-popup":NOVA.waitSelector("ytd-watch-metadata #actions #top-level-buttons-computed").then((e=>{o({container:e,position:"beforebegin"}).addEventListener("click",l)}))}function n(){(btn=document.body.querySelector("#description ytd-video-description-transcript-section-renderer button"))?btn.click():(transcriptEl=document.body.querySelector('[target-id="engagement-panel-searchable-transcript"][visibility="ENGAGEMENT_PANEL_VISIBILITY_HIDDEN"]'))&&transcriptEl.setAttribute("visibility","ENGAGEMENT_PANEL_VISIBILITY_EXPANDED")}function l(){const t="https://www.youtubetranscript.com/"+location.search;window.open(t,"_blank","external-popup"==e.transcript_visibility_mode?"popup=1,toolbar=no,location=no,directories=no,status=no,menubar=no,resizable=yes,copyhistory=no":"")}function o({container:e=required(),position:n="beforebegin"}){return e instanceof HTMLElement?document.getElementById(t)||(NOVA.css.push(`${a} {\nborder: 0;\ncursor: pointer;\ntext-decoration: none;\nfont-weight: bold;\nmargin: 0 var(--ytd-subscribe-button-margin, 12px);\n}`),e.insertAdjacentHTML(n,`<button id="${t}" style="display:flex" title="Show Transcript" class="style-scope yt-formatted-string bold yt-spec-button-shape-next--tonal yt-spec-button-shape-next--mono yt-spec-button-shape-next--size-m">\n<span class="yt-spec-button-shape-next__icon" style="height:100%">\n<svg viewBox="0 0 24 24" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M20 12V13C20 17.4183 16.4183 21 12 21C7.58172 21 4 17.4183 4 13V12M12 17C9.79086 17 8 15.2091 8 13V7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7V13C16 15.2091 14.2091 17 12 17Z" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</g>\n</svg>\n</span>\n<span class="yt-spec-button-shape-next__button-text-content" style="align-self:center;">Transcript</span>\n</button>`),document.getElementById(t)):console.error("container not HTMLElement:",e)}},options:{transcript_visibility_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"expand default section",selected:!0},{label:"add button",value:"button"},{label:"link to external",value:"external"},{label:"link to external (popup)",value:"external-popup"}]}}}),window.nova_plugins.push({id:"video-title-hashtag",title:"Title hashtag",run_on_pages:"watch",section:"details",_runtime:e=>{let t={};if("uncolorize"===e.title_hashtag_visibility_mode)t.color="var(--yt-endpoint-color, var(--yt-spec-text-primary))";else t.display="none";Object.keys(t).length&&NOVA.css.push(t,'h1 a[href*="/hashtag/"]',"important")},options:{title_hashtag_visibility_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"hide",selected:!0},{label:"uncolorize",value:"uncolorize"}]}}}),window.nova_plugins.push({id:"channel-videos-count",title:"Show channel videos count","title:zh":"显示频道上的视频数量","title:ja":"チャンネルの動画数を表示する","title:pl":"Pokaż liczbę filmów na kanale",run_on_pages:"watch, -mobile",restart_on_location_change:!0,section:"details",opt_api_key_warn:!0,desc:"Display uploaded videos on channel","desc:zh":"在频道上显示上传的视频","desc:ja":"アップロードした動画をチャンネルに表示","desc:pl":"Wyświetla przesłane filmy na kanale",_runtime:e=>{const t="nova-channel-videos-count:",a="nova-video-count";NOVA.waitSelector("#upload-info #owner-sub-count, ytm-slim-owner-renderer .subhead",{destroy_after_page_leaving:!0}).then((n=>async function(n=required()){await NOVA.delay(500);const l=NOVA.getChannelId();if(!l)return console.error("setVideoCount channelId: empty",l);(storage=sessionStorage.getItem(t+l))?o({text:storage,container:n}):NOVA.request.API({request:"channels",params:{id:l,part:"statistics"},api_key:e["user-api-key"]}).then((e=>{if(e?.error)return alert(`Error [${e.code}]: ${e.reason}\n`+e.error);e?.items?.forEach((e=>{(videoCount=NOVA.numberFormat.abbr(e.statistics.videoCount))?(o({text:videoCount,container:n}),sessionStorage.setItem(t+l,videoCount)):console.warn("API is change",e)}))}));function o({text:e="",container:t=required()}){if(!(t instanceof HTMLElement))return console.error("container not HTMLElement:",t);(document.getElementById(a)||(t.insertAdjacentHTML("beforeend",`<span class="date style-scope ytd-video-secondary-info-renderer" style="margin-right:5px;"> • <span id="${a}">${e}</span> videos</span>`),document.getElementById(a))).textContent=e,t.title=`${e} videos`}}(n)))}}),window.nova_plugins.push({id:"save-to-playlist",title:'Add sort/filter to "Save to playlist" menu',"title:zh":"将排序/过滤器添加到“保存到播放列表”菜单","title:ja":"「プレイリストに保存」メニューにソート/フィルターを追加","title:pl":"Dodaj sortowanie/filtr do menu „Zapisz na liście odtwarzania”.",run_on_pages:"home, feed, results, channel, watch, -mobile",section:"details-buttons",_runtime:e=>{function t(e=required()){if(!(e instanceof HTMLElement))return console.error("playlists not HTMLElement:",e);e.append(...Array.from(e.childNodes).sort((function(e,t){const a=e=>e.innerText.trim();return function(e=required(),t=required()){return e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})}(a(e),a(t))})))}NOVA.waitSelector("tp-yt-paper-dialog #playlists").then((a=>{const n=a.closest("tp-yt-paper-dialog");new IntersectionObserver((([l])=>{const o=n.querySelector("input[type=search]");l.isIntersecting?(e.save_to_playlist_sort&&t(a),o||function(a=required()){if(!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);const n=document.createElement("input");n.setAttribute("type","search"),n.setAttribute("placeholder","Playlists Filter"),Object.assign(n.style,{padding:".4em .6em",border:0,outline:0,"min-width":"250px",width:"100%",height:"2.5em",color:"var(--ytd-searchbox-text-color)","background-color":"var(--ytd-searchbox-background)"}),["change","keyup"].forEach((e=>{n.addEventListener(e,(function(){NOVA.searchFilterHTML({keyword:this.value,filter_selectors:"#playlists #checkbox",highlight_selector:"#label"})})),n.addEventListener("click",(()=>{n.value="",n.dispatchEvent(new Event("change"))}))}));const l=document.createElement("div");if(Object.assign(l.style,{"margin-top":".5em",display:"flex",gap:"10px"}),!e.save_to_playlist_sort){const e=document.createElement("button");e.textContent="A-Z ↓",Object.assign(e.style,{padding:".4em .6em",border:0,outline:0,"border-radius":"4px",color:"var(--ytd-searchbox-text-color)","background-color":"var(--ytd-searchbox-background)","white-space":"nowrap",cursor:"pointer"}),e.addEventListener("click",(()=>{e.remove(),t(document.body.querySelector("tp-yt-paper-dialog #playlists"))}),{capture:!0,once:!0}),l.append(e)}l.append(n),a.append(l)}(document.body.querySelector("ytd-add-to-playlist-renderer #header ytd-menu-title-renderer"))):o&&(o.value="",o.dispatchEvent(new Event("change")))})).observe(n)}))},options:{save_to_playlist_sort:{_tagName:"input",label:"Default sorting alphabetically","label:zh":"默认按字母顺序排序","label:ja":"デフォルトのアルファベット順のソート","label:pl":"Domyślne sortowanie alfabetyczne",type:"checkbox"}}}),window.nova_plugins.push({id:"description-popup",title:"Description section in popup","title:zh":"弹出窗口中的描述部分","title:ja":"ポップアップの説明セクション","title:pl":"Opis w osobnym oknie",run_on_pages:"watch, -mobile",section:"details","plugins-conflict":"description-timestamps-scroll",_runtime:e=>{const t="html:not(:fullscreen) ytd-watch-metadata #description.ytd-watch-metadata:not([hidden]):not(:empty)",a="nova-description-date";let n;NOVA.waitSelector("#masthead-container").then((a=>{NOVA.css.push(`${t},\n${t}:before {\nposition: fixed;\ntop: ${a.offsetHeight||56}px;\nright: 0;\nz-index: ${1+Math.max(getComputedStyle(a||movie_player)["z-index"],601)};\n}\n${t}:not(:hover):before {\ncontent: "info ▼";\ncursor: pointer;\nvisibility: visible;\nright: 12.5em;\npadding: 0 8px 2px;\nline-height: normal;\nfont-family: Roboto, Arial, sans-serif;\nfont-size: 11px;\ncolor: #eee;\nbackground-color: rgba(0, 0, 0, .3);\n}\n${t} {\nmargin: 0 1%;\noverflow-y: auto;\nmax-height: 88vh;\nmax-width: 55%;\nbackground-color: var(--yt-spec-brand-background-primary);\nbackground-color: var(--yt-spec-menu-background);\nbackground-color: var(--yt-spec-raised-background);\ncolor: var(--yt-spec-text-primary);;\nborder: 1px solid #333;\n${e["square-avatars"]?"border-radius: 0":""};\n}\n${t}:not(:hover) {\nvisibility: collapse;\noverflow: hidden;\n}\n${t}:hover {\nvisibility: visible !important;\n}\n${t}::-webkit-scrollbar {\nheight: 8px;\nwidth: 10px;\n}\n${t}::-webkit-scrollbar-button {\nheight: 0;\nwidth: 0;\n}\n${t}::-webkit-scrollbar-corner {\nbackground-color: transparent;\n}\n${t}::-webkit-scrollbar-thumb {\nbackground-color: #e1e1e1;\nborder: 0;\nborder-radius: 0;\n}\n${t}::-webkit-scrollbar-track {\nbackground-color: #666;\nborder: 0;\nborder-radius: 0;\n}\n${t}::-webkit-scrollbar-track:hover {\nbackground-color: #666;\n}`)})),NOVA.waitSelector(t).then((e=>{e.addEventListener("mouseenter",(e=>{document.body.querySelector("#meta [collapsed] #more, [description-collapsed] #description #expand")?.click()}))})),e["video-date-format"]||NOVA.runOnPageLoad((()=>"watch"==NOVA.currentPage&&function(){function e({text:e="",container:t=required()}){if(!(t instanceof HTMLElement))return console.error("container not HTMLElement:",t);(document.getElementById(a)||function(){const e=document.createElement("span");return e.id=a,e.className="style-scope yt-formatted-string bold",e.style.cssText="font-size: 1.35rem; line-height: 2rem; font-weight:400;",t.after(e),e}()).textContent=e}NOVA.waitSelector("#title h1").then((t=>{NOVA.waitSelector("ytd-watch-metadata #description.ytd-watch-metadata").then((async a=>{await NOVA.waitUntil((()=>{if((text=[...a.querySelectorAll("span.bold.yt-formatted-string:not(:empty)")].map((e=>e.textContent))?.join("").trim())&&text!=n)return n=text,e({text:n,container:t}),!0}),1e3)}))}))}()))}}),window.nova_plugins.push({id:"details-buttons-visibility",title:"Buttons hide","title:zh":"按钮隐藏","title:ja":"ボタンを非表示にする",run_on_pages:"watch, -mobile",section:"details-buttons",_runtime:e=>{const t="ytd-watch-metadata #actions";e.details_buttons_hide?.length&&(stylesList=function(){let a=[];e.details_buttons_hide?.includes("subscribe")&&a.push("#owner #subscribe-button");e.details_buttons_hide.includes("join")&&a.push("#sponsor-button");if(e.details_buttons_hide?.includes("all"))return a.push(`${t} button`),a;e.details_buttons_hide.includes("like_dislike")?a.push(`${t} segmented-like-dislike-button-view-model`):e.details_buttons_hide.includes("dislike")&&(a.push(`${t} dislike-button-view-model, ${t} .yt-spec-button-shape-next--segmented-start::after`),NOVA.css.push(`${t} segmented-like-dislike-button-view-model button {\nborder-radius: 20px;\n}`));e.details_buttons_hide.includes("download")&&(a.push(`${t} ytd-download-button-renderer`),NOVA.css.push("#flexible-item-buttons { width: inherit; }"));if(CSS.supports("selector(:has(*))")){const n=[`${t} ytd-button-renderer`,`${t} button`,"ytd-popup-container ytd-menu-service-item-renderer"];e.details_buttons_hide.includes("share")&&a.push(n.map((e=>`\n${e}:has(path[d^="M15 5.63 20.66"])`))),e.details_buttons_hide.includes("thanks")&&a.push(n.map((e=>`\n${e}:has(path[d^="M11 17h2v-1h1c.55"])`))),e.details_buttons_hide.includes("clip")&&a.push(n.map((e=>`\n${e}:has(path[d^="M8 7c0 .55-.45"])`))),e.details_buttons_hide.includes("save")&&a.push(n.map((e=>`\n${e}:has(path[d^="M22 13h-4v4h"])`))),e.details_buttons_hide.includes("report")&&a.push(n.map((e=>`\n${e}:has(path[d^="m13.18 4 .24 "])`))),e.details_buttons_hide.includes("transcript")&&a.push(n.map((e=>`\n${e}:has(path[d^="M5,11h2v2H5V11z"])`)))}return a}())&&stylesList.length&&NOVA.css.push(stylesList.join(",\n")+" {\ndisplay: none !important;\nbackground-color: red;\n}");let a="";e.details_buttons_label_hide&&(a+=`${t} button [class*=text] {\ndisplay: none;\n}\n${t} button .yt-spec-button-shape-next__icon {\nmargin: 0 !important;\n}\n${t} segmented-like-dislike-button-view-model button,\n${t} segmented-like-dislike-button-view-model ~ * button,\n${t} button.yt-spec-button-shape-next--size-m {\npadding: 0 7px;\n}\n${t} ytd-menu-renderer[has-items] yt-button-shape.ytd-menu-renderer {\nmargin: 0 !important;\n}`),+e.details_buttons_opacity&&(a+=`#owner #subscribe-button:not(:hover),\n${t} #menu:not(:hover) {\ntransition: opacity .2s ease-in-out;\nopacity: ${e.details_buttons_opacity||.1};\n}`),a.length&&NOVA.css.push(a)},options:{details_buttons_label_hide:{_tagName:"input",label:"Buttons without labels","label:zh":"没有标签的按钮","label:ja":"ラベルのないボタン","label:pl":"Guziki bez etykiet",type:"checkbox",title:'Requires support for css tag ":has()"'},details_buttons_opacity:{_tagName:"input",label:"Opacity","label:zh":"不透明度","label:ja":"不透明度","label:pl":"Przejrzystość",type:"number",title:"0 - disable",placeholder:"0-1",step:.05,min:0,max:1,value:.9},details_buttons_hide:{_tagName:"select",label:"Hide items",title:"[Ctrl+Click] to select several","title:zh":"[Ctrl+Click] 选择多个","title:ja":"「Ctrl+Click」して、いくつかを選択します","title:pl":"Ctrl+kliknięcie, aby zaznaczyć kilka",multiple:null,size:8,options:[{label:"subscribe",value:"subscribe"},{label:"join",value:"join"},{label:"all (below)",value:"all"},{label:"like+dislike",value:"like_dislike"},{label:"dislike",value:"dislike"},{label:"share",value:"share"},{label:"clip",value:"clip"},{label:"save",value:"save"},{label:"download",value:"download"},{label:"thanks",value:"thanks"},{label:"report",value:"report"},{label:"transcript",value:"transcript"}]}}}),window.nova_plugins.push({id:"redirect-disable",title:"Clear links from redirect","title:zh":"清除重定向中的链接","title:ja":"リダイレクトからリンクをクリアする","title:pl":"Wyczyść linki z przekierowań",run_on_pages:"watch, channel",section:"details",desc:"Direct external links","desc:zh":"直接链接到外部站点","desc:ja":"外部サイトへの直接リンク","desc:pl":"Bezpośrednie łącza zewnętrzne",_runtime:e=>{document.addEventListener("click",(e=>e.isTrusted&&a(e.target)),{capture:!0}),document.addEventListener("auxclick",(e=>e.isTrusted&&1===e.button&&a(e.target)),{capture:!0});const t='a[href*="/redirect?"]';function a(e=required()){(e.matches(t)||(e=e.parentElement.matches(t)))&&(q=NOVA.queryURL.get("q",e.href))&&(e.href=decodeURIComponent(q))}}}),window.nova_plugins.push({id:"description-timestamps-scroll",title:"Disable scroll to top on click timestamps","title:zh":"没有在时间戳上滚动到播放器","title:ja":"タイムスタンプでプレーヤーにスクロールしない","title:pl":"Brak przejścia do odtwarzacza na znacznikach czasu",run_on_pages:"watch, -mobile",section:"details",desc:"Disable scrolling to player when clicking on timestamps","desc:pl":"Wyłącza przewijanie do odtwarzacza podczas klikania znaczników czasu",_runtime:e=>{e["description-popup"]||document.addEventListener("click",(e=>{e.isTrusted&&e.target.matches('a[href*="&t="]')&&(sec=parseInt(NOVA.queryURL.get("t",e.target.href)))&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),movie_player.seekTo(sec))}),{capture:!0})}}),window.nova_plugins.push({id:"ad-state",title:"Show Ads info",run_on_pages:"watch, -mobile",restart_on_location_change:!0,section:"details",_runtime:e=>{const t="nova-monetization";NOVA.waitSelector("#title h1",{destroy_after_page_leaving:!0}).then((e=>{if(playerResponse=document.getElementById("page-manager")?.getCurrentData()?.playerResponse){let a=[];playerResponse?.paidContentOverlay&&a.push("Sponsored"),(adCount=playerResponse?.adPlacements?.length)&&a.push(`Ads count ${adCount}`),a.length&&function({text:e="",container:a=required()}){if(!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);(document.getElementById(t)||(()=>{const e=document.createElement("span");return e.id=t,e.className="style-scope yt-formatted-string bold",Object.assign(e.style,{"font-size":"1.35rem","line-height":"2rem",margin:"10px"}),a.after(e),e})()).textContent=e}({text:`「${a.join(", ")}」`,container:e})}}))}}),window.nova_plugins.push({id:"metadata-hide",title:"Hide metadata",run_on_pages:"watch",section:"details",desc:"Cover link to games, movies, merch, etc.",_runtime:e=>{let t=["ytd-watch-metadata > ytd-metadata-row-container-renderer","ytd-merch-shelf-renderer, #infocards-section"];e.description_card_list&&t.push("#structured-description ytd-horizontal-card-list-renderer"),e.description_shorts_remixing&&t.push("#structured-description ytd-reel-shelf-renderer"),e.description_transcript&&t.push("#structured-description ytd-video-description-transcript-section-renderer"),t.length&&NOVA.css.push(t.join(",\n")+" {\ndisplay: none !important;\nbackground-color: red;\n}")},options:{description_card_list:{_tagName:"input",label:"Chapters/Key moments/Music info",type:"checkbox"},description_shorts_remixing:{_tagName:"input",label:"Shorts remixing this video",type:"checkbox"},description_transcript:{_tagName:"input",label:"Transcript",type:"checkbox"}}}),window.nova_plugins.push({id:"return-dislike",title:"Show dislike count","title:zh":"显示不喜欢计数","title:ja":"嫌いな数を表示",run_on_pages:"watch, -mobile",section:"details-buttons",desc:"via by returnyoutubedislike.com",_runtime:e=>{if(e.details_buttons_label_hide||e.details_buttons_hide?.includes("like_dislike"))return;const t="nova-dislikes-count:",a="nova-dislikes-count";function n(e){if("watch"==NOVA.currentPage)switch(e.detail?.actionName){case"yt-set-active-panel-item-action":case"yt-reload-continuation-items-command":document.removeEventListener("yt-action",n),NOVA.waitSelector("#actions dislike-button-view-model button",{destroy_after_page_leaving:!0}).then((e=>l(e)))}}async function l(e=required()){const n=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id;if(!n)return console.error("return-dislike videoId: empty",n);function l({data:e=required(),container:t=required()}){if(!(t instanceof HTMLElement))return console.error("container not HTMLElement:",t);const n=Math.trunc(100*e.dislikes/(e.likes+e.dislikes)),l=`${NOVA.numberFormat.abbr(e.dislikes)} (${n}%)`;(document.getElementById(a)||function(){const e=document.createElement("span");return e.id=a,e.className="style-scope yt-formatted-string bold",e.style.cssText="text-overflow:ellipsis; overflow:visible; white-space:nowrap; padding-left:3px;",t.appendChild(e)}()).textContent=l,t.title=l}e.style.width="auto",(storage=sessionStorage.getItem(t+n))?l({data:JSON.parse(storage),container:e}):(data=await async function(){const e=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id;if(result=await fetch(`https://returnyoutubedislikeapi.com/votes?videoId=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e.dislikes&&{likes:e.likes,dislikes:e.dislikes})).catch((e=>{})))return sessionStorage.setItem(t+e,JSON.stringify(result)),result}())&&l({data:data,container:e})}NOVA.waitSelector("#actions dislike-button-view-model button",{destroy_after_page_leaving:!0}).then((e=>l(e))),NOVA.runOnPageLoad((()=>{"watch"==NOVA.currentPage&&document.addEventListener("yt-action",n)}))}}),window.nova_plugins.push({id:"description-expand",title:"Expand description","title:zh":"展开说明","title:ja":"説明を展開","title:pl":"Rozwiń opis",run_on_pages:"watch, -mobile",section:"details",desc:"on hover","plugins-conflict":"description-popup, comments-sidebar-position-exchange",_runtime:e=>{if(e["description-popup"])return;if(e["comments-sidebar-position-exchange"])return;const t="[description-collapsed] #description #expand";switch(e.description_expand_mode){case"onhover":NOVA.waitSelector(t).then((e=>e.addEventListener("mouseenter",e.click)));break;case"always":document.addEventListener("yt-page-data-updated",(function(){"watch"==NOVA.currentPage&&document.body.querySelector(t)?.click()}))}},options:{description_expand_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"always",value:"always",selected:!0,"label:zh":"每次","label:ja":"いつも","label:pl":"zawsze"},{label:"on hover",value:"onhover","label:zh":"悬停时","label:ja":"ホバー時に","label:pl":"po najechaniu"}]}}}),window.nova_plugins.push({id:"subscriptions-home",title:"Redirect from home page to subscriptions page","title:zh":"从主页重定向到订阅页面","title:ja":"ホーム ページからサブスクリプション ページへのリダイレクト","title:pl":"Przekieruj ze strony głównej na stronę subskrypcji",run_on_pages:"home",restart_on_location_change:!0,section:"header","plugins-conflict":"page-logo",_runtime:e=>{location.pathname="/feed/subscriptions"}}),window.nova_plugins.push({id:"header-unfixed",title:"Header unpinned","title:zh":"标题未固定","title:ja":"ヘッダーは固定されていません","title:pl":"Przewijany nagłówek",run_on_pages:"*, -embed, -mobile, -live_chat",section:"header",desc:"Prevent header from sticking","desc:zh":"防止头部粘连","desc:ja":"ヘッダーがくっつくのを防ぎます","desc:pl":"Nagłówek będzie przewijany wraz ze stroną",_runtime:e=>{const t="nova-header-unfixed",a="html."+t;if(NOVA.css.push(`${a} #masthead-container {\nposition: absolute !important;\n}\n${a} #chips-wrapper {\nposition: sticky !important;\n}\n${a} #header {\nmargin-top: 0 !important;\n}`),document.documentElement.classList.add(t),e.header_unfixed_hotkey){const l=e.header_unfixed_hotkey||"KeyV";document.addEventListener("keyup",(e=>{["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||(1===l.length?e.key:e.code)===l&&document.documentElement.classList.toggle(t)}))}if(e.header_unfixed_scroll){function n(){(masthead=document.getElementById("masthead"))&&(topOffset=masthead.offsetHeight)&&NOVA.isInViewport(masthead)&&window.scrollTo({top:topOffset})}!function(){const e=document.createElement("button");e.innerHTML='<svg viewBox="0 0 16 16" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M3.35 4.97 8 9.62 12.65 4.97l.71.71L8 11.03l-5.35-5.35.7-.71z" />\n</g>\n</svg>',e.title="Scroll down",Object.assign(e.style,{cursor:"pointer","background-color":"transparent",color:"deepskyblue",border:"none",height:"3em"}),e.addEventListener("click",n),(endnode=document.getElementById("end"))&&endnode.parentElement.insertBefore(e,endnode)}(),document.addEventListener("yt-action",(e=>{switch(e.detail?.actionName){case"yt-store-grafted-ve-action":case"yt-open-popup-action":n()}}))}},options:{header_unfixed_scroll:{_tagName:"input",label:"Scroll after header","label:zh":"在标题后滚动","label:ja":"ヘッダーの後にスクロール","label:pl":"Przewiń nagłówek",type:"checkbox",title:"Makes sense on a small screen","title:zh":"在小屏幕上有意义","title:ja":"小さな画面で意味があります","title:pl":"Przydatne na małym ekranie"},header_unfixed_hotkey:{_tagName:"select",label:"Hotkey toggle",options:[{label:"none",value:!1},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV",selected:!0},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"]}}}),window.nova_plugins.push({id:"header-compact",title:"Header compact","title:zh":"标题紧凑","title:ja":"ヘッダーコンパクト","title:pl":"Kompaktowy nagłówek",run_on_pages:"*, -embed, -mobile, -live_chat",section:"header",_runtime:e=>{const t="36px";NOVA.css.push(`#masthead #container.ytd-masthead {\nmax-height: ${t} !important;\n}\n#masthead #background {\nmax-height: ${t} !important;\n}\n#search-form, #search-icon-legacy {\nmax-height: ${t} !important;\n}\nbody,\nhtml:not(:fullscreen) #page-manager {\n--ytd-masthead-height: ${t};\n}\n#chips-wrapper.ytd-feed-filter-chip-bar-renderer {\n--ytd-rich-grid-chips-bar-top: ${t};\n}`)}}),window.nova_plugins.push({id:"search-query",title:"Search filter","title:zh":"搜索过滤器","title:ja":"検索フィルター","title:pl":"Filtry wyszukiwania",run_on_pages:"results",restart_on_location_change:!0,section:"header",_runtime:e=>{!NOVA.queryURL.has("sp")&&(sp=e.search_query_date||e.search_query_sort)&&(location.href=NOVA.queryURL.set({sp:sp}))},options:{search_query_sort:{_tagName:"select",label:"Sort by","label:zh":"排序方式","label:ja":"並び替え","label:pl":"Sortuj według",options:[{label:"relevance",value:!1,selected:!0},{label:"upload date",value:"cai%253d"},{label:"view count",value:"cam%253d"},{label:"rating",value:"cae%253d"}],"data-dependent":{search_query_date:!1}},search_query_date:{_tagName:"select",label:"Upload date","label:zh":"上传日期","label:ja":"アップロード日","label:pl":"Data przesłania",options:[{label:"all time",value:!1,selected:!0},{label:"last hour",value:"egiiaq%253d%253d"},{label:"today",value:"egiiag%253d%253d"},{label:"this week",value:"egiiaw%253d%253d"},{label:"this month",value:"egiiba%253d%253d"},{label:"this year",value:"egiibq%253d%253d"}],"data-dependent":{search_query_sort:!1}}}}),window.nova_plugins.push({id:"page-logo",title:"YouTube logo link","title:zh":"YouTube 徽标","title:ja":"YouTubeロゴ",run_on_pages:"*, -embed, -mobile, -live_chat",section:"header",_runtime:e=>{NOVA.waitSelector("#masthead a#logo",{destroy_after_page_leaving:!0}).then((async t=>{(link=new URL(e.page_logo_url_mode)?.href)&&(t.href=link,await NOVA.waitUntil((()=>t.data?.commandMetadata?.webCommandMetadata?.url),1500),t.data.commandMetadata.webCommandMetadata.url=link)}))},options:{page_logo_url_mode:{_tagName:"input",label:"URL",type:"url",pattern:"https://.*",placeholder:"https://youtube.com/...",value:"https://youtube.com/feed/subscriptions"}}});const NOVA={waitSelector(e=required(),t){return new Promise(((a,n)=>{if("string"!=typeof e)return console.error("wait > selector:",...arguments),n("wait > selector:",typeof e);if(t&&!t.hasOwnProperty("destroy_after_page_leaving")&&!t.hasOwnProperty("container"))return console.error('waitSelector > check format "limit_data":',...arguments),n('waitSelector > check format "limit_data"');if(t?.container&&!(t.container instanceof HTMLElement))return console.error("waitSelector > container not HTMLElement:",...arguments),n("waitSelector > container not HTMLElement");if(e.includes(":has(")&&!CSS.supports("selector(:has(*))"))return console.warn('CSS ":has()" unsupported'),n('CSS ":has()" unsupported');if(element=(t?.container||document.body||document).querySelector(e))return a(element);const l=new MutationObserver(((n,l)=>{for(const t of n)for(const n of t.addedNodes)if([1,3,8].includes(n.nodeType)&&n instanceof HTMLElement){if(n.matches&&n.matches(e))return l.disconnect(),a(n);if((parentEl=n.parentElement||n)&&parentEl instanceof HTMLElement&&(element=parentEl.querySelector(e)))return l.disconnect(),a(element)}if("loading"!=document?.readyState&&(element=(t?.container||document?.body||document).querySelector(e)))return l.disconnect(),a(element)}));if(l.observe(t?.container||document.body||document.documentElement||document,{childList:!0,subtree:!0,attributes:!0}),(sec=+t?.destroy_timeout)&&setTimeout((()=>(l.disconnect(),n(`"${e}" timed out after ${sec} seconds`))),1e3*sec),t?.destroy_after_page_leaving){function o(){return this.prevURL!==document.URL&&(this.prevURL=document.URL)}o(),window.addEventListener("transitionend",(({target:e})=>o()&&l.disconnect()))}}))},waitUntil:(e=required(),t=required())=>"function"!=typeof e?console.error("waitUntil > condition is not fn:",typeof e):new Promise((a=>{if(result=e())a(result);else{const n=setInterval((()=>{(result=e())&&(clearInterval(n),a(result))}),+t||500)}})),delay:(e=100)=>new Promise((t=>setTimeout(t,e))),watchElements_list:{},watchElements({selectors:e=required(),attr_mark:t,callback:a=required()}){return Array.isArray(e)||"string"==typeof e?"function"!=typeof a?console.error("watch > callback:",typeof a):void this.waitSelector("string"==typeof e?e:e.join(",")).then((n=>{function l(){e.forEach((e=>{if(e.includes(":has(")&&!CSS.supports("selector(:has(*))"))return console.warn('CSS ":has()" unsupported');t&&(e+=`:not([${t}])`),document.body.querySelectorAll(e).forEach((e=>{t&&e.setAttribute(t,!0),a(e)}))}))}!Array.isArray(e)&&(e=e.split(",").map((e=>e.trim()))),l(),this.watchElements_list[t]=setInterval((()=>"visible"==document.visibilityState&&l()),1500)})):console.error("watch > selector:",typeof e)},runOnPageLoad(e){if(!e||"function"!=typeof e)return console.error("runOnPageLoad > callback not function:",...arguments);let t=document.URL;const a=()=>t!==document.URL&&(t=document.URL);a()||e(),document.addEventListener("yt-navigate-finish",(()=>a()&&e()))},css:{push(e=required(),t,a){if("object"==typeof e){if(!t)return console.error("injectStyle > empty json-selector:",...arguments);if(t.includes(":has(")&&!CSS.supports("selector(:has(*))"))return console.error('CSS ":has()" unsupported',...arguments);n(t+function(e){let t="";return Object.entries(e).forEach((([e,n])=>{t+=e+":"+n+(a?" !important":"")+";"})),`{ ${t} }`}(e))}else e&&"string"==typeof e?document.head?n(e):window.addEventListener("load",(()=>n(e)),{capture:!0,once:!0}):console.error("addStyle > css:",typeof e);function n(e=required()){let t;if(e.endsWith(".css"))t=document.createElement("link"),t.rel="sheet",t.href=e;else{const e="NOVA-style";t=document.getElementById(e)||function(){const t=document.createElement("style");return t.type="text/css",t.id=e,(document.head||document.documentElement).appendChild(t)}()}t.textContent+="\n"+e.replace(/\n+\s{2,}/g," ")+"\n"}},get:(e=required(),t=required())=>(el=e instanceof HTMLElement?e:document.body?.querySelector(e))?getComputedStyle(el).getPropertyValue(t):null},isInViewport:(e=required())=>e instanceof HTMLElement?(distance=e.getBoundingClientRect())?distance.top>=0&&distance.left>=0&&distance.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&distance.right<=(window.innerWidth||document.documentElement.clientWidth):void 0:console.error("el is not HTMLElement type:",e),collapseElement({selector:e=required(),label:t=required(),remove:a}){const n=`${t.match(/[a-z]+/gi).join("")}-prevent-load-btn`;this.waitSelector(e.toString()).then((e=>{if(a)e.remove();else{if(document.getElementById(n))return;e.style.display="none";const a=document.createElement("a");a.textContent=`Load ${t}`,a.id=n,a.className="more-button style-scope ytd-video-secondary-info-renderer",Object.assign(a.style,{cursor:"pointer","text-align":"center","text-transform":"uppercase",display:"block",color:"var(--yt-spec-text-secondary)"}),a.addEventListener("click",(()=>{a.remove(),e.style.display="inherit",window.dispatchEvent(new Event("scroll"))})),e.before(a)}}))},aspectRatio:{sizeToFit({srcWidth:e=0,srcHeight:t=0,maxWidth:a=screen.width,maxHeight:n=screen.height}){const l=Math.min(a/+e,n/+t,1);return{width:+e*l,height:+t*l}},getAspectRatio({width:e=required(),height:t=required()}){const a=(e,t)=>t?a(t,e%t):e,n=a(e,t),l=e/n,o=t/n;return l>10&&o>10&&Math.abs(l-o)<=2?"1:1":l+":"+o},chooseAspectRatio({width:e=required(),height:t=required(),layout:a}){const n={landscape:{"1:1":1,"3:2":1.5,"4:3":1.33333333333,"5:4":1.25,"5:3":1.66666666667,"16:9":1.77777777778,"16:10":1.6,"17:9":1.88888888889,"21:9":2.33333333333,"24:10":2.4},portrait:{"1:1":1,"2:3":.66666666667,"3:4":.75,"3:5":.6,"4:5":.8,"9:16":.5625,"9:17":.5294117647,"9:21":.4285714286,"10:16":.625}};return function(e=required()){return n[a||(e<1?"portrait":"landscape")][e]}(this.getAspectRatio(...arguments))||n.landscape["16:9"]},calculateHeight:(e=required(),t=16/9)=>parseFloat((e/t).toFixed(2)),calculateWidth:(e=required(),t=16/9)=>parseFloat((e*t).toFixed(2))},openPopup({url:e=required(),title:t=document.title,width:a=window.innerWidth,height:n=window.innerHeight,closed_callback:l}){const o=screen.width/2-a/2,i=screen.height/2-n/2,r=window.open(e,"_blank",`popup=1,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=yes,copyhistory=no,width=${a},height=${n},top=${i},left=${o}`);if(l&&"function"==typeof l){const e=setInterval((()=>{r.closed&&(clearInterval(e),l())}),500)}},showOSD(e){if(!e||!["watch","embed"].includes(this.currentPage))return;"number"==typeof this.fadeBezel&&clearTimeout(this.fadeBezel);const t=document.body.querySelector(".ytp-bezel-text");if(!t)return console.error(`showOSD ${e}=>${t}`);const a=t.parentElement.parentElement,n="ytp-text-root",l="."+n;this.bezel_css_inited||(this.bezel_css_inited=!0,this.css.push(`${l} { display: block !important; }\n${l} .ytp-bezel-text-wrapper {\npointer-events: none;\nz-index: 40 !important;\n}\n${l} .ytp-bezel-text { display: inline-block !important; }\n${l} .ytp-bezel { display: none !important; }`)),t.textContent=e,a.classList.add(n);let o=1200;(e=String(e))&&(e.endsWith("%")||e.endsWith("x")||e.startsWith("+"))&&(o=600),this.fadeBezel=setTimeout((()=>{a.classList.remove(n),t.textContent=""}),o)},getChapterList(e=required()){if(["watch","embed"].includes(this.currentPage))switch(NOVA.currentPage){case"embed":return chapsCollect=function(){if(!window.ytPubsubPubsubInstance)return console.warn("ytPubsubPubsubInstance is null:",ytPubsubPubsubInstance);if((ytPubsubPubsubInstance=ytPubsubPubsubInstance.i||ytPubsubPubsubInstance.j||ytPubsubPubsubInstance.subscriptions_)&&Array.isArray(ytPubsubPubsubInstance)){const e=Object.values(ytPubsubPubsubInstance.find((e=>e?.player))?.player.app).find((e=>e?.videoData))?.videoData.multiMarkersPlayerBarRenderer;if(e?.markersMap?.length)return e.markersMap[0].value.chapters?.map((e=>{const t=+e.chapterRenderer.timeRangeStartMillis/1e3;return{sec:t,time:NOVA.formatTimeOut.HMS.digit(t),title:e.chapterRenderer.title.simpleText||e.chapterRenderer.title.runs[0].text}}))}}(),chapsCollect;case"watch":if((chapsCollect=function(){t();const a='a[href*="&t="]';let n,l=[];if([(document.body.querySelector("ytd-watch-flexy")?.playerData?.videoDetails?.shortDescription||document.body.querySelector("ytd-watch-metadata #description.ytd-watch-metadata")?.textContent)?.split("\n")||[],[...document.body.querySelectorAll(`#comments #comment #comment-content:has(${a})`)].map((e=>[...e.querySelectorAll(a)].map((e=>({source:"comment",text:`${e.textContent} ${(e.nextSibling||e.previousSibling)?.textContent}`})))))?.sort(((e,t)=>t.length-e.length))?.shift()||[]]?.sort(((e,t)=>t.length-e.length)).forEach((t=>{if(l.length>1)return;let a=-1;t.forEach((t=>{if(n=Boolean(t?.source),(t=(t?.text||t).toString().trim()).length>5&&(timestamp=/((\d?\d:){1,2}\d{2})/g.exec(t))&&t.length-timestamp.length<200){timestamp=timestamp[0];const o=NOVA.formatTimeOut.hmsToSec(timestamp),i=t.indexOf(timestamp);(n||o>a&&o<+e)&&(i<5||i+timestamp.length===t.length)&&(n&&(a=o),l.push({sec:o,time:timestamp,title:t.replace(timestamp,"").replace(/\*(.*?)\*/g,"<b>$1</b>").trim().replace(/^[\u2011-\u26FF:\-|\[\]]+|[\u2011-\u26FF:\-.;]+$/g,"").replace(/[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2580-\u27BF]|\uD83E[\uDD10-\uDDFF]/g,"").trim()}))}}))})),1==l.length&&l[0].sec<e/4)return l;if(l.length>1)return n&&(l=l.sort(((e,t)=>e.sec-t.sec))),l}()||function(){t();const a='a[href*="&t="]';let n=[],l=-1;if(document.body.querySelectorAll(`#structured-description ${a}`).forEach((e=>{const t=parseInt(NOVA.queryURL.get("t",e.href));t>l&&(l=t,n.push({time:NOVA.formatTimeOut.HMS.digit(t),sec:t,title:e.textContent.trim().split("\n")[0].trim()}))})),1==n.length&&n[0].sec<e/4)return n;if(n.length>1)return n}())&&chapsCollect.length)return chapsCollect}function t(){document.body.querySelector("#meta [collapsed] #more, [description-collapsed] #description #expand")?.click()}},strToArray:e=>e?.trim().split(/[\n,;]/).map((e=>e.replace(/^(\s+)$/,""))).filter((e=>e.length)),searchFilterHTML({keyword:e=required(),filter_selectors:t=required(),highlight_selector:a,highlight_class:n}){e=e.toString().toLowerCase(),document.body.querySelectorAll(t).forEach((t=>{const l=t.innerText,o=l?.toLowerCase().includes(e);(a?t.querySelectorAll(a):[t]).forEach((a=>{a.innerHTML.includes("<mark ")&&(a.innerHTML=a.innerHTML.replace(/<\/?mark[^>]*>/g,"")),t.style.display=o?"":"none",o&&e&&function({target:e=required(),keyword:t=required(),highlightClass:a}){const n=e.innerText,l=new RegExp("(>[^<.]*)?("+t+")([^<.]*)?","gi"),o=`$1<mark ${a?`class="${a}"`:'style="background-color:#afafaf"'}>$2</mark>$3`,i=n.replaceAll(l,o);e.innerHTML=i}({target:a,keyword:e,highlightClass:n})}))}))},isMusic(){if(["watch","embed"].includes(this.currentPage))return function(){const e=movie_player.getVideoData().author,t=movie_player.getVideoData().title.toUpperCase(),a=t?.toUpperCase().match(/\w+/g),n=document.body.querySelector("ytd-watch-flexy")?.playerData;return[t,document.URL,e,n?.microformat?.playerMicroformatRenderer.category,n?.title].some((e=>e?.toUpperCase().includes("MUSIC")))||document.body.querySelector("#upload-info #channel-name .badge-style-type-verified-artist")||e&&/(VEVO|Topic|Records|RECORDS|Recordings|AMV)$/.test(e)||e&&/(MUSIC|ROCK|SOUNDS|SONGS)/.test(e.toUpperCase())||a?.length&&["🎵","♫","SONG","SONGS","SOUNDTRACK","LYRIC","LYRICS","AMBIENT","MIX","VEVO","CLIP","KARAOKE","OPENING","COVER","COVERED","VOCAL","INSTRUMENTAL","ORCHESTRAL","DUBSTEP","DJ","DNB","BASS","BEAT","ALBUM","PLAYLIST","DUBSTEP","CHILL","RELAX","CLASSIC","CINEMATIC"].some((e=>a.includes(e)))||["OFFICIAL VIDEO","OFFICIAL AUDIO","FEAT.","FT.","LIVE RADIO","DANCE VER","HIP HOP","ROCK N ROLL","HOUR VER","HOURS VER","INTRO THEME"].some((e=>t.includes(e)))||a?.length&&["OP","ED","MV","OST","NCS","BGM","EDM","GMV","AMV","MMD","MAD"].some((e=>a.includes(e)))}()},formatTimeOut:{hmsToSec(e=required()){let t=e?.split(":"),a=0;switch(t?.length){case 2:a=60*t[0];break;case 3:a=3600*t[0]+60*t[1];break;case 4:a=86400*t[0]+3600*t[1]+60*t[2]}return a+ +t.pop()},HMS:{parseTime(e){const t=Math.abs(+e);return{d:Math.trunc(t/86400),h:Math.trunc(t%86400/3600),m:Math.trunc(t%3600/60),s:Math.trunc(t%60)}},digit(e=required()){const{d:t,h:a,m:n,s:l}=this.parseTime(e);return(t?`${t}d `:"")+(a?(t?a.toString().padStart(2,"0"):a)+":":"")+(a?n.toString().padStart(2,"0"):n)+":"+l.toString().padStart(2,"0")},abbr(e=required()){const{d:t,h:a,m:n,s:l}=this.parseTime(e);return(t?`${t}d `:"")+(a?(t?a.toString().padStart(2,"0"):a)+"h":"")+(n?(a?n.toString().padStart(2,"0"):n)+"m":"")+(l?(n?l.toString().padStart(2,"0"):l)+"s":"")}},ago(e=required()){if(!(e instanceof Date))return console.error('"date" is not Date type:',e);const t=e.getTime(),a=Math.round((Date.now()-Math.abs(t))/1e3),n=[{label:"year",sec:31536e3},{label:"month",sec:2592e3},{label:"day",sec:86400},{label:"hour",sec:3600},{label:"minute",sec:60},{label:"second",sec:1}].find((e=>e.sec<a)),l=Math.round(a/n.sec);return`${(t<0?"-":"")+l} ${n.label}${1!==l?"s":""}`}},dateFormat(e="YYYY/MM/DD"){if(!(this instanceof Date))return console.error("dateFormat - is not Date type:",this);const t=e=>e.toString().padStart(2,"0"),a=this.getDate(),n=this.getFullYear(),l=this.getMonth(),o=this.getDay(),i=this.getHours(),r=this.getMinutes(),s=this.getSeconds();return e.replace(/A|Z|S(SS)?|ss?|mm?|HH?|hh?|D{1,4}|M{1,4}|YY(YY)?|'([^']|'')*'/g,(e=>{let c;switch(e){case"YY":c=n.substr(2);break;case"YYYY":c=n;break;case"M":c=l+1;break;case"MM":c=t(l+1);break;case"MMM":c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l];break;case"MMMM":c=["January","February","March","April","May","June","July","August","September","October","November","December"][l];break;case"D":c=a;break;case"DD":c=t(a);break;case"DDD":c=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"][o];break;case"DDDD":c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][o];break;case"h":c=i%12||12;break;case"H":c=i;break;case"HH":c=t(i);break;case"mm":c=t(r);break;case"s":c=s;break;case"ss":case"SS":c=t(s);break;case"A":c=i<12?"AM":"PM";break;case"Z":c=("+"+-this.getTimezoneOffset()/60).replace(/^\D?(\D)/,"$1").replace(/^(.)(.)$/,"$10$2")+"00"}return c}))},numberFormat:{abbr:e=>0===(e=Math.abs(+e))||isNaN(e)?"":e<1e3?Math.trunc(e):e<1e4?function(e,t=1){const a=Math.pow(10,t);return Math.round(e*a)/a}(e/1e3)+"K":e<99e4?Math.round(e/1e3)+"K":e<99e7?Math.round(e/1e5)/10+"M":Math.round(e/1e8)/10+"B",friendly:e=>(new Intl.NumberFormat).format(Math.round(10*e)/10)},extractAsNum:{float:e=>(n=e?.replace(/[^0-9.]/g,""))&&+n,int:e=>(n=e?.replace(/\D+/g,""))&&+n},updateUrl:(e=required())=>window.history.replaceState(null,null,e),queryURL:{has:(e=required(),t)=>new URL(t||location).searchParams.has(e.toString()),get:(e=required(),t)=>new URL(t||location).searchParams.get(e.toString()),set(e={},t){if("object"!=typeof e||!Object.keys(e).length)return console.error("query_obj:",e);const a=new URL(t||location);return Object.entries(e).forEach((([e,t])=>a.searchParams.set(e,t))),a.toString()},remove(e=required(),t){const a=new URL(t||location);return a.searchParams.delete(e.toString()),a.toString()},getHashParam:(e=required(),t)=>location.hash&&new URLSearchParams(new URL(t||location).hash.substring(1)).get(e.toString())},request:(()=>{const e="YOUTUBE_API_KEYS";return{async API({request:t=required(),params:a=required(),api_key:n}){const l=localStorage.hasOwnProperty(e)?JSON.parse(localStorage.getItem(e)):await async function(){return NOVA.log("request.API: fetch to youtube_api_keys.json"),await fetch("https://gist.githubusercontent.com/raingart/ff6711fafbc46e5646d4d251a79d1118/raw/youtube_api_keys.json").then((e=>e.text())).then((t=>(NOVA.log("get and save keys in localStorage",t),localStorage.setItem(e,t),JSON.parse(t)))).catch((t=>{throw localStorage.removeItem(e),t})).catch((e=>console.error("Error get keys:",e)))}();if(!(n||Array.isArray(l)&&l?.length))return localStorage.hasOwnProperty(e)&&localStorage.removeItem(e),console.error("YOUTUBE_API_KEYS empty:",l);const o=`https://www.googleapis.com/youtube/v3/${t}?${Object.keys(a).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(a[e]))).join("&")}&key=`+(i=l,n||"AIzaSy"+i[Math.trunc(Math.random()*i.length)]);var i;return await fetch(o).then((e=>e.json())).then((e=>{if(!e?.error&&Object.keys(e).length)return e;if(console.warn("used key:",NOVA.queryURL.get("key",o)),e?.error&&Object.keys(e.error).length)throw new Error(JSON.stringify(e?.error))})).catch((t=>{if(localStorage.removeItem(e),console.error(`Request API failed:${o}\n${t}`),t?.message&&(err=JSON.parse(t?.message)))return{code:err.code,reason:err.errors?.length&&err.errors[0].reason,error:err.message}}))}}})(),getPlayerState:e=>({"-1":"UNSTARTED",0:"ENDED",1:"PLAYING",2:"PAUSED",3:"BUFFERING",5:"CUED"}[e||movie_player.getPlayerState()]),videoElement:(()=>{const e="#movie_player:not(.ad-showing) video";document.addEventListener("canplay",(({target:t})=>{t.matches(e)&&(NOVA.videoElement=t)}),{capture:!0,once:!0}),document.addEventListener("play",(({target:t})=>{t.matches(e)&&(NOVA.videoElement=t)}),!0)})(),getChannelId:e=>[document.head.querySelector('meta[itemprop="channelId"][content]')?.content,(document.body.querySelector("ytd-app")?.__data?.data?.response||document.body.querySelector("ytd-app")?.data?.response||window.ytInitialData)?.metadata?.channelMetadataRenderer?.externalId,document.head.querySelector('link[itemprop="url"][href]')?.href.split("/")[4],location.pathname.split("/")[2],document.body.querySelector("#video-owner a[href]")?.href.split("/")[4],document.body.querySelector("a.ytp-ce-channel-title[href]")?.href.split("/")[4],document.body.querySelector("ytd-watch-flexy")?.playerData?.videoDetails?.channelId,"object"==typeof ytcfg&&(obj=ytcfg.data_?.PLAYER_VARS?.embedded_player_response)&&NOVA.seachInObjectBy.key({obj:JSON.parse(obj),keys:"channelId"})?.data].find((e=>(e=>e&&/UC([a-z0-9-_]{22})$/i.test(e))(e))),storage_obj_manager:{STORAGE_NAME:"nova-channels-state",async initStorage(){this.channelId=location.search.includes("list=")?NOVA.queryURL.get("list")||movie_player?.getPlaylistId():await NOVA.waitUntil(NOVA.getChannelId,1e3)},read(e){if(store=JSON.parse(localStorage.getItem(this.STORAGE_NAME)))return e?store:store[this.channelId]},write(e){(storage=this.read("all")||{})&&(Object.keys(e).length?storage=Object.assign(storage,{[this.channelId]:e}):delete storage[this.channelId]),localStorage.setItem(this.STORAGE_NAME,JSON.stringify(storage))},_getParam(e=required()){if(storage=this.read())return storage[e]},async getParam(e=required()){return this.channelId||await this.initStorage(),this._getParam(...arguments)},save(e){(storage=this.read())&&(e=Object.assign(storage,e)),this.write(e)},remove(e){(storage=this.read())&&(delete storage[e],this.write(storage))}},seachInObjectBy:{key({obj:e=required(),keys:t=required(),match_fn:a=e=>"Object"!==e.constructor.name,multiple:n=!1,path:l=""}){const o=e=>(l?l+".":"")+e;let i,r=[];for(const s in e)if(e.hasOwnProperty(s)&&e[s])if(i="String"===t.constructor.name?t===s:t.indexOf(s)>-1,!i||a&&!a(e[s]))switch(e[s].constructor.name){case"Object":if(result=this.key({obj:e[s],keys:t,path:o(s),match_fn:a})){if(!n)return result;r.push(result)}break;case"Array":for(let o=0;o<e[s].length;o++)if(result=this.key({obj:e[s][o],keys:t,path:l+`[${o}]`,match_fn:a})){if(!n)return result;r.push(result)}break;case"Function":if(Object.keys(e[s]).length)for(const l in e[s])if(void 0!==e[s][l]&&(result=this.key({obj:e[s][l],keys:t,path:o(s)+"."+l,match_fn:a}))){if(!n)return result;r.push(result)}}else{if(!n)return{path:o(s),data:e[s]};r.push({path:o(s),data:e[s]})}if(n)return r}},log(){this.DEBUG&&arguments.length&&(console.groupCollapsed(...arguments),console.trace(),console.groupEnd())}};window.nova_plugins.push({id:"page-title-time",title:"Show time in tab title","title:zh":"在标签标题中显示时间","title:ja":"タブタイトルに時間を表示する","title:pl":"Pokaż czas w tytule karty",run_on_pages:"watch",section:"other",_runtime:e=>{NOVA.waitSelector("video").then((e=>{document.addEventListener("yt-navigate-start",(()=>t.backup=null)),e.addEventListener("playing",t.save.bind(t)),e.addEventListener("timeupdate",(()=>t.update(e))),e.addEventListener("pause",(()=>t.restore(e))),e.addEventListener("ended",(()=>t.restore(e)))}));const t={strSplit:" | ",saveCheck(){return(result=(this.backup||document.title).includes(this.strSplit))?new RegExp(`^((\\d?\\d:){1,2}\\d{2})(${this.strSplit.replace("|","\\|")})`,"").test(document.title):result},save(){this.backup||movie_player.getVideoData().isLive||movie_player.classList.contains("ad-showing")||this.saveCheck()||(this.backup=movie_player.getVideoData().title+" :: "+movie_player.getVideoData().author)},update(t=NOVA.videoElement){if(!this.backup)return;let a=[];switch(movie_player.getVideoData().isLive?"current":e.page_title_time_mode){case"current":a=[t.currentTime];break;case"current-duration":isNaN(t.duration)||(a=[t.currentTime," / ",t.duration]);break;default:isNaN(t.duration)||(a=[t.duration-t.currentTime])}a=a.map((e=>"string"==typeof e?e:NOVA.formatTimeOut.HMS.digit(e/t.playbackRate))).join(""),this.set([a,this.backup])},restore(e=NOVA.videoElement){this.backup&&this.set([movie_player.getVideoData().isLive&&e.currentTime,this.backup])},set(e){document.title=e.filter(Boolean).join(this.strSplit)}}},options:{page_title_time_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"left",value:"left",selected:!0,"label:zh":"剩下","label:ja":"左","label:pl":"pozostało"},{label:"current/duration",value:"current-duration","label:zh":"现在/期间","label:ja":"現在/期間","label:pl":"bieżący czas"}]}}}),window.nova_plugins.push({id:"scrollbar-hide",title:"Hide scrollbar (for watch page)",run_on_pages:"watch, -mobile",section:"other",_runtime:e=>{const t="nova-scrollbar-hide";NOVA.css.push(`html[${t}] {\nscrollbar-width: none;\n}\nhtml[${t}] body::-webkit-scrollbar {\nwidth: 0px;\nheight: 0px;\n}`),NOVA.runOnPageLoad((()=>{const e=document.documentElement.hasAttribute(t);"watch"!=NOVA.currentPage||e?"watch"!=NOVA.currentPage&&e&&document.documentElement.removeAttribute(t):document.documentElement.setAttribute(t,!0)})),e.scrollbar_hide_toggle_on_scroll&&window.addEventListener("scroll",(function e(){"watch"==NOVA.currentPage&&document.documentElement.scrollHeight>window.innerHeight&&(document.documentElement.hasAttribute(t)&&document.documentElement.removeAttribute(t),"number"==typeof e.fade&&clearTimeout(e.fade),e.fade=setTimeout((()=>{document.documentElement.setAttribute(t,!0)}),700))}))},options:{scrollbar_hide_toggle_on_scroll:{_tagName:"input",label:"Showing on scroll",type:"checkbox"}}}),window.nova_plugins.push({id:"channel-play-all",title:'Add "Play All" button',"title:zh":"在频道页面添加“Play All”按钮","title:ja":"チャンネルページに「Play All」ボタンを追加",run_on_pages:"channel, watch, -mobile",restart_on_location_change:!0,section:"channel",_runtime:e=>{const t="nova-play-all-channel-btn",a="/playlist?list=";switch(NOVA.currentPage){case"watch":if(!e.channel_play_all_in_watch)return;NOVA.waitSelector("#owner.ytd-watch-metadata").then((n=>{if(channelId=NOVA.getChannelId()){const l=e.channel_play_all_mode?{id:"UULF",title:"All"}:{id:"UULP",title:"MOST POPULAR"};!function({url:e=required(),container:a=required()}){if(console.debug("insertToHTML",...arguments),!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);(document.getElementById(t)||function(){const e=document.createElement("a");return e.id=t,e.className="style-scope yt-formatted-string bold yt-spec-button-shape-next yt-spec-button-shape-next--tonal yt-spec-button-shape-next--mono yt-spec-button-shape-next--size-m",e.style.cssText="margin-left:5px; flex: .6;",e.textContent=`► Play ${l.title}`,e.title="Play all uploads videos from the channel",a.appendChild(e)}()).href=e}({container:n,url:a+l.id+channelId.substring(2)})}}));break;case"channel":let n;switch(NOVA.channelTab){case"videos":n=e.channel_play_all_mode?{id:"UULF",title:"All Videos"}:{id:"UULP",title:"Popular Videos"};break;case"shorts":n=e.channel_play_all_mode?{id:"UUSH",title:"All Shorts"}:{id:"UUPS",title:"Popular Shorts"};break;case"streams":n=e.channel_play_all_mode?{id:"UULV",title:"All Streams"}:{id:"UUPV",title:"Popular Streams"}}if(!n)return;NOVA.waitSelector("#header #chips-wrapper").then((e=>{e.querySelector(`.${t}`)?.remove();const l=document.createElement("tp-yt-paper-button");l.className="style-scope yt-formatted-string bold yt-chip-cloud-chip-renderer 1yt-spec-button-shape-next",l.classList.add(t),l.style.cssText="color: wheat; text-wrap: nowrap;",l.textContent=`► Play ${n.title}`,l.addEventListener("click",(()=>{(channelId=NOVA.getChannelId())&&(location.href=a+n.id+channelId.substring(2))})),e.append(l)}))}},options:{channel_play_all_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"all",value:!0},{label:"most popular"}]},channel_play_all_in_watch:{_tagName:"input",label:'Add in the "watch page" too',type:"checkbox"}}}),window.nova_plugins.push({id:"channel-default-tab",title:"Default tab on channel page","title:zh":"频道页默认选项卡","title:ja":"チャンネルページのデフォルトタブ","title:pl":"Domyślna karta na stronie kanału",run_on_pages:"channel",restart_on_location_change:!0,section:"channel",_runtime:e=>{if(!NOVA.channelTab)if("redirect"==e.channel_default_tab_mode){if("popular"===e.channel_default_tab_thumbs_sort)return void location.assign(`${location.protocol}//${location.hostname}/${location.pathname}/${e.channel_default_tab}?SRT=P`);location.pathname+="/"+e.channel_default_tab}else{const t='#tabsContent [role="tab"]';NOVA.waitSelector(t,{destroy_after_page_leaving:!0}).then((()=>{let a;const n=[...document.body.querySelectorAll(t)];if("videos"===e.channel_default_tab)a=n[1];else location.pathname+="/"+e.channel_default_tab;a?.click(),document.addEventListener("yt-navigate-finish",(()=>window.dispatchEvent(new Event("resize"))),{capture:!0,once:!0})}))}},options:{channel_default_tab:{_tagName:"select",label:"Default tab","label:zh":"默认标签页","label:ja":"デフォルトのタブ","label:pl":"Domyślna karta",options:[{label:"videos",value:"videos",selected:!0,"label:pl":"wideo"},{label:"shorts",value:"shorts"},{label:"live",value:"streams"},{label:"podcasts",value:"podcasts"},{label:"releases",value:"releases"},{label:"playlists",value:"playlists","label:pl":"playlista"},{label:"community",value:"community"}]},channel_default_tab_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"click","label:pl":"klik"},{label:"redirect",value:"redirect","label:pl":"przekierowanie"}],"data-dependent":{channel_default_tab:["videos"]}},channel_default_tab_thumbs_sort:{_tagName:"select",label:"Sort",options:[{label:"newest",selected:!0},{label:"popular",value:"popular"}],"data-dependent":{channel_default_tab_mode:["redirect"]}}}}),window.nova_plugins.push({id:"copy-url",title:"Copy URL to clipboard","title:zh":"将 URL 复制到剪贴板","title:ja":"URLをクリップボードにコピー",run_on_pages:"results, channel, playlist, watch, embed",section:"other",_runtime:e=>{const t="nova-copy-notification";function a(n){"number"==typeof a.fade&&(clearTimeout(a.fade),clearTimeout(a.hideСompletely));const l=document.getElementById(t)||function(){const a=document.createElement("div");a.id=t;let n={position:"fixed","z-index":9999,"border-radius":"2px","background-color":e.copy_url_color||"#e85717","box-shadow":"rgb(0 0 0 / 50%) 0px 0px 3px","border-radius":e["square-avatars"]?"inherit":"12px","font-size":`${+e.copy_url_font_size||1.7}em`,color:"var(--yt-spec-text-primary, white)",padding:".5em .8em",cursor:"pointer"};switch(e.copy_url_position){case"top-left":n.top="60px",n.left="20px";break;case"bottom-left":n.bottom="20px",n.left="20px";break;case"bottom-right":n.bottom="20px",n.right="20px";break;default:n.top="60px",n.right="20px"}return Object.assign(a.style,n),document.body.appendChild(a)}();l.textContent=n,l.style.opacity=+e.copy_url_opacity||1,l.style.visibility="visible",a.fade=setTimeout((()=>{l.style.transition="opacity 200ms ease-out",l.style.opacity=0,a.hideСompletely=setTimeout((()=>l.style.visibility="hidden"),5e3)}),600)}document.addEventListener("keydown",(t=>{const n=e.copy_url_hotkey||"ctrlKey";if(("ctrlKey"!=n||!window.getSelection||!window.getSelection().toString())&&!["input","textarea","select"].includes(t.target.localName)&&!t.target.isContentEditable&&t[n]&&"KeyC"===t.code){let n;switch(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),NOVA.currentPage){case"watch":case"embed":n="https://youtu.be/"+(NOVA.queryURL.get("v")||movie_player.getVideoData().video_id);break;case"channel":n=(channelId=NOVA.getChannelId(e["user-api-key"]))?`https://${location.host}/channel/`+channelId:location.href;break;case"results":case"playlist":n=location.href}n&&(navigator.clipboard.writeText(n),a("URL copied"))}}))},options:{copy_url_hotkey:{_tagName:"select",label:"Hotkey","label:zh":"热键","label:ja":"ホットキー","label:pl":"Klawisz skrótu",options:[{label:"shift+c",value:"shiftKey",selected:!0},{label:"ctrl+c",value:"ctrlKey"}]},copy_url_position:{_tagName:"select",label:"Notification position",options:[{label:"↖",value:"top-left"},{label:"↗",value:"top-right",selected:!0},{label:"↙",value:"bottom-left"},{label:"↘",value:"bottom-right"}]},copy_url_opacity:{_tagName:"input",label:"Opacity",type:"number",placeholder:"0.1-1",step:.1,min:.1,max:1,value:.8},copy_url_font_size:{_tagName:"input",label:"Font size",type:"number",title:"in em",placeholder:"0.5-3",step:.1,min:.5,max:3,value:1.7},copy_url_color:{_tagName:"input",type:"color",value:"#e85717",label:"Color","label:zh":"颜色","label:ja":"色","label:pl":"Kolor",title:"default - #e85717"}}}),window.nova_plugins.push({id:"rss-link",title:"Add RSS feed link","title:zh":"添加 RSS 提要链接","title:ja":"RSSフィードリンクを追加","title:pl":"Dodaj kanał RSS",run_on_pages:"channel, playlist, -mobile",restart_on_location_change:!0,section:"channel",_runtime:e=>{const t="nova-rss-link",a="/feeds/videos.xml",n=a+"?playlist_id="+NOVA.queryURL.get("list");switch(NOVA.currentPage){case"channel":NOVA.waitSelector("#channel-header #links-holder #primary-links").then((t=>{parseInt(NOVA.css.get("#header div.banner-visible-area","height"))||(t=document.body.querySelector("#channel-header #inner-header-container #buttons")),(url=document.head.querySelector('link[type="application/rss+xml"][href]')?.href||(e=>a+"?channel_id="+e)(NOVA.getChannelId(e["user-api-key"])))&&l({url:url,container:t})}));break;case"playlist":NOVA.waitSelector("ytd-playlist-header-renderer .metadata-buttons-wrapper",{destroy_after_page_leaving:!0}).then((e=>{l({url:n,container:e,is_playlist:!0})}))}function l({url:e=required(),container:a=required(),is_playlist:n}){if(!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);(a.querySelector(`#${t}`)||function(){const e=document.createElement("a");return e.id=t,e.target="_blank",e.title="Nova RSS",e.className="yt-spec-button-shape-next--overlay",e.innerHTML='<svg viewBox="-35 -35 55 55" height="100%" width="100%" style="width: auto;">\n<g fill="currentColor">\n<path fill="#F60" d="M-17.392 7.875c0 3.025-2.46 5.485-5.486 5.485s-5.486-2.46-5.486-5.485c0-3.026 2.46-5.486 5.486-5.486s5.486 2.461 5.486 5.486zm31.351 5.486C14.042.744 8.208-11.757-1.567-19.736c-7.447-6.217-17.089-9.741-26.797-9.708v9.792C-16.877-19.785-5.556-13.535.344-3.66a32.782 32.782 0 0 1 4.788 17.004h8.827v.017zm-14.96 0C-.952 5.249-4.808-2.73-11.108-7.817c-4.821-3.956-11.021-6.184-17.255-6.15v8.245c6.782-.083 13.432 3.807 16.673 9.774a19.296 19.296 0 0 1 2.411 9.326h8.278v-.017z"/>\n</g>\n</svg>',Object.assign(e.style,{height:"20px",display:"inline-block",padding:"5px"}),n&&Object.assign(e.style,{"margin-right":"8px","border-radius":"20px","background-color":"var(--yt-spec-static-overlay-button-secondary)",color:"var(--yt-spec-static-overlay-text-primary)",padding:"8px","margin-right":"8px","white-space":"nowrap","font-size":"var(--ytd-tab-system-font-size, 1.4rem)","font-weight":"var(--ytd-tab-system-font-weight, 500)","letter-spacing":"var(--ytd-tab-system-letter-spacing, .007px)","text-transform":"var(--ytd-tab-system-text-transform, uppercase)"}),a.prepend(e),e}()).href=e}}}),window.nova_plugins.push({id:"shorts-redirect",title:"Redirect Shorts to regular (watch) URLs","title:zh":"将 Shorts 重定向到常规（watch）URL","title:ja":"ショートパンツを通常の（watch）URLにリダイレクトする","title:pl":"Przełączaj Shorts na zwykłe adresy URL",run_on_pages:"shorts",restart_on_location_change:!0,section:"player",desc:"Redirect Shorts video to normal player","desc:zh":"将 Shorts 视频重定向到普通播放器","desc:ja":"ショートパンツのビデオを通常のプレーヤーにリダイレクトする","desc:pl":"Przełącza krótkie filmy do normalnego odtwarzacza",_runtime:e=>{location.href=location.href.replace("shorts/","watch?v=")}}),window.nova_plugins.push({id:"collapse-navigation-panel",title:"Collapse navigation panel","title:zh":"折叠导航面板","title:ja":"ナビゲーション パネルを折りたたむ","title:pl":"Zwiń panel nawigacyjny",run_on_pages:"*, -watch, -embed, -live_chat",section:"other",_runtime:e=>{NOVA.waitSelector("#guide[opened]").then((e=>{document.getElementById("guide-button").click(),e.removeAttribute("opened")}))}}),window.nova_plugins.push({id:"channel-trailer-stop-preload",title:"Stop play channel trailer","title:zh":"停止频道预告片","title:ja":"チャンネルの予告編を停止する","title:pl":"Zatrzymaj zwiastun kanału",run_on_pages:"channel, -mobile",restart_on_location_change:!0,section:"channel",_runtime:e=>{NOVA.waitSelector("#c4-player.playing-mode",{destroy_after_page_leaving:!0}).then((e=>e.stopVideo()))}}),window.nova_plugins.push({id:"default-miniplayer-disable",title:"Disable miniplayer",run_on_pages:"results, feed, channel, watch, -mobile",section:"other",desc:"shown on changeable page when playing playlist",_runtime:e=>{NOVA.css.push(".ytp-right-controls .ytp-miniplayer-button {\ndisplay: none !important;\n}"),document.addEventListener("yt-action",(e=>{e.detail?.actionName.includes("miniplayer")&&document.body.querySelector("ytd-miniplayer[active]")?.remove()})),document.addEventListener("keydown",(e=>{["input","textarea"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||"watch"==NOVA.currentPage&&"KeyI"===e.code&&e.preventDefault()}),{capture:!0})}}),window.nova_plugins.push({id:"pages-clear",title:"Clear pages of junk","title:zh":"清除垃圾页面","title:ja":"ジャンクページをクリアする","title:pl":"Wyczyść strony ze śmieci",run_on_pages:"results, feed, watch, embed, -mobile",section:"other",desc:"Remove the annoying stuff","desc:zh":"删除烦人的东西","desc:ja":"煩わしいものを取り除く","desc:pl":"Usuń irytujące rzeczy",_runtime:e=>{let t=[".ytp-paid-content-overlay",".iv-branding",'#movie_player:not(:hover) > [class^="ytp-ce-"]',".ytp-cards-teaser-text","ytm-paid-content-overlay-renderer"];if("embed"===NOVA.currentPage)t.push([e["player-quick-buttons"]&&e.player_buttons_custom_items?.includes("card-switch")||".ytp-pause-overlay",".ytp-info-panel-preview"]);else t.push(["ytd-search-pyv-renderer",'[class^="ytd-promoted-"]',"ytd-search-pyv-renderer ~ ytd-shelf-renderer","ytd-video-renderer + ytd-shelf-renderer","#clarify-box","ytd-watch-metadata ytd-info-panel-content-renderer",".ytd-watch-flexy.attached-message","ytd-popup-container tp-yt-paper-dialog ytd-single-option-survey-renderer","#donation-shelf ytd-donation-unavailable-renderer","#subscribe-button .smartimation__border,\n#subscribe-button .smartimation__background,\nytd-watch-metadata #actions .smartimation__border,\nytd-watch-metadata #actions .smartimation__background",'[class^="ytp-cultural-moment"]',"ytd-donation-unavailable-renderer, .ytd-donation-unavailable-renderer",".sparkles-light-cta","ytd-feed-nudge-renderer"]),CSS.supports("selector(:has(*))")&&t.push(["ytd-rich-item-renderer:has(ytd-ad-slot-renderer)","#chat[collapsed] #message",'ytd-popup-container:has(yt-tooltip-renderer[position-type="OPEN_POPUP_POSITION_BOTTOM"])']);t.length&&NOVA.css.push(t.join(",\n")+" {\ndisplay: none !important;\n}")}}),window.nova_plugins.push({id:"scroll-to-top",title:'Add "Scroll to top" button',"title:zh":"滚动到顶部按钮","title:ja":"トップボタンまでスクロール","title:pl":"Przycisk przewijania do góry",run_on_pages:"*, -embed, -mobile, -live_chat",section:"other",desc:"Displayed on long pages","desc:zh":"出现在长页面上","desc:ja":"長いページに表示されます","desc:pl":"Wyświetlaj na długich stronach",_runtime:e=>{document.addEventListener("scroll",(function(){const t="nova-scrollTop-btn",a=document.createElement("button");a.id=t,Object.assign(a.style,{position:"fixed",cursor:"pointer",bottom:0,left:"20%",visibility:"hidden",opacity:.5,width:"40%",height:"40px",border:"none",outline:"none","z-index":1,"border-radius":"100% 100% 0 0","font-size":"16px","background-color":"rgba(0,0,0,.3)","box-shadow":"0 16px 24px 2px rgba(0, 0, 0, .14), 0 6px 30px 5px rgba(0, 0, 0, .12), 0 8px 10px -5px rgba(0, 0, 0, .4)"}),a.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:e.scroll_to_top_smooth?"smooth":"instant"}),e.scroll_to_top_autoplay&&"watch"==NOVA.currentPage&&["UNSTARTED","PAUSED"].includes(NOVA.getPlayerState())&&movie_player.playVideo()}));const n=document.createElement("span");Object.assign(n.style,{border:"solid white","border-width":"0 3px 3px 0",display:"inline-block",padding:"4px","vertical-align":"middle",transform:"rotate(-135deg)"}),a.append(n),document.body.append(a),NOVA.css.push(`#${t}:hover {\nopacity: 1 !important;\nbackground-color: rgba(0,0,0,.6) !important;\n}`);const l=document.getElementById(t);let o;window.addEventListener("scroll",(()=>{const e=document.documentElement.scrollTop>window.innerHeight/2;e!=o&&(o=e,l.style.visibility=e?"visible":"hidden")}))}),{capture:!0,once:!0})},options:{scroll_to_top_smooth:{_tagName:"input",label:"Smooth","label:zh":"光滑的","label:ja":"スムーズ","label:pl":"Płynnie",type:"checkbox"},scroll_to_top_autoplay:{_tagName:"input",label:"Unpause a video","label:zh":"视频取消暂停","label:ja":"ビデオの一時停止解除","label:pl":"Wyłącz wstrzymanie odtwarzania filmu",type:"checkbox"}}}),window.nova_plugins.push({id:"pause-background-tab",title:"Autopause when switching tabs","title:zh":"自动暂停除活动选项卡以外的所有选项卡","title:ja":"アクティブなタブを除くすべてのタブを自動一時停止","title:pl":"Zatrzymanie kart w tle oprócz aktywnej",run_on_pages:"watch, embed",section:"player",desc:"Autopause all background tabs except the active one",_runtime:e=>{if(location.hostname.includes("youtube-nocookie.com"))return void(location.hostname="youtube.com");if("undefined"==typeof window)return;const t="nova-playing-instanceIDTab",a=String(Math.random()),n=()=>localStorage.removeItem(t);NOVA.waitSelector("video").then((l=>{if(e.pause_background_tab_autoplay_onfocus&&e.pause_background_tab_autopause_unfocus);else{l.addEventListener("playing",(function(){!0!==e.pause_background_tab_autoplay_onfocus&&localStorage.hasOwnProperty(t)&&localStorage.getItem(t)!==a&&!document.pictureInPictureElement?l.pause():localStorage.setItem(t,a)})),["pause","ended"].forEach((e=>l.addEventListener(e,n))),window.addEventListener("beforeunload",n),window.addEventListener("storage",(e=>{document.hasFocus()&&"embed"!=NOVA.currentPage||e.key!==t||e.storageArea!==localStorage||!localStorage.hasOwnProperty(t)||localStorage.getItem(t)===a||"PLAYING"!=NOVA.getPlayerState()||document.pictureInPictureElement||l.pause()}))}e.pause_background_tab_autoplay_onfocus&&window.addEventListener("focus",(()=>{!localStorage.hasOwnProperty(t)&&localStorage.getItem(t)!==a&&["UNSTARTED","PAUSED"].includes(NOVA.getPlayerState())&&l.play()}),"force"!=e.pause_background_tab_autoplay_onfocus&&{capture:!0,once:!0}),e.pause_background_tab_autopause_unfocus&&window.addEventListener("blur",(()=>{"PLAYING"!=NOVA.getPlayerState()||document.pictureInPictureElement||l.pause()}))}))},options:{pause_background_tab_autoplay_onfocus:{_tagName:"select",label:"Autoplay on tab focus mode","label:zh":"在标签焦点上自动播放","label:ja":"タブフォーカスでの自動再生","label:pl":"Autoodtwarzanie po wybraniu karty",options:[{label:"disable",selected:!0},{label:"once for new tab",value:!0},{label:"always for not started",value:"force"}]},pause_background_tab_autopause_unfocus:{_tagName:"input",label:"Autopause if tab loses focus","label:zh":"如果选项卡失去焦点，则自动暂停视频","label:ja":"タブがフォーカスを失った場合にビデオを自動一時停止","label:pl":"Automatycznie wstrzymaj wideo, jeśli karta straci ostrość",type:"checkbox"}}}),window.nova_plugins.push({id:"video-rate",title:"Playback speed control","title:zh":"播放速度控制","title:ja":"再生速度制御","title:pl":"Kontrola prędkości odtwarzania",run_on_pages:"home, results, feed, channel, playlist, watch, embed",section:"player",desc:"With mouse wheel","desc:zh":"带鼠标滚轮","desc:ja":"マウスホイール付き","desc:pl":"Za pomocą kółka myszy",_runtime:e=>{e.rate_overlay_time&&1!=+e.rate_default&&function(){const t="nova-thumb-overlay-time-recalc";document.addEventListener("yt-action",(a=>{switch(a.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-service-request":case"ytd-rich-item-index-update-action":switch(NOVA.currentPage){case"home":case"results":case"feed":case"channel":case"watch":document.body.querySelectorAll(`#thumbnail #overlays #text:not([${t}])`).forEach((a=>{if(timeLabelEl=a.textContent.trim()){a.setAttribute(t,!0);const n=NOVA.formatTimeOut.hmsToSec(timeLabelEl);a.textContent=NOVA.formatTimeOut.HMS.digit(n/e.rate_default)}}))}}}))}(),NOVA.waitSelector("#movie_player video").then((l=>{const o=n.apply(l);l.addEventListener("ratechange",(function(){NOVA.showOSD(this.playbackRate+"x"),Object.keys(o).length&&(o.slider.value=this.playbackRate,o.slider.title=`Speed (${this.playbackRate})`,o.sliderLabel.textContent=`Speed (${this.playbackRate})`,o.sliderCheckbox.checked=1!==this.playbackRate)})),a.apply(l),l.addEventListener("loadeddata",a),Object.keys(o).length&&(o.slider.addEventListener("input",(({target:e})=>t.set(e.value))),o.slider.addEventListener("change",(({target:e})=>t.set(e.value))),o.slider.addEventListener("wheel",(a=>{a.preventDefault();t.adjust(+e.rate_step*Math.sign(a.wheelDelta))})),o.sliderCheckbox.addEventListener("change",(({target:e})=>{e.checked||t.set(1)}))),NOVA.runOnPageLoad((async()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||(e["save-channel-state"]&&(userRate=await NOVA.storage_obj_manager.getParam("speed"))&&l.addEventListener("playing",(()=>t.set(userRate)),{capture:!0,once:!0}),function(){if("object"!=typeof _yt_player)return console.error("expandAvailableRatesMenu > _yt_player is empty",_yt_player);Object.keys(_yt_player).length&&(path=NOVA.seachInObjectBy.key({obj:_yt_player,keys:"getAvailablePlaybackRates"})?.path)&&e(_yt_player,0,path.split("."));function e(t,a,n){n.length-1==a?t[n[a]]=()=>[.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,10]:e(t[n[a]],a+1,n)}}())}))})),"keyboard"==e.rate_hotkey?document.addEventListener("keydown",(a=>{if("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage)return;if(["input","textarea","select"].includes(a.target.localName)||a.target.isContentEditable)return;if(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey)return;let n;switch(1===e.rate_hotkey_custom_up.length?a.key:a.code){case e.rate_hotkey_custom_up:n=1;break;case e.rate_hotkey_custom_down:n=-1}if(n&&(a.preventDefault(),step=+e.rate_step*Math.sign(n))){t.adjust(step)}}),{capture:!0}):e.rate_hotkey&&NOVA.waitSelector(".html5-video-container").then((a=>{a.addEventListener("wheel",(a=>{if(a.preventDefault(),(a[e.rate_hotkey]||"none"==e.rate_hotkey&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&!a.metaKey)&&(step=+e.rate_step*Math.sign(a.wheelDelta))){t.adjust(step)}}),{capture:!0})})),1!=+e.rate_default&&e.rate_apply_music&&(NOVA.waitSelector("#upload-info #channel-name .badge-style-type-verified-artist").then((e=>t.set(1))),NOVA.waitSelector("#upload-info #channel-name a[href]",{destroy_after_page_leaving:!0}).then((e=>{(/(VEVO|Topic|Records|AMV)$/.test(e.textContent)||e.textContent.toUpperCase().includes("MUSIC"))&&t.set(1)})));const t={testDefault:t=>+t%.25==0&&+t<=2&&+e.rate_default<=2&&NOVA.videoElement?.playbackRate<=2&&NOVA.videoElement?.playbackRate%.25==0&&"object"==typeof movie_player&&"function"==typeof movie_player.getPlaybackRate,async set(e=1){this.log("set",...arguments),this.testDefault(e)?(this.log("set:default"),movie_player.setPlaybackRate(+e)&&this.saveInSession(e)):(this.log("set:html5"),NOVA.videoElement&&(NOVA.videoElement.playbackRate=+e,this.clearInSession()))},adjust(e=required()){return this.log("adjust",...arguments),this.testDefault(e)&&this.default(+e)||this.html5(+e)},default(e=required()){this.log("default",...arguments);const t=movie_player.getPlaybackRate(),a=(e=>{const a=t+e;return.1<=a&&a<=2&&+a.toFixed(2)})(+e);return!!a&&(a&&a!=t&&(movie_player.setPlaybackRate(a),a===movie_player.getPlaybackRate()?this.saveInSession(a):console.error("playerRate:default different: %s!=%s",a,movie_player.getPlaybackRate())),this.log("default return",a),a===movie_player.getPlaybackRate()&&a)},html5(t=required()){if(this.log("html5",...arguments),!NOVA.videoElement)return console.error("playerRate > videoElement empty:",NOVA.videoElement);const a=NOVA.videoElement.playbackRate,n=(t=>{const n=a+t;return.1<=n&&n<=(+e.rate_max||2)&&+n.toFixed(2)})(+t);return n&&n!=a&&(NOVA.videoElement.playbackRate=n,n===NOVA.videoElement.playbackRate?this.clearInSession():console.error("playerRate:html5 different: %s!=%s",n,NOVA.videoElement.playbackRate)),this.log("html5 return",n),n===NOVA.videoElement.playbackRate&&n},saveInSession(e=required()){try{sessionStorage["yt-player-playback-rate"]=JSON.stringify({creation:Date.now(),data:e.toString()}),this.log("playbackRate save in session:",...arguments)}catch(e){console.warn(`${e.name}: save "rate" in sessionStorage failed. It seems that "Block third-party cookies" is enabled`,e.message)}},clearInSession(){const e="yt-player-playback-rate";try{sessionStorage.hasOwnProperty(e)&&sessionStorage.removeItem(e),this.log("playbackRate save in session:",...arguments)}catch(e){console.warn(`${e.name}: save "rate" in sessionStorage failed. It seems that "Block third-party cookies" is enabled`,e.message)}},log(){this.DEBUG&&arguments.length&&(console.groupCollapsed(...arguments),console.trace(),console.groupEnd())}};function a(){if(1!=+e.rate_default){const a=NOVA.isMusic();this.playbackRate===+e.rate_default||e.rate_apply_music&&a||isNaN(this.duration)||!(this.duration>25)?1!==this.playbackRate&&a&&t.set(1):t.set(e.rate_default)}}function n(){const t="nova-rate-slider-menu",a="#"+t;NOVA.css.push(`${a} [type="range"] {\nvertical-align: text-bottom;\nmargin: '0 5px',\n}\n${a} [type="checkbox"] {\nappearance: none;\noutline: none;\ncursor: pointer;\n}\n${a} [type="checkbox"]:checked {\nbackground-color: #f00;\n}\n${a} [type="checkbox"]:checked:after {\nleft: 20px;\nbackground-color: white;\n}`);const n=document.createElement("input");n.className="ytp-menuitem-slider",n.type="range",n.min=+e.rate_step,n.max=Math.max(+e.rate_max||2,+e.rate_default),n.step=+e.rate_step,n.value=this.playbackRate;const l=document.createElement("div");l.className="ytp-menuitem-icon";const o=document.createElement("div");o.className="ytp-menuitem-label",o.textContent=`Speed (${this.playbackRate})`;const i=document.createElement("input");i.className="ytp-menuitem-toggle-checkbox",i.type="checkbox",i.title="Remember speed";const r={},s=document.createElement("div");s.className="ytp-menuitem-content",r.sliderCheckbox=s.appendChild(i),r.slider=s.appendChild(n);const c=document.createElement("div");return c.className="ytp-menuitem",c.id=t,c.append(l),r.sliderLabel=c.appendChild(o),c.append(s),document.body.querySelector(".ytp-panel-menu")?.append(c),r}},options:{rate_default:{_tagName:"input",label:"Speed at startup","label:zh":"启动速度","label:ja":"起動時の速度","label:pl":"Prędkość przy uruchamianiu",type:"number",title:"1 - default",step:.05,min:1,max:5,value:1},rate_apply_music:{_tagName:"select",label:"For music genre",title:"Extended detection - may trigger falsely","title:zh":"扩展检测 - 可能会错误触发","title:ja":"拡張検出-誤ってトリガーされる可能性があります","title:pl":"Rozszerzona detekcja - może działać błędnie",options:[{label:"skip",value:!0,selected:!0,"label:zh":"跳过","label:ja":"スキップ","label:pl":"tęsknić"},{label:"force apply",value:!1,"label:zh":"施力","label:ja":"力を加える","label:pl":"zastosować siłę"}],"data-dependent":{rate_default:"!1"}},rate_overlay_time:{_tagName:"input",label:"Recalculate time in thumbnail overlay",type:"checkbox",title:'by "startup" value',"data-dependent":{rate_default:"!1"}},rate_hotkey:{_tagName:"select",label:"Hotkey","label:zh":"热键","label:ja":"ホットキー","label:pl":"Klawisz skrótu",options:[{label:"none",value:!1},{label:"alt+wheel",value:"altKey",selected:!0},{label:"shift+wheel",value:"shiftKey"},{label:"ctrl+wheel",value:"ctrlKey"},{label:"wheel",value:"none"},{label:"keyboard",value:"keyboard"}]},rate_hotkey_custom_up:{_tagName:"select",label:"Hotkey up",options:[{label:"]",value:"]",selected:!0},{label:"none"},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"ArrowUp",value:"ArrowUp"},{label:"ArrowDown",value:"ArrowDown"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"[","+","-",",",".","/","<",";","\\"],"data-dependent":{rate_hotkey:["keyboard"]}},rate_hotkey_custom_down:{_tagName:"select",label:"Hotkey down",options:[{label:"[",value:"[",selected:!0},{label:"none"},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"ArrowUp",value:"ArrowUp"},{label:"ArrowDown",value:"ArrowDown"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","+","-",",",".","/","<",";","\\"],"data-dependent":{rate_hotkey:["keyboard"]}},rate_step:{_tagName:"input",label:"Hotkey step","label:zh":"步","label:ja":"ステップ","label:pl":"Krok",type:"number",title:"0.25 - default",placeholder:"0.1-1",step:.05,min:.05,max:.5,value:.25},rate_max:{_tagName:"input",label:"Hotkey Max",type:"number",title:"2 - default",placeholder:"2-5",step:.05,min:2,max:5,value:2,"data-dependent":{rate_hotkey:["!false","!"]}}}}),window.nova_plugins.push({id:"video-volume",title:"Volume","title:zh":"体积","title:ja":"音量","title:pl":"Głośność",run_on_pages:"watch, embed, -mobile",section:"player",desc:"With mouse wheel","desc:zh":"带鼠标滚轮","desc:ja":"マウスホイール付き","desc:pl":"Za pomocą kółka myszy",_runtime:e=>{NOVA.waitSelector("#movie_player video").then((a=>{if(a.addEventListener("volumechange",(function(){NOVA.showOSD(Math.round(100*this.volume)+"%"),t.buildVolumeSlider(),e.volume_mute_unsave&&t.saveInSession(movie_player.getVolume())})),e.volume_loudness_normalization){const{set:e}=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"volume");Object.defineProperty(HTMLMediaElement.prototype,"volume",{enumerable:!0,configurable:!0,set(t){t=movie_player.getVolume()/100,e.call(this,t)}})}"keyboard"==e.volume_hotkey?document.addEventListener("keydown",(a=>{if("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage)return;if(["input","textarea","select"].includes(a.target.localName)||a.target.isContentEditable)return;if(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey)return;let n;switch(1===e.volume_hotkey_custom_up.length?a.key:a.code){case e.volume_hotkey_custom_up:n=1;break;case e.volume_hotkey_custom_down:n=-1}if(n&&(a.preventDefault(),step=+e.volume_step*Math.sign(n))){t.adjust(step)}}),{capture:!0}):e.volume_hotkey&&NOVA.waitSelector(".html5-video-container").then((a=>{a.addEventListener("wheel",(a=>{if(a.preventDefault(),(a[e.volume_hotkey]||"none"==e.volume_hotkey&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&!a.metaKey)&&(step=+e.volume_step*Math.sign(a.wheelDelta))){t.adjust(step)}}),{capture:!0})})),(defaultLevel=+e.volume_default)&&a.addEventListener("playing",(()=>{defaultLevel>100?t.unlimit(defaultLevel):t.set(defaultLevel)}),{capture:!0,once:!0}),e["save-channel-state"]&&NOVA.runOnPageLoad((async()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||!(userVolume=await NOVA.storage_obj_manager.getParam("volume"))||a.addEventListener("playing",(()=>t.set(userVolume)),{capture:!0,once:!0})}))}));const t={adjust(t){const a=movie_player?.getVolume()+ +t;return e.volume_unlimit?this.unlimit(a):this.set(a)},set(e=50){if("object"!=typeof movie_player||!movie_player.hasOwnProperty("getVolume"))return console.error("Error getVolume");const t=Math.max(0,Math.min(100,+e));return t!==movie_player.getVolume()&&(movie_player.isMuted()&&movie_player.unMute(),movie_player.setVolume(t),t===movie_player.getVolume()||console.error("setVolumeLevel error! Different: %s!=%s",t,movie_player.getVolume())),t===movie_player.getVolume()&&t},saveInSession(e=required()){const t={creation:Date.now(),data:{volume:+e,muted:e?"false":"true"}};try{localStorage["yt-player-volume"]=JSON.stringify(Object.assign({expiration:Date.now()+2592e6},t)),sessionStorage["yt-player-volume"]=JSON.stringify(t)}catch(e){console.warn(`${e.name}: save "volume" in sessionStorage failed. It seems that "Block third-party cookies" is enabled`,e.message)}},unlimit(e=300){if(console.debug("unlimit:",e),e>100){if(!this.audioCtx){this.audioCtx=new AudioContext;const t=this.audioCtx.createMediaElementSource(NOVA.videoElement);this.node=this.audioCtx.createGain(),this.node.gain.value=Math.trunc(e/100),t.connect(this.node),this.node.connect(this.audioCtx.destination)}this.node.gain.value<6&&(this.node.gain.value+=1),NOVA.showOSD(movie_player.getVolume()*this.node.gain.value+"%")}else this.audioCtx&&1!==this.node.gain.value&&(this.node.gain.value=1),this.set(e)},buildVolumeSlider(e=800){(volumeArea=movie_player?.querySelector(".ytp-volume-area"))&&("number"==typeof this.showTimeout&&clearTimeout(this.showTimeout),volumeArea.dispatchEvent(new Event("mouseover",{bubbles:!0})),this.showTimeout=setTimeout((()=>volumeArea.dispatchEvent(new Event("mouseout",{bubbles:!0}))),e),function({text:e="",container:t=required()}){if(!(t instanceof HTMLElement))return console.error("container not HTMLElement:",t);const a="nova-volume-text";(document.getElementById(a)||function(){const e="#"+a;NOVA.css.push(`\n${e} {\ndisplay: none;\ntext-indent: 2px;\nfont-size: 110%;\ntext-shadow: 0 0 2px rgba(0, 0, 0, .5);\ncursor: default;\n}\n${e}:after { content: '%'; }\n.ytp-volume-control-hover:not([aria-valuenow="0"])+${e} {\ndisplay: block;\n}`);const n=document.createElement("span");return n.id=a,t.appendChild(n)}()).textContent=e,t.title=`${e} %`}({text:Math.round(movie_player.getVolume()),container:volumeArea}))}}},options:{volume_default:{_tagName:"input",label:"Default level","label:zh":"默认音量","label:ja":"デフォルトのボリューム","label:pl":"Poziom domyślny",type:"number",title:"0 - auto",placeholder:"%",step:5,min:0,max:600,value:100},volume_hotkey:{_tagName:"select",label:"Hotkey","label:zh":"热键","label:ja":"ホットキー","label:pl":"Klawisz skrótu",options:[{label:"none",value:!1},{label:"wheel",value:"none",selected:!0},{label:"shift+wheel",value:"shiftKey"},{label:"ctrl+wheel",value:"ctrlKey"},{label:"alt+wheel",value:"altKey"},{label:"keyboard",value:"keyboard"}]},volume_step:{_tagName:"input",label:"Hotkey step","label:zh":"步","label:ja":"ステップ","label:pl":"Krok",type:"number",title:"in %",placeholder:"%",min:1,max:30,value:10,"data-dependent":{volume_hotkey:["!false"]}},volume_hotkey_custom_up:{_tagName:"select",label:"Hotkey up",options:[{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"[","+","-",",",".","/","<",";","\\"],"data-dependent":{volume_hotkey:["keyboard"]}},volume_hotkey_custom_down:{_tagName:"select",label:"Hotkey down",options:[{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"[","+","-",",",".","/","<",";","\\"],"data-dependent":{volume_hotkey:["keyboard"]}},volume_mute_unsave:{_tagName:"input",label:"Not keep muted state","label:zh":"不保存静音模式","label:ja":"マナーモードを保存しない","label:pl":"Nie zachowuj wyciszonego stanu",type:"checkbox",title:"Only affects new tabs","title:zh":"只影响新标签","title:ja":"新しいタブにのみ影響します","title:pl":"Dotyczy tylko nowych kart"},volume_loudness_normalization:{_tagName:"input",label:"Stable volume level",type:"checkbox",title:"Boost volume level"},volume_unlimit:{_tagName:"input",label:"Allow above 100%","label:zh":"允许超过 100%","label:ja":"100％以上を許可する","label:pl":"Zezwól powyżej 100%",type:"checkbox",title:"With sound distortion","data-dependent":{volume_hotkey:["!false"]}}}}),window.nova_plugins.push({id:"player-pin-scroll",title:"Pin player while scrolling","title:zh":"滚动时固定播放器","title:ja":"スクロール中にプレイヤーを固定する","title:pl":"Przypnij odtwarzacz podczas przewijania",run_on_pages:"watch, -mobile",section:"player",desc:"Show mini player when scrolling down",_runtime:e=>{if(!("IntersectionObserver"in window))return alert("Nova\n\nPin player Error!\nIntersectionObserver not supported.");const t="nova-player-pin",a="."+t,n=t+"-unpin-btn",l="."+n;document.addEventListener("scroll",(()=>{NOVA.waitSelector("#ytd-player").then((e=>{new IntersectionObserver((([e])=>{e.isIntersecting?(movie_player.classList.remove(t),o.reset(),o.disable()):!document.fullscreenElement&&document.documentElement.scrollTop&&(movie_player.classList.add(t),o.init(movie_player),o.storePos?.X&&o.moveByCoordinates(o.storePos)),window.dispatchEvent(new Event("resize"))}),{threshold:.5}).observe(e)}))}),{capture:!0,once:!0}),NOVA.waitSelector(a).then((async i=>{if(await NOVA.waitUntil((()=>NOVA.videoElement?.videoWidth&&!isNaN(NOVA.videoElement.videoWidth)&&NOVA.videoElement?.videoHeight&&!isNaN(NOVA.videoElement.videoHeight)),500),function(){const t=(window.innerWidth-document.documentElement.clientWidth||0)+"px",n=NOVA.aspectRatio.sizeToFit({srcWidth:NOVA.videoElement.videoWidth,srcHeight:NOVA.videoElement.videoHeight,maxWidth:window.innerWidth/e.player_float_scroll_size_ratio,maxHeight:window.innerHeight/e.player_float_scroll_size_ratio});let l={width:NOVA.aspectRatio.calculateWidth(n.height,NOVA.aspectRatio.chooseAspectRatio({width:n.width,height:n.height}))+"px",height:n.height+"px",position:"fixed","z-index":"var(--zIndex)","box-shadow":"0 16px 24px 2px rgba(0, 0, 0, .14),0 6px 30px 5px rgba(0, 0, 0, .12),0 8px 10px -5px rgba(0, 0, 0, .4)"};switch(e.player_float_scroll_position){case"top-left":l.top=e["header-unfixed"]?0:(document.getElementById("masthead-container")?.offsetHeight||0)+"px",l.left=0;break;case"top-right":l.top=e["header-unfixed"]?0:(document.getElementById("masthead-container")?.offsetHeight||0)+"px",l.right=t;break;case"bottom-left":l.bottom=0,l.left=0;break;case"bottom-right":l.bottom=0,l.right=t}NOVA.css.push(l,a,"important"),NOVA.css.push(`html[style*="ytrb-bar"] ${a} {\n--zIndex: 1000;\n}\n${a} {\n--height: ${l.height} !important;\n--width: ${l.width} !important;\nwidth: var(--width) !important;\nheight: var(--height) !important;\nbackground-color: var(--yt-spec-base-background);\n${e["square-avatars"]?"":"border-radius: 12px;"}\nmargin: 1em 2em;\n--zIndex: ${1+Math.max(NOVA.css.get("#chat","z-index"),NOVA.css.get(".ytp-chrome-top .ytp-cards-button","z-index"),NOVA.css.get("#chat","z-index"),NOVA.css.get("ytrb-bar","z-index"),601)};\n}\n${a} video {\nobject-fit: contain !important;\n}\n${a} .ytp-chrome-controls .nova-right-custom-button,\n${a} .ytp-chrome-controls #nova-player-time-remaining,\n${a} .ytp-chrome-controls button.ytp-size-button,\n${a} .ytp-chrome-controls button.ytp-subtitles-button,\n${a} .ytp-chrome-controls button.ytp-settings-button,\n${a} .ytp-chrome-controls .ytp-chapter-container {\ndisplay: none !important;\n}`),NOVA.css.push(`\n${a} .ytp-preview,\n${a} .ytp-scrubber-container,\n${a} .ytp-hover-progress,\n${a} .ytp-gradient-bottom { display:none !important; }\n${a} .ytp-chrome-bottom { width: 96% !important; }\n${a} .ytp-chapters-container { display: flex; }`),NOVA.css.push(`${a} video {\nwidth: var(--width) !important;\nheight: var(--height) !important;\nleft: 0 !important;\ntop: 0 !important;\n}\n${a}.ended-mode video {\nvisibility: hidden;\n}`)}(),function(i=movie_player){NOVA.css.push(l+` { display: none; }\n${a} ${l} {\ndisplay: inherit !important;\nposition: absolute;\ncursor: pointer;\ntop: 10px;\nleft: 10px;\nwidth: 28px;\nheight: 28px;\ncolor: white;\nborder: none;\noutline: none;\nopacity: .1;\n${e["square-avatars"]?"":"border-radius: 100%;"}\nz-index: var(--zIndex);\nfont-size: 24px;\nfont-weight: bold;\nbackground-color: rgba(0, 0, 0, .8);\ntransition: opacity 100ms linear;\n}\n${a}:hover ${l} { opacity: .7; }\n${l}:hover { opacity: 1 !important; }`);const r=document.createElement("button");r.className=n,r.title="Unpin player",r.textContent="×",r.addEventListener("click",(()=>{i.classList.remove(t),o.reset("clear storePos"),window.dispatchEvent(new Event("resize"))})),i.append(r),document.addEventListener("yt-navigate-start",(()=>{i.classList.contains(t)&&(i.classList.remove(t),o.reset())}))}(i),document.addEventListener("fullscreenchange",(()=>document.fullscreenElement&&movie_player.classList.remove(t))),NOVA.waitSelector("#movie_player video").then((e=>{e.addEventListener("loadeddata",(()=>{"watch"==NOVA.currentPage&&NOVA.waitSelector(a,{destroy_after_page_leaving:!0}).then((()=>{const e=NOVA.aspectRatio.calculateWidth(movie_player.clientHeight,NOVA.aspectRatio.chooseAspectRatio({width:NOVA.videoElement.videoWidth,height:NOVA.videoElement.videoHeight,layout:"landscape"}));i.style.setProperty("--width",`${e}px !important;`)}))}))})),e.player_float_scroll_after_fullscreen_restore_srcoll_pos){let e=0;document.addEventListener("yt-navigate-start",(()=>e=0)),document.addEventListener("fullscreenchange",(()=>{!document.fullscreenElement&&e&&o.storePos&&window.scrollTo({top:e})}),{capture:!1}),document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement&&(e=document.documentElement.scrollTop)}),{capture:!0})}}));const o={attrNameMoving:"nova-el-moving",init(e=required()){if(this.log("drag init",...arguments),!(e instanceof HTMLElement))return console.error("el_target not HTMLElement:",e);this.dragTarget=e,document.addEventListener("touchstart",this.dragStart.bind(this)),document.addEventListener("touchend",this.dragEnd.bind(this)),document.addEventListener("touchmove",this.draging.bind(this)),document.addEventListener("mousedown",this.dragStart.bind(this)),document.addEventListener("mouseup",this.dragEnd.bind(this)),document.addEventListener("mousemove",this.draging.bind(this))},reset(e){this.dragTarget?.style.removeProperty("transform"),this.storePos=e?this.xOffset=this.yOffset=0:{X:this.xOffset,Y:this.yOffset}},disable(){this.log("dragDisable",...arguments),this.dragTarget=null,document.removeEventListener("touchstart",this.dragStart),document.removeEventListener("touchend",this.dragEnd),document.removeEventListener("touchmove",this.draging),document.removeEventListener("mousedown",this.dragStart),document.removeEventListener("mouseup",this.dragEnd),document.removeEventListener("mousemove",this.draging)},dragStart(e){if(this.dragTarget.contains(e.target)){switch(this.log("dragStart"),e.type){case"touchstart":this.initialX=e.touches[0].clientX-(this.xOffset||0),this.initialY=e.touches[0].clientY-(this.yOffset||0);break;case"mousedown":this.initialX=e.clientX-(this.xOffset||0),this.initialY=e.clientY-(this.yOffset||0)}this.moving=!0}},dragEnd(e){this.moving&&(this.log("dragEnd"),this.initialX=this.currentX,this.initialY=this.currentY,this.moving=!1,this.dragTarget.style.pointerEvents=null,document.body.style.removeProperty("cursor"),this.dragTarget.removeAttribute(this.attrNameMoving))},draging(e){if(this.moving){switch(this.log("draging"),this.dragTarget.style.pointerEvents="none",document.body.style.cursor="move",this.dragTarget.hasAttribute(this.attrNameMoving)||this.dragTarget.setAttribute(this.attrNameMoving,!0),e.type){case"touchmove":this.currentX=e.touches[0].clientX-this.initialX,this.currentY=e.touches[0].clientY-this.initialY;break;case"mousemove":const t=this.dragTarget.getBoundingClientRect();t.left>=document.body.clientWidth-this.dragTarget.offsetWidth?this.currentX=Math.min(e.clientX-this.initialX,document.body.clientWidth-this.dragTarget.offsetWidth-this.dragTarget.offsetLeft):this.currentX=Math.max(e.clientX-this.initialX,0-this.dragTarget.offsetLeft),t.top>=window.innerHeight-this.dragTarget.offsetHeight?this.currentY=Math.min(e.clientY-this.initialY,window.innerHeight-this.dragTarget.offsetHeight-this.dragTarget.offsetTop):this.currentY=Math.max(e.clientY-this.initialY,0-this.dragTarget.offsetTop)}this.xOffset=this.currentX,this.yOffset=this.currentY,this.moveByCoordinates({X:this.currentX,Y:this.currentY})}},moveByCoordinates({X:e=required(),Y:t=required()}){this.log("moveByCoordinates",...arguments),this.dragTarget.style.transform=`translate3d(${e}px, ${t}px, 0)`},log(){this.DEBUG&&arguments.length&&(console.groupCollapsed(...arguments),console.trace(),console.groupEnd())}}},options:{player_float_scroll_size_ratio:{_tagName:"input",label:"Player size","label:zh":"播放器尺寸","label:ja":"プレーヤーのサイズ","label:pl":"Rozmiar odtwarzacza",type:"number",title:"Less value - larger size","title:zh":"较小的值 - 较大的尺寸","title:ja":"小さい値-大きいサイズ","title:pl":"Mniejsza wartość - większy rozmiar",placeholder:"2-5",step:.1,min:1,max:5,value:2.5},player_float_scroll_position:{_tagName:"select",label:"Player position","label:zh":"球员位置","label:ja":"プレイヤーの位置","label:pl":"Pozycja odtwarzacza",options:[{label:"↖",value:"top-left"},{label:"↗",value:"top-right",selected:!0},{label:"↙",value:"bottom-left"},{label:"↘",value:"bottom-right"}]},player_float_scroll_after_fullscreen_restore_srcoll_pos:{_tagName:"input",label:"Restore scrolling back there after exiting fullscreen",type:"checkbox"}}}),window.nova_plugins.push({id:"video-quality",title:"Video quality","title:zh":"视频质量","title:ja":"ビデオ品質","title:pl":"Jakość wideo",run_on_pages:"watch, embed",section:"player",_runtime:e=>{const t={highres:4320,hd2880:2880,hd2160:2160,hd1440:1440,hd1080:1080,hd720:720,large:480,medium:360,small:240,tiny:144};let a=e.video_quality;async function n(l){if(!a)return console.error("selectedQuality unavailable",a);if(e.video_quality_for_music&&location.search.includes("list=")&&NOVA.isMusic()&&(a=e.video_quality_for_music),1!=l&&3!=l||this.quality_lock)l<=0&&(this.quality_lock=!1);else{let l;if(this.quality_lock=!0,await NOVA.waitUntil((()=>(l=movie_player.getAvailableQualityLevels())&&l.length),50),e.video_quality_premium&&(qualityToSet=[...movie_player.getAvailableQualityData()].find((e=>e.isPlayable&&e.qualityLabel?.toLocaleLowerCase().includes("premium")))?.qualityLabel))return async function(e=required()){const t="#movie_player";(await NOVA.waitSelector(`${t} .ytp-chrome-bottom button.ytp-settings-button[aria-expanded="false"]`)).click();[...document.body.querySelectorAll(`${t} .ytp-settings-menu [role="menuitem"] .ytp-menuitem-content`)].find((e=>e.textContent.toLocaleLowerCase().includes("auto")||NOVA.extractAsNum.int(e.textContent)>=144)).click();const a=[...document.body.querySelectorAll('.ytp-quality-menu [role="menuitemradio"]')].find((t=>t.textContent.includes(e)));await NOVA.delay(1500),a.click(),document.body.click(),document.body.querySelector("video").focus(),n.quality_lock=!0}(qualityToSet);const o="watch"==NOVA.currentPage?screen.width:window.innerWidth,i=l.findIndex((e=>t[e]<=1.3*o));l=l.slice(i);const r=function(){let e=l.indexOf(a);if(-1===e){const n=Object.keys(t).filter((e=>l.includes(e)||e==a)).findIndex((e=>e===a))-1;e=l[n]?n:0}return e}(),s=l[r];"function"==typeof movie_player.setPlaybackQuality&&movie_player.setPlaybackQuality(s),"function"==typeof movie_player.setPlaybackQualityRange&&movie_player.setPlaybackQualityRange(s,s)}}NOVA.waitSelector("#movie_player").then((t=>{if(e.video_quality_manual_save_in_tab&&"watch"==NOVA.currentPage&&t.addEventListener("onPlaybackQualityChange",(t=>{"menuitemradio"==document.activeElement.getAttribute("role")&&t!==a&&(console.info(`keep quality "${t}" in the session`),a=t,e.video_quality_for_music=!1,e.video_quality_for_fullscreen=!1)})),e["save-channel-state"]&&NOVA.runOnPageLoad((async()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||!(userQuality=await NOVA.storage_obj_manager.getParam("quality"))||(a=userQuality)})),n(),t.addEventListener("onStateChange",n),e.video_quality_for_fullscreen){let n=a;document.addEventListener("fullscreenchange",(()=>{a=document.fullscreenElement?e.video_quality_for_fullscreen:n,t.setPlaybackQualityRange(a,a)}))}})),NOVA.waitSelector('.ytp-error [class*="reason"]',{destroy_after_page_leaving:!0}).then((e=>{if(alertText=e.textContent)throw alertText}))},options:{video_quality:{_tagName:"select",label:"Default","label:zh":"默认视频质量","label:ja":"デフォルトのビデオ品質","label:pl":"Domyślna jakość",options:[{label:"8K/4320p",value:"highres"},{label:"5K/2880p",value:"hd2880"},{label:"4K/2160p",value:"hd2160"},{label:"QHD/1440p",value:"hd1440"},{label:"FHD/1080p",value:"hd1080",selected:!0},{label:"HD/720p",value:"hd720"},{label:"480p",value:"large"},{label:"360p",value:"medium"},{label:"SD/240p",value:"small"},{label:"144p",value:"tiny"}]},video_quality_premium:{_tagName:"input",label:"Use Premium bitrate if available",type:"checkbox"},video_quality_manual_save_in_tab:{_tagName:"input",label:"Save manual selection for next video","label:zh":"手动选择的质量保存在当前选项卡中","label:ja":"手動で選択した品質が現在のタブに保存されます","label:pl":"Właściwości dla obecnej karty",type:"checkbox",title:"Affects to next videos","title:zh":"对下一个视频的影响","title:ja":"次の動画への影響","title:pl":"Zmiany w następnych filmach"},video_quality_for_music:{_tagName:"select",label:"For music (in playlists)",title:"to save traffic / increase speed","title:zh":"节省流量/提高速度","title:ja":"トラフィックを節約/速度を上げる","title:pl":"aby zaoszczędzić ruch / zwiększyć prędkość",options:[{label:"QHD/1440p",value:"hd1440"},{label:"FHD/1080p",value:"hd1080"},{label:"HD/720p",value:"hd720"},{label:"SD/480p",value:"large"},{label:"SD/360p",value:"medium"},{label:"SD/240p",value:"small"},{label:"SD/144p",value:"tiny"},{label:"Auto",value:"auto"},{label:"default",selected:!0}]},video_quality_for_fullscreen:{_tagName:"select",label:"For fullscreen",options:[{label:"8K/4320p",value:"highres"},{label:"4K/2160p",value:"hd2160"},{label:"QHD/1440p",value:"hd1440"},{label:"FHD/1080p",value:"hd1080"},{label:"HD/720p",value:"hd720"},{label:"SD/480p",value:"large"},{label:"SD/360p",value:"medium"},{label:"default",selected:!0}]}}}),window.nova_plugins.push({id:"player-resume-playback",title:"Remember playback time","title:zh":"恢复播放时间状态","title:ja":"再生時間の位置を再開します","title:pl":"Powrót do pozycji czasowej odtwarzania",run_on_pages:"watch, embed",section:"player",desc:"On page reload - resume playback","desc:zh":"在页面重新加载 - 恢复播放","desc:ja":"ページがリロードされると、再生が復元されます","desc:pl":"Przy ponownym załadowaniu strony - wznawiaj odtwarzanie",_runtime:e=>{if(!navigator.cookieEnabled&&"embed"==NOVA.currentPage)return;const t=()=>"nova-resume-playback-time:"+(NOVA.queryURL.get("v")||movie_player.getVideoData().video_id);let a;function n(){this.currentTime>5&&this.duration>30&&!movie_player.classList.contains("ad-showing")&&sessionStorage.setItem(a,Math.trunc(this.currentTime))}async function l(){NOVA.queryURL.has("t")||NOVA.queryURL.getHashParam("t")||e["save-channel-state"]&&await NOVA.storage_obj_manager.getParam("ignore-playback")||(a=t(),(time=+sessionStorage.getItem(a))&&time<this.duration-1&&(this.currentTime=time))}function o(){let e;this.addEventListener("pause",(()=>{this.currentTime<this.duration-1&&this.currentTime>5&&this.duration>10&&(e=setTimeout((()=>{NOVA.updateUrl(NOVA.queryURL.set({t:Math.trunc(this.currentTime)+"s"}))}),100))})),this.addEventListener("playing",(()=>{"number"==typeof e&&clearTimeout(e),NOVA.queryURL.has("t")&&NOVA.updateUrl(NOVA.queryURL.remove("t"))}))}NOVA.waitSelector("#movie_player video").then((i=>{a=t(),l.apply(i),i.addEventListener("loadeddata",l.bind(i)),i.addEventListener("timeupdate",n.bind(i)),i.addEventListener("ended",(()=>sessionStorage.removeItem(a))),e.player_resume_playback_url_mark&&"embed"!=NOVA.currentPage&&(NOVA.queryURL.has("t")||NOVA.queryURL.getHashParam("t")?document.addEventListener("yt-navigate-finish",o.bind(i),{capture:!0,once:!0}):o.apply(i))}))},options:{player_resume_playback_url_mark:{_tagName:"input",label:"Mark time in URL when paused","label:zh":"暂停时在 URL 中节省时间","label:ja":"一時停止したときにURLで時間を節約する","label:pl":"Zaznacz czas w adresie URL po wstrzymaniu",type:"checkbox",title:"Makes sense when saving bookmarks","title:zh":"保存书签时有意义","title:ja":"ブックマークを保存するときに意味があります","title:pl":"Ma sens podczas zapisywania zakładek"}}}),window.nova_plugins.push({id:"video-autostop",title:"Stop video preload","title:zh":"停止视频预加载","title:ja":"ビデオのプリロードを停止します","title:pl":"Zatrzymaj ładowanie wideo",run_on_pages:"watch, embed",section:"player",desc:"Prevent auto-buffering",_runtime:e=>{e.video_autostop_embed&&"embed"!=NOVA.currentPage||location.hostname.includes("youtube.googleapis.com")||NOVA.queryURL.has("popup")||"embed"==NOVA.currentPage&&window.self!==window.top&&["0","false"].includes(NOVA.queryURL.get("autoplay"))||(e.video_autostop_peview_thumbnail&&"watch"==NOVA.currentPage&&NOVA.css.push(`.unstarted-mode {\nbackground: url("https://i.ytimg.com/vi/${NOVA.queryURL.get("v")}/maxresdefault.jpg") center center / contain no-repeat content-box;\n}\n.unstarted-mode video {\nopacity: 0 !important;\n}`),NOVA.waitSelector("#movie_player").then((async t=>{let a;function n(){a||(a=!0,t.playVideo())}document.addEventListener("yt-navigate-start",(()=>a=!1)),await NOVA.waitUntil((()=>"object"==typeof t&&"function"==typeof t.stopVideo),100),t.stopVideo(),t.addEventListener("onStateChange",function(n){if(e.video_autostop_ignore_playlist&&location.search.includes("list="))return;if(e.video_autostop_ignore_live&&t.getVideoData().isLive)return;!a&&n>0&&n<5&&t.stopVideo()}.bind(this)),document.addEventListener("keyup",(e=>{if(!("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey))switch(e.code){case"KeyK":case"Space":case"MediaPlay":case"MediaPlayPause":n()}})),navigator.mediaSession.setActionHandler("play",n),document.addEventListener("click",(e=>{e.isTrusted&&e.target.closest("#movie_player")&&!a&&(e.preventDefault(),e.stopImmediatePropagation(),n())}),{capture:!0})})))},options:{video_autostop_embed:{_tagName:"select",label:"Apply to video type",options:[{label:"all",value:!1,selected:!0},{label:"embed",value:"on"}]},video_autostop_ignore_playlist:{_tagName:"input",label:"Ignore playlist","label:zh":"忽略播放列表","label:ja":"プレイリストを無視する","label:pl":"Zignoruj listę odtwarzania",type:"checkbox","data-dependent":{video_autostop_embed:!1}},video_autostop_ignore_live:{_tagName:"input",label:"Ignore live",type:"checkbox","data-dependent":{video_autostop_embed:!1}},video_autostop_peview_thumbnail:{_tagName:"input",label:"Display preview thumbnail",type:"checkbox",title:"Instead black-screen","data-dependent":{video_autostop_embed:!1}}}}),window.nova_plugins.push({id:"subtitle-style",title:"Subtitles (captions) style","title:zh":"字幕样式","title:ja":"字幕スタイル","title:pl":"Styl napisów",run_on_pages:"watch, embed, -mobile",section:"player",_runtime:async e=>{const t=".ytp-caption-segment";let a={};e.subtitle_transparent&&(a={background:"Transparent","text-shadow":"rgb(0, 0, 0) 0 0 .1em,\nrgb(0, 0, 0) 0 0 .2em,\nrgb(0, 0, 0) 0 0 .4em"}),e.subtitle_bold&&(a["font-weight"]="bold"),Object.keys(a).length&&NOVA.css.push(a,t,"important"),e.subtitle_fixed&&NOVA.css.push((CSS.supports("selector(:has(*))")?"#ytp-caption-window-container:has(~ .ytp-chrome-bottom:not(:hover))":"")+" .caption-window:not(:hover) {\nmargin-bottom: 1px !important;\nbottom: 1% !important;\n}"),e.subtitle_selectable&&NOVA.watchElements({selectors:[t],callback:e=>{e.addEventListener("mousedown",(e=>e.stopPropagation()),{capture:!0}),e.setAttribute("draggable","false"),e.setAttribute("selectable","true"),e.style.userSelect="text",e.style.WebkitUserSelect="text",e.style.cursor="text"}}),"#ffffff"!=e.subtitle_color&&NOVA.css.push(`${t} { color: ${e.subtitle_color} !important;  }`),+e.subtitle_font_size&&NOVA.css.push(`${t} { font-size: calc(32px * ${+e.subtitle_font_size||1}) !important; }`),e.subtitle&&(await NOVA.waitUntil((()=>"object"==typeof movie_player&&"function"==typeof movie_player.toggleSubtitlesOn),500),movie_player.toggleSubtitlesOn())},options:{subtitle:{_tagName:"input",label:"Subtitles show by default",type:"checkbox"},subtitle_fixed:{_tagName:"input",label:"Fixed from below","label:zh":"从下方固定","label:ja":"下から固定","label:pl":"Przyklejone na dole",type:"checkbox",title:"Preventing captions jumping up/down when pause/resume","title:zh":"暂停/恢复时防止字幕跳上/跳下","title:ja":"一時停止/再開時にキャプションが上下にジャンプしないようにする","title:pl":"Zapobieganie przeskakiwaniu napisów w górę/w dół podczas pauzy/wznowienia"},subtitle_selectable:{_tagName:"input",label:"Make selectable","label:zh":"使字幕可选","label:ja":"字幕を選択可能にする","label:pl":"Ustaw napisy do wyboru",type:"checkbox"},subtitle_font_size:{_tagName:"input",label:"Font size","label:zh":"字体大小","label:ja":"フォントサイズ","label:pl":"Rozmiar czcionki",type:"number",title:"0 - default",placeholder:"0-5",step:1,min:0,max:5,value:0},subtitle_transparent:{_tagName:"input",label:"Transparent","label:zh":"透明的","label:ja":"透明","label:pl":"Przezroczyste",type:"checkbox"},subtitle_bold:{_tagName:"input",label:"Bold text","label:zh":"粗体","label:ja":"太字","label:pl":"Tekst pogrubiony",type:"checkbox"},subtitle_color:{_tagName:"input",type:"color",value:"#ffffff",label:"Color","label:zh":"颜色","label:ja":"色","label:pl":"Kolor",title:"default - #FFF"}}}),window.nova_plugins.push({id:"video-unblock-region",title:"Redirect video not available in your country","title:zh":"尝试解锁您所在地区的视频","title:ja":"お住まいの地域の動画のブロックを解除してみてください","title:pl":"Spróbuj odblokować, jeśli film nie jest dostępny w Twoim kraju",run_on_pages:"watch, embed, -mobile",section:"player",opt_api_key_warn:!0,desc:"Some mirrors will partially replace VPNs",_runtime:e=>{const t='#movie_player.ytp-embed-error .ytp-error[role="alert"] .ytp-error-content-wrap-subreason:not(:empty)',a=`ytd-watch-flexy[player-unavailable] #player-error-message-container #info, ${t}`;NOVA.waitSelector(a,{destroy_after_page_leaving:!0}).then((async e=>{if(e.querySelector("button"))return;!function(e=required(),t=required()){if(!(e instanceof HTMLElement))return console.error("container not HTMLElement:",e);NOVA.css.push(`${a} ul {\nborder-radius: 12px;\nbackground-color: var(--yt-spec-badge-chip-background);\nfont-size: 1.4rem;\nline-height: 2rem;\npadding: 10px;\n}\n${a} li {\ncolor: var(--yt-spec-text-primary);\n}\n${a} a:not(:hover) {\ncolor: var(--yt-spec-text-primary);\ntext-decoration: none;\n}`);const n=document.createElement("ul");[{label:"hooktube.com",value:"hooktube.com"},{label:"clipzag.com",value:"clipzag.com"},{label:"piped.video",value:"piped.video"},{label:"yewtu.be",value:"yewtu.be"},{label:"nsfwyoutube.com",value:"nsfwyoutube.com"},{label:"yout-ube.com",value:"yout-ube.com"},{label:"riservato-xyz.frama.io",value:"riservato-xyz.frama.io"}].forEach((e=>{const a=document.createElement("li"),l=document.createElement("a");l.href=`${location.protocol}//${e.value}${location.port?":"+location.port:""}/watch?v=${t}`,l.target="_blank",l.textContent="→ Open with "+e.label,l.title="Open with "+e.label,a.append(l),n.append(a)}));const l=document.createElement("li");l.className="bold style-scope yt-formatted-string",l.textContent="Enable map select allowed country in your VPN",n.append(l),e.append(n)}(e,NOVA.queryURL.get("v")||movie_player.getVideoData().video_id)})),NOVA.waitSelector(`ytd-watch-flexy[player-unavailable], ${t}`,{destroy_after_page_leaving:!0}).then((t=>{e.video_unblock_region_domain&&t.querySelector("yt-player-error-message-renderer #button.yt-player-error-message-renderer button")&&confirm("Nova [video-unblock-region]\nThe video is not available in your region, open a in mirror?")&&function(t){const a=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id;t?window.open(`${location.protocol}//${e.video_unblock_region_domain||"hooktube.com"}${location.port?":"+location.port:""}/watch?v=${a}`):location.hostname=e.video_unblock_region_domain||"hooktube.com"}(),e.video_unblock_region_open_map&&NOVA.request.API({request:"videos",params:{id:NOVA.queryURL.get("v")||movie_player.getVideoData().video_id,part:"contentDetails"},api_key:e["user-api-key"]}).then((e=>{if(e?.error)return alert(`Error [${e.code}]: ${e?.message}`);e?.items?.forEach((e=>{if(data=e.contentDetails?.regionRestriction){const e=NOVA.queryURL.set(data,"https://raingart.github.io/region_map/");NOVA.openPopup({url:e,width:"1200px",height:"600px"})}}))}))}))},options:{video_unblock_region_domain:{_tagName:"input",label:"Redirect to URL",type:"text",list:"video_unblock_region_domain_help_list",pattern:"^[a-zA-Z0-9-]{2,20}.[a-zA-Z]{2,5}$",title:'without "https://"',"title:zh":"没有“https://”","title:ja":"「https://」なし","title:pl":"bez „https://”",placeholder:"domain.com",minlength:5,maxlength:20},video_unblock_region_domain_help_list:{_tagName:"datalist",options:[{label:"hooktube.com",value:"hooktube.com"},{label:"clipzag.com",value:"clipzag.com"},{label:"piped.video",value:"piped.video"},{label:"yewtu.be",value:"yewtu.be"},{label:"nsfwyoutube.com",value:"nsfwyoutube.com"},{label:"yout-ube.com",value:"yout-ube.com"},{label:"riservato-xyz.frama.io",value:"riservato-xyz.frama.io"}]},video_unblock_region_open_map:{_tagName:"input",label:"Open the map","label:zh":"打开可用区域的地图","label:ja":"利用可能な地域の地図を開く","label:pl":"Otwórz mapę z dostępnością w regionach",type:"checkbox",title:"which regions is available"}}}),window.nova_plugins.push({id:"video-autopause",title:"Video autopause","title:zh":"视频自动暂停","title:ja":"ビデオの自動一時停止","title:ko":"비디오 자동 일시 중지","title:id":"Jeda otomatis video","title:es":"Pausa automática de video","title:it":"Pausa automatica del video","title:pl":"Automatyczne zatrzymanie wideo",run_on_pages:"watch, embed",section:"player",desc:"Disable autoplay","desc:zh":"禁用自动播放","desc:ja":"自動再生を無効にする","desc:ko":"자동 재생 비활성화","desc:it":"Nonaktifkan putar otomatis","desc:es":"Deshabilitar reproducción automática","desc:it":"Disabilita la riproduzione automatica","desc:pl":"Wyłącz autoodtwarzanie","data-conflict":"video-autostop",_runtime:e=>{e["video-stop-preload"]&&!e.stop_preload_embed||NOVA.queryURL.has("popup")||e.video_autopause_embed&&"embed"!=NOVA.currentPage||"embed"==NOVA.currentPage&&window.self!==window.top&&["0","false"].includes(NOVA.queryURL.get("autoplay"))||NOVA.waitSelector("#movie_player video").then((t=>{if(e.video_autopause_ignore_live&&movie_player.getVideoData().isLive)return;n.apply(t),NOVA.runOnPageLoad((async()=>{location.search.includes("list=")||"watch"!=NOVA.currentPage||t.addEventListener("playing",n,{capture:!0,once:!0})}));const a=HTMLVideoElement.prototype.play;function n(){movie_player.pauseVideo(),this.paused||this.pause()}function l(){l=function(){},HTMLVideoElement.prototype.play=a,movie_player.playVideo()}HTMLVideoElement.prototype.play=n,document.addEventListener("keyup",(e=>{if(!("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey))switch(e.code){case"KeyK":case"Space":case"MediaPlay":case"MediaPlayPause":l()}})),navigator.mediaSession.setActionHandler("play",l),document.addEventListener("click",(e=>{e.isTrusted&&e.target.closest("#movie_player")&&l()}),{capture:!0})}))},options:{video_autopause_ignore_playlist:{_tagName:"input",label:"Ignore playlist","label:zh":"忽略播放列表","label:ja":"プレイリストを無視する","label:ko":"재생목록 무시","label:id":"Abaikan daftar putar","label:es":"Ignorar lista de reproducción","label:it":"Ignora playlist","label:pl":"Zignoruj listę odtwarzania",type:"checkbox","data-dependent":{video_autopause_embed:!1}},video_autopause_ignore_live:{_tagName:"input",label:"Ignore live",type:"checkbox","data-dependent":{video_autopause_embed:!1}},video_autopause_embed:{_tagName:"select",label:"Apply to video type",options:[{label:"all",value:!1,selected:!0},{label:"embed",value:"on"}]}}}),window.nova_plugins.push({id:"video-unblock-warn-content",title:"Skip inappropriate/offensive content warn",run_on_pages:"watch, embed, -mobile",section:"player",desc:"skip 'The following content may contain suicide or self-harm topics.'",_runtime:e=>{NOVA.waitSelector("ytd-watch-flexy[player-unavailable] #player-error-message-container #info button",{destroy_after_page_leaving:!0}).then((e=>e.click()))}}),window.nova_plugins.push({id:"player-disable-fullscreen-scroll",title:"Disable scrolling for fullscreen player","title:zh":"禁用全屏滚动","title:ja":"フルスクリーンスクロールを無効にする","title:pl":"Wyłącz przewijanie w trybie pełnoekranowym",run_on_pages:"watch, -mobile",section:"player",_runtime:e=>{function t(e){e.preventDefault()}NOVA.css.push(".ytp-chrome-controls button.ytp-fullerscreen-edu-button { display: none !important; }"),document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement?document.addEventListener("wheel",t,{passive:!1}):document.removeEventListener("wheel",t)}))}}),window.nova_plugins.push({id:"sponsor-block",title:"SponsorBlock",run_on_pages:"watch, embed",section:"player",_runtime:e=>{NOVA.waitSelector("#movie_player video").then((t=>{const a={sponsor:"Sponsor",selfpromo:"Self Promotion",interaction:"Reminder Subscribe",intro:"Intro",outro:"Credits (Outro)",preview:"Preview/Recap",music_offtopic:"Non-Music Section",exclusive_access:"Full Video Label Only"};let n,l,o=[];t.addEventListener("loadeddata",async function(){if(l=NOVA.queryURL.get("v")||movie_player.getVideoData().video_id,o=await async function(t=required()){const a="nova-videos-sponsor-block:";if(navigator.cookieEnabled&&(storage=sessionStorage.getItem(a+t)))return JSON.parse(storage);{const n=(Array.isArray(e.sponsor_block_action)?e.sponsor_block_action:[e.sponsor_block_action])||["skip","mute"],l=e.sponsor_block_category||["sponsor","interaction","selfpromo","intro","outro"],o={videoID:t,actionTypes:JSON.stringify(n),categories:JSON.stringify(l)},i=Object.keys(o).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(o[e]))).join("&"),r=()=>fetch((e.sponsor_block_url||"https://sponsor.ajay.app")+`/api/skipSegments?${i}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e.map((e=>[...e.segment,e.category])))).catch((e=>{}));if(result=await r())return navigator.cookieEnabled&&sessionStorage.setItem(a+t,JSON.stringify(result)),result}}(l)||[],e["player-float-progress-bar"]&&o.length){const e="#nova-player-float-progress-bar-chapters > span[time]",t=5;await NOVA.waitSelector(e,{destroy_after_page_leaving:!0}),document.body.querySelectorAll(e).forEach(((e,a,n)=>{if(a===n.length-1)return;const l=Math.trunc(NOVA.formatTimeOut.hmsToSec(e.getAttribute("time"))),i=Math.trunc(NOVA.formatTimeOut.hmsToSec(n[a+1].getAttribute("time")));for(const[a,n]of o.entries()){const[a,o,r]=n;if(Math.trunc(a)+t<=i&&Math.trunc(o)-t>=l){let t;switch(r){case"sponsor":t="255, 231, 0";break;case"interaction":t="255, 127, 80";break;case"selfpromo":t="255, 99, 71";break;case"intro":case"outro":t="255, 165, 0";break;default:t="0, 255, 107"}const n=document.createElement("span"),s=Math.max(a,l),c=i-l,d=e=>100*e/c+"%";n.title=r,Object.assign(n.style,{width:d(Math.min(o,i)-s),left:d(s-l),"background-color":`rgb(${t}, .4`}),e.append(n)}}}))}}.bind(t)),t.addEventListener("timeupdate",(function(){let t,i,r;for(let a=0;a<o.length;a++){[t,i,r]=o[a],t=Math.trunc(t),i=Math.ceil(i);const l=this.currentTime>t&&this.currentTime<i;switch(e.sponsor_block_action){case"mute":if(l&&!n&&!this.muted)return n=!0,movie_player.mute(!0),s("muted");if(!l&&n&&this.muted)return n=!1,movie_player.unMute(),o.splice(a,1),s("unMuted");break;case"skip":if(l)return this.currentTime=i,o.splice(a,1),s()}}function s(n=""){if(!e.sponsor_block_notification)return;const o=`${n} ${NOVA.formatTimeOut.HMS.digit(i-t)} [${a[r]}] • ${NOVA.formatTimeOut.HMS.digit(t)} - ${NOVA.formatTimeOut.HMS.digit(i)}`;console.info(l,o),NOVA.showOSD(o)}}))}))},options:{sponsor_block_category:{_tagName:"select",label:"Category",title:"[Ctrl+Click] to select several","title:zh":"[Ctrl+Click] 选择多个","title:ja":"「Ctrl+Click」して、いくつかを選択します","title:pl":"Ctrl+kliknięcie, aby zaznaczyć kilka",multiple:null,required:!0,size:7,options:[{label:"Ads/Sponsor",value:"sponsor"},{label:"Unpaid/Self Promotion",value:"selfpromo"},{label:"Reminder Subscribe",value:"interaction"},{label:"Intro",value:"intro"},{label:"Endcards/Credits (Outro)",value:"outro"},{label:"Preview/Recap",value:"preview"},{label:"Music: Non-Music Section",value:"music_offtopic"},{label:"Full Video Label Only",value:"exclusive_access"}]},sponsor_block_action:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"skip",value:"skip",selected:!0},{label:"mute",value:"mute"}]},sponsor_block_url:{_tagName:"input",label:"URL",type:"url",pattern:"https://.*",placeholder:"https://domain.com",value:"https://sponsor.ajay.app",required:!0},sponsor_block_notification:{_tagName:"input",label:"Show OSD notification",type:"checkbox"}}}),window.nova_plugins.push({id:"embed-popup",title:"Open small embedded in popup","title:zh":"将嵌入式视频重定向到弹出窗口","title:ja":"埋め込まれたビデオをポップアップにリダイレクトします","title:pl":"Przekieruj osadzone wideo do wyskakującego okienka",run_on_pages:"embed, -mobile",section:"player",desc:"if iframe width is less than 720p","plugins-conflict":"player-fullscreen-mode",_runtime:e=>{function t(){if(this.videoHeight<window.innerWidth&&this.videoHeight<window.innerHeight)return;const{width:e,height:t}=NOVA.aspectRatio.sizeToFit({srcWidth:this.videoWidth,srcHeight:this.videoHeight});movie_player.stopVideo();const a=new URL(document.head.querySelector('link[itemprop="embedUrl"][href]')?.href||location.origin+"/embed/"+movie_player.getVideoData().video_id);a.searchParams.set("autoplay",1),a.searchParams.set("popup",!0),NOVA.openPopup({url:a.href,width:e,height:t})}window.top===window.self||location.hostname.includes("googleapis.com")||NOVA.queryURL.has("popup")||"redirect_watch_to_embed"!=e.player_full_viewport_mode&&(e["player-fullscreen-mode"]||window.innerWidth>720&&window.innerHeight>480||NOVA.waitSelector("#movie_player video").then((e=>{e.addEventListener("playing",t.bind(e),{capture:!0,once:!0})})))}}),window.nova_plugins.push({id:"theater-mode",title:"Auto wide player (Theater mode)","title:pl":"Tryb kinowy",run_on_pages:"watch, -mobile",section:"player",_runtime:e=>{if("redirect_watch_to_embed"==e.player_full_viewport_mode)return location.assign("https://www.youtube.com/embed/"+NOVA.queryURL.get("v"));e.theater_mode_ignore_playlist&&location.search.includes("list=")||(NOVA.waitSelector("ytd-watch-flexy:not([player-unavailable])").then((t=>{function a(){return t.hasAttribute("theater")||"function"==typeof t.isTheater_&&t.isTheater_()}a()||(NOVA.waitUntil((()=>!!a()||void("object"==typeof movie_player?movie_player:document).dispatchEvent(new KeyboardEvent("keydown",{keyCode:84,key:"t",code:"KeyT",which:84,bubbles:!0,cancelable:!1}))),500),e["video-unblock-warn-content"]||NOVA.waitSelector("ytd-watch-flexy[player-unavailable] yt-player-error-message-renderer #button.yt-player-error-message-renderer button",{destroy_after_page_leaving:!0}).then((e=>e.click())))})),""!=e.player_full_viewport_mode&&(e["player-fullscreen-mode"]&&!e.player_fullscreen_mode_embed&&"cinema_mode"!=e.player_full_viewport_mode||NOVA.waitSelector("#movie_player").then((t=>{const a="ytd-watch-flexy[theater]:not([fullscreen]) #ytd-player",n="nova-lock-scroll",l=`${a} #movie_player:not(.nova-player-pin):not(.${n})`,o=Math.max(getComputedStyle(t)["z-index"],2020);switch((activateScrollElement=document.body.querySelector(".ytp-chrome-controls"))&&(activateScrollElement.addEventListener("wheel",(e=>{-1===Math.sign(e.wheelDelta)&&t.classList.add(n)})),document.addEventListener("scroll",(e=>{0===window.scrollY&&t.classList.contains(n)&&t.classList.remove(n)}))),e.player_full_viewport_mode){case"offset":NOVA.css.push(a+` {\nmin-height: calc(100vh - ${e["header-compact"]?"36px":NOVA.css.get("#masthead-container","height")||"56px"}) !important;\n}\nytd-watch-flexy[theater]:not([fullscreen]) #columns {\nposition: absolute;\ntop: 100vh;\n}\n${l} {\nbackground-color: black;\n}`);break;case"force":i(e.player_full_viewport_mode_exit);break;case"smart":if(e.player_full_viewport_mode_exclude_shorts&&"shorts"==NOVA.currentPage)return;NOVA.waitSelector("video").then((t=>{t.addEventListener("loadeddata",(function(){if(e.player_full_viewport_mode_exclude_shorts&&this.videoWidth<this.videoHeight)return;NOVA.aspectRatio.sizeToFit({srcWidth:this.videoWidth,srcHeight:this.videoHeight,maxWidth:window.innerWidth,maxHeight:window.innerHeight}).width<window.innerWidth&&i("player_full_viewport_mode_exit")}))}));break;case"cinema_mode":NOVA.css.push(l+` {\nz-index: ${o};\n}\n${l}:before {\ncontent: '';\nposition: fixed;\ntop: 0;\nleft: 0;\nwidth: 100%;\nheight: 100%;\nbackground-color: rgba(0, 0, 0, ${+e.cinema_mode_opacity});\nopacity: 0;\ntransition: opacity 400ms ease-in-out;\npointer-events: none;\n}\n${l}.playing-mode:before {\nopacity: 1;\n}\n.ytp-ad-player-overlay,\n#playlist:hover,\n#masthead-container:hover,\niframe, \n#guide,\n[class*="popup"],\n[role="navigation"],\n[role="dialog"] {\nz-index: ${o+1};\n}\n#playlist:hover {\nposition: relative;\n}`),r()}function i(a){const n="nova-player-fullviewport";NOVA.css.push(`${l}.playing-mode,\n${a?"":`${l}.paused-mode,`}\n${l}.${n} {\nwidth: 100vw;\nheight: 100vh;\nposition: fixed;\nbottom: 0 !important;\nz-index: ${o};\nbackground-color: black;\n}`),CSS.supports("selector(:has(*))")&&NOVA.css.push(`#masthead-container:has( ~ #page-manager ytd-watch-flexy[theater]) {\nposition: fixed;\nz-index: ${o+1};\nopacity: 0;\n}\n#masthead-container:has( ~ #page-manager ytd-watch-flexy[theater]):hover,\n#masthead-container:has( ~ #page-manager ytd-watch-flexy[theater]):focus {\nopacity: 1;\n}`),r(),e.player_full_viewport_mode_exit&&(NOVA.waitSelector("video").then((e=>{e.addEventListener("pause",(()=>{document.body.querySelector(".ytp-progress-bar")?.contains(document.activeElement)||window.dispatchEvent(new Event("resize"))})),e.addEventListener("play",(()=>window.dispatchEvent(new Event("resize"))))})),NOVA.waitSelector(".ytp-progress-bar").then((e=>{["mousedown","mouseup"].forEach((a=>{e.addEventListener(a,(()=>{t.classList.add(n)}))}))})))}function r(){e["scrollbar-hide"]||NOVA.css.push(`html body:has(${l})::-webkit-scrollbar{ display: none; }`)}}))))},options:{player_full_viewport_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"default",selected:!0},{label:"cinema",value:"cinema_mode"},{label:"full-viewport",value:"force"},{label:"full-viewport (auto)",value:"smart"},{label:"full-viewport (offset)",value:"offset"},{label:"redirect to embedded",value:"redirect_watch_to_embed"}]},player_full_viewport_mode_exit:{_tagName:"input",label:"Exit Fullscreen on video end/pause","label:zh":"视频结束/暂停时退出","label:ja":"ビデオが終了/一時停止したら終了します","label:pl":"Wyjdź, gdy film się kończy/pauzuje",type:"checkbox","data-dependent":{player_full_viewport_mode:["force","smart"]}},player_full_viewport_mode_exclude_shorts:{_tagName:"input",label:"Full-viewport exclude shorts","label:zh":"全视口不包括短裤","label:ja":"フルビューポートはショートパンツを除外します","label:pl":"Pełny ekran wyklucza krótkie filmy",type:"checkbox","data-dependent":{player_full_viewport_mode:"smart"}},cinema_mode_opacity:{_tagName:"input",label:"Opacity","label:zh":"不透明度","label:ja":"不透明度","label:pl":"Przezroczystość",type:"number",title:"0-1",placeholder:"0-1",step:.05,min:0,max:1,value:.75,"data-dependent":{player_full_viewport_mode:"cinema_mode"}},theater_mode_ignore_playlist:{_tagName:"input",label:"Ignore playlist","label:zh":"忽略播放列表","label:ja":"プレイリストを無視する","label:pl":"Zignoruj listę odtwarzania",type:"checkbox"}}}),window.nova_plugins.push({id:"player-indicator",title:"Custom On-Screen Display (OSD)","title:zh":"替换默认指示器","title:ja":"デフォルトのインジケーターを置き換える",run_on_pages:"watch, embed, -mobile",section:"player",_runtime:e=>{const t="nova-player-indicator-info",a=e.player_indicator_color||"#ff0000";NOVA.waitSelector("#movie_player video").then((t=>{t.addEventListener("volumechange",(function(){n.show({pt:Math.round(movie_player.getVolume()),suffix:"%",clear_previous_text:!0})})),t.addEventListener("ratechange",(()=>n.show({pt:t.playbackRate,suffix:"x",clear_previous_text:!0}))),e.player_indicator_chapter&&NOVA.waitSelector("ytd-watch-metadata #description.ytd-watch-metadata").then((()=>{const e=()=>a?.findIndex((e=>e.sec>t.currentTime));let a,n=0;t.addEventListener("loadeddata",(()=>a=[])),t.addEventListener("timeupdate",(function(){if(null===a||a?.length||(a=NOVA.getChapterList(movie_player.getDuration())||null),a?.length&&this.currentTime>n){let t=e();if(-1===t&&(t=a.length),n=a[t]?.sec,chapterData=a[t-1]){const e=" • ",t=chapterData.title+e+chapterData.time;NOVA.showOSD(t)}}})),t.addEventListener("seeking",(()=>{a?.length&&(nexChapterData=a[e()])&&(n=nexChapterData.sec)}))}))})),NOVA.waitSelector(".ytp-bezel-text").then((t=>{new MutationObserver((a=>{if(t.textContent){let a;if(t.textContent?.endsWith("%")&&!(a=e.volume_unlimit&&parseInt(t.textContent)>100)||(e["video-rate"]||e.player_buttons_custom_items?.includes("range-speed"))&&t.textContent?.length<6&&t.textContent?.endsWith("x")||e["time-jump"]&&t.textContent?.startsWith(`+${e.time_jump_step}`))return;n.show({pt:t.textContent,timeout_ms:1e3*(e.player_indicator_chapter_time||1.8),clear_previous_text:a})}})).observe(t,{attributes:!0,childList:!0})}));const n={create(){NOVA.css.push(".ytp-bezel-text-wrapper,\n.ytp-doubletap-ui-legacy.ytp-time-seeking,\n.ytp-chapter-seek {\ndisplay:none !important;\n}"),NOVA.css.push(`#${t} {\n--color: white;\n--bg-color: rgba(0, 0, 0, ${e.player_indicator_opacity||.3});\n--zindex: ${1+Math.max(NOVA.css.get(".ytp-chrome-top","z-index"),60)};\nposition: absolute;\nright: 0;\nz-index: calc(var(--zindex) + 1);\nmargin: 0 auto;\ntext-align: center;\nopacity: 0;\nbackground-color: var(--bg-color);\ncolor: var(--color);\n}\n#${t} span {\ntext-overflow: ellipsis;\nword-wrap: break-word;\noverflow: hidden;\ndisplay: -webkit-box;\n-webkit-line-clamp: 5; \nline-clamp: 5;\n-webkit-box-orient: vertical;\n}`);const n=document.createElement("div");switch(n.id=t,n.innerHTML="<span></span>",movie_player.append(n),this.container=document.getElementById(t),this.spanOSD=this.container.querySelector("span"),e.player_indicator_type){case"bar-center":Object.assign(this.container.style,{left:0,bottom:"20%",width:"30%","font-size":"1.2em"}),Object.assign(this.spanOSD.style,{"background-color":a,transition:"width 100ms ease-out",display:"inline-block"});break;case"bar-vertical":Object.assign(this.container.style,{top:0,height:"100%",width:"25px","font-size":"1.2em"}),Object.assign(this.spanOSD.style,{position:"absolute",bottom:0,right:0,"background-color":a,transition:"height 100ms ease-out 0s",display:"inline-block",width:"100%","font-weight":"bold"});break;default:Object.assign(this.container.style,{top:0,width:"100%",padding:".2em","font-size":"1.55em"})}return this.container},show({pt:t=100,suffix:n="",timeout_ms:l=800,clear_previous_text:o}){"number"==typeof this.fade&&clearTimeout(this.fade);const i=this.container||this.create();if(this.oldMsg?this.spanOSD.innerText+="\n"+t+n:this.spanOSD.innerHTML=t+n,o||(this.oldMsg=this.spanOSD.innerText,clearTimeout(this.timeoutMultiLine),this.timeoutMultiLine=setTimeout((()=>this.oldMsg=null),600)),"x"==n){t=100*+t/(+e.rate_step%.25==0?2:3)}switch(t=Math.round(t),e.player_indicator_type){case"bar-center":this.spanOSD.style.width=t+"%";break;case"bar-vertical":this.spanOSD.style.height=t+"%";break;case"bar-top":i.style.background=`linear-gradient(to right, ${a}50 ${t}%, rgba(0,0,0,.8) ${t}%)`,this.spanOSD.style.width=t+"%"}i.style.transition="none",i.style.opacity=1,i.style.visibility="visible",this.fade=setTimeout((()=>{i.style.transition="opacity 200ms ease-in",i.style.opacity=0,setTimeout((()=>i.style.visibility="hidden"),1e3)}),l)}}},options:{player_indicator_type:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"text-top",value:"text-top",selected:!0},{label:"bar-top",value:"bar-top"},{label:"bar-center",value:"bar-center"},{label:"bar-vertical",value:"bar-vertical"}]},player_indicator_opacity:{_tagName:"input",label:"Opacity","label:zh":"不透明度","label:ja":"不透明度","label:tr":"opaklık","label:pl":"Przezroczystość",type:"number",title:"less value - more transparency",placeholder:"0-1",step:.1,min:.1,max:.9,value:.3},player_indicator_color:{_tagName:"input",type:"color",value:"#ff0000",label:"Color","label:zh":"颜色","label:ja":"色","label:pl":"Kolor","data-dependent":{player_indicator_type:"!text-top"}},player_indicator_chapter:{_tagName:"input",label:"Show info at start chapter","label:zh":"在开始章节显示信息","label:ja":"章の開始時に情報を表示","label:pl":"Pokaż informacje na początku rozdziału",type:"checkbox"},player_indicator_chapter_time:{_tagName:"input",label:"Chapter timeout",type:"number","label:zh":"章节超时","label:ja":"チャプターのタイムアウト",title:"in sec",placeholder:"0-10",step:.1,min:.1,max:10,value:1.8,"data-dependent":{player_indicator_chapter:!0}}}}),window.nova_plugins.push({id:"disable-player-sleep-mode",title:'Disable the "Continue watching?" popup',"title:zh":"玩家永远保持活跃","title:ja":"プレーヤーは永遠にアクティブなままです","title:pl":"Wyłącz tryb uśpienia odtwarzacza",run_on_pages:"watch, -mobile",section:"player",_runtime:e=>{setInterval((()=>{document.hasFocus()||document.dispatchEvent(new KeyboardEvent("keyup",{keyCode:143,which:143,bubbles:!0,cancelable:!0}))}),3e5)}}),window.nova_plugins.push({id:"player-resize-ratio",title:"Player force resize 16:9",run_on_pages:"watch",section:"player",desc:"only for 4:3 video",_runtime:e=>{NOVA.waitSelector("ytd-watch-flexy:not([theater])").then((e=>{NOVA.waitSelector("#movie_player video",{container:e}).then((t=>{console.assert(e.calculateCurrentPlayerSize_,'"ytd_watch" does not have fn "calculateCurrentPlayerSize_"');const a=.5625,n=()=>{const e=NOVA.aspectRatio.getAspectRatio({width:t.videoWidth,height:t.videoHeight});return t.videoWidth/t.videoHeight>2.3||"4:3"==e||"1:1"==e};if(e.calculateCurrentPlayerSize_&&e.updateStyles){const r=e.calculateCurrentPlayerSize_;function l(){let t=height=NaN;return e.theater||(t=movie_player.offsetWidth,height=Math.ceil(movie_player.offsetWidth/(16/9)),e.updateStyles&&(e.updateStyles({"--ytd-watch-flexy-width-ratio":1,"--ytd-watch-flexy-height-ratio":a}),window.dispatchEvent(new Event("resize")))),{width:t,height:height}}function o(){e.calculateCurrentPlayerSize_=n()?l:r,e.calculateCurrentPlayerSize_()}o(),t.addEventListener("loadeddata",(()=>{"watch"==NOVA.currentPage&&o()}))}else new MutationObserver((t=>{e.theater||a==e.style.getPropertyValue("--ytd-watch-flexy-height-ratio")||i()})).observe(e,{attributes:!0,attributeFilter:["style"]});function i(){n()&&(e.style.setProperty("--ytd-watch-flexy-width-ratio",1),e.style.setProperty("--ytd-watch-flexy-height-ratio",a))}window.addEventListener("resize",i)}))}))}}),window.nova_plugins.push({id:"auto-buffer",title:"Video preloading/buffering",run_on_pages:"watch, embed",section:"player",desc:"Working while video is paused",_runtime:e=>{const t=+e.auto_buffer_sec||60,a="buffered";NOVA.css.push(`.${a} .ytp-swatch-background-color {\nbackground-color: ${e.auto_buffer_color||"#ffa000"} !important;\n}`);let n=!0,l=!1;NOVA.waitSelector("#movie_player video").then((e=>{let o;function i(){movie_player.classList.add(a),l=e.currentTime}function r(){if(!this.paused||!this.buffered?.length)return;if(n)return;const e=this.buffered.end(this.buffered.length-1);if(!1===l&&(movie_player.classList.add(a),l=this.currentTime),l&&e-l>t)return this.currentTime=l,void movie_player.classList.remove(a);if(!o||!isNaN(this.duration)){if(e/this.duration>.9)return void movie_player.classList.remove(a)}this.currentTime=e}e.addEventListener("loadeddata",(()=>{l=!1,o=movie_player.getVideoData().isLive})),e.addEventListener("playing",(function(){this.paused||!1===l||(this.currentTime=l,l=!1,movie_player.classList.remove(a))})),document.addEventListener("keydown",(t=>{e.paused&&l&&("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(t.target.localName)||t.target.isContentEditable||"ArrowLeft"!=t.code&&"ArrowRight"!=t.code||i())})),document.addEventListener("click",(t=>{t.isTrusted&&e.paused&&l&&t.target.closest(".ytp-progress-bar")&&i()})),e.addEventListener("pause",r.bind(e)),e.addEventListener("progress",r.bind(e))})),NOVA.waitSelector("#movie_player .ytp-left-controls .ytp-play-button").then((t=>{const o=document.createElement("button");o.className="ytp-button nova-right-custom-button",Object.assign(o.style,{padding:"0 12px",opacity:.5,"min-width":getComputedStyle(t).width||"48px"}),o.title="Preload video",o.innerHTML='<svg viewBox="0 0 465 465" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M279.591,423.714c-3.836,0.956-7.747,1.805-11.629,2.52c-10.148,1.887-16.857,11.647-14.98,21.804 c0.927,4.997,3.765,9.159,7.618,11.876c3.971,2.795,9.025,4.057,14.175,3.099c4.623-0.858,9.282-1.867,13.854-3.008 c10.021-2.494,16.126-12.646,13.626-22.662C299.761,427.318,289.618,421.218,279.591,423.714z"/>\n<path d="M417.887,173.047c1.31,3.948,3.811,7.171,6.97,9.398c4.684,3.299,10.813,4.409,16.662,2.475 c9.806-3.256,15.119-13.83,11.875-23.631c-1.478-4.468-3.118-8.95-4.865-13.314c-3.836-9.59-14.714-14.259-24.309-10.423 c-9.585,3.834-14.256,14.715-10.417,24.308C415.271,165.528,416.646,169.293,417.887,173.047z"/>\n<path d="M340.36,397.013c-3.299,2.178-6.704,4.286-10.134,6.261c-8.949,5.162-12.014,16.601-6.854,25.546 c1.401,2.433,3.267,4.422,5.416,5.942c5.769,4.059,13.604,4.667,20.127,0.909c4.078-2.352,8.133-4.854,12.062-7.452 c8.614-5.691,10.985-17.294,5.291-25.912C360.575,393.686,348.977,391.318,340.36,397.013z"/>\n<path d="M465.022,225.279c-0.407-10.322-9.101-18.356-19.426-17.953c-10.312,0.407-18.352,9.104-17.947,19.422 c0.155,3.945,0.195,7.949,0.104,11.89c-0.145,6.473,3.021,12.243,7.941,15.711c2.931,2.064,6.488,3.313,10.345,3.401 c10.322,0.229,18.876-7.958,19.105-18.285C465.247,234.756,465.208,229.985,465.022,225.279z"/>\n<path d="M414.835,347.816c-8.277-6.21-19.987-4.524-26.186,3.738c-2.374,3.164-4.874,6.289-7.434,9.298 c-6.69,7.86-5.745,19.666,2.115,26.361c0.448,0.38,0.901,0.729,1.371,1.057c7.814,5.509,18.674,4.243,24.992-3.171 c3.057-3.59,6.037-7.323,8.874-11.102C424.767,365.735,423.089,354.017,414.835,347.816z"/>\n<path d="M442.325,280.213c-9.855-3.09-20.35,2.396-23.438,12.251c-1.182,3.765-2.492,7.548-3.906,11.253 c-3.105,8.156-0.13,17.13,6.69,21.939c1.251,0.879,2.629,1.624,4.126,2.19c9.649,3.682,20.454-1.159,24.132-10.812 c1.679-4.405,3.237-8.906,4.646-13.382C457.66,293.795,452.178,283.303,442.325,280.213z"/>\n<path d="M197.999,426.402c-16.72-3.002-32.759-8.114-47.968-15.244c-0.18-0.094-0.341-0.201-0.53-0.287 c-3.584-1.687-7.162-3.494-10.63-5.382c-0.012-0.014-0.034-0.023-0.053-0.031c-6.363-3.504-12.573-7.381-18.606-11.628 C32.24,331.86,11.088,209.872,73.062,121.901c13.476-19.122,29.784-35.075,47.965-47.719c0.224-0.156,0.448-0.311,0.67-0.468 c64.067-44.144,151.06-47.119,219.089-1.757l-14.611,21.111c-4.062,5.876-1.563,10.158,5.548,9.518l63.467-5.682 c7.12-0.64,11.378-6.799,9.463-13.675L387.61,21.823c-1.908-6.884-6.793-7.708-10.859-1.833l-14.645,21.161 C312.182,7.638,252.303-5.141,192.87,5.165c-5.986,1.036-11.888,2.304-17.709,3.78c-0.045,0.008-0.081,0.013-0.117,0.021 c-0.225,0.055-0.453,0.128-0.672,0.189C123.122,22.316,78.407,52.207,46.5,94.855c-0.269,0.319-0.546,0.631-0.8,0.978 c-1.061,1.429-2.114,2.891-3.145,4.353c-1.686,2.396-3.348,4.852-4.938,7.308c-0.199,0.296-0.351,0.597-0.525,0.896 C10.762,149.191-1.938,196.361,0.24,244.383c0.005,0.158-0.004,0.317,0,0.479c0.211,4.691,0.583,9.447,1.088,14.129 c0.027,0.302,0.094,0.588,0.145,0.89c0.522,4.708,1.177,9.427,1.998,14.145c8.344,48.138,31.052,91.455,65.079,125.16 c0.079,0.079,0.161,0.165,0.241,0.247c0.028,0.031,0.059,0.047,0.086,0.076c9.142,9.017,19.086,17.357,29.793,24.898 c28.02,19.744,59.221,32.795,92.729,38.808c10.167,1.827,19.879-4.941,21.703-15.103 C214.925,437.943,208.163,428.223,197.999,426.402z"/>\n<path d="M221.124,83.198c-8.363,0-15.137,6.78-15.137,15.131v150.747l137.87,71.271c2.219,1.149,4.595,1.69,6.933,1.69 c5.476,0,10.765-2.982,13.454-8.185c3.835-7.426,0.933-16.549-6.493-20.384l-121.507-62.818V98.329 C236.243,89.978,229.477,83.198,221.124,83.198z"/>\n</g>\n</svg>',o.addEventListener("click",(function(){n=!n,o.style.opacity=n?.5:1,NOVA.showOSD("Preload is "+Boolean(n)),n&&(NOVA.videoElement.currentTime=l,movie_player.classList.remove(a))})),t.after(o),NOVA.waitSelector("#movie_player video").then((t=>{t.addEventListener("loadeddata",(({target:t})=>{n=movie_player.classList.contains("ad-showing")||!Boolean(e.auto_buffer_default),o.style.opacity=n?.5:1}))}))}))},options:{auto_buffer_sec:{_tagName:"input",label:"Sec",type:"number",title:"buffer time",placeholder:"10-300",step:5,min:30,max:300,value:60},auto_buffer_default:{_tagName:"select",label:"Default state","label:zh":"默认状态","label:ja":"デフォルト状態","label:pl":"Stan domyślny",options:[{label:"on",value:!0,selected:!0},{label:"off",value:!1}]},auto_buffer_color:{_tagName:"input",type:"color",value:"#ffa000",label:"Color","label:zh":"颜色","label:ja":"色","label:pl":"Kolor"}}}),window.nova_plugins.push({id:"video-zoom",title:"Zoom video","title:zh":"缩放视频","title:ja":"ズームビデオ",run_on_pages:"watch, embed, -mobile",section:"player",desc:"Remove horizontal black bars",_runtime:e=>{const t="nova-zoom";NOVA.waitSelector(".html5-video-container").then((a=>{let n=100;function l(e=100){100===(e=Math.max(100,Math.min(250,Math.trunc(e))))&&a.classList.contains(t)?(a.classList.remove(t),a.style.removeProperty("transform")):100===e||a.classList.contains(t)||a.classList.add(t),NOVA.showOSD(`Zoom: ${e}%`),e!==n&&(n=e,a.style.setProperty("transform",`scale(${e/100})`))}function o(){return Math.trunc(movie_player.clientWidth/NOVA.videoElement.videoHeight*100)}"keyboard"==e.zoom_hotkey?document.addEventListener("keydown",(t=>{if("watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage)return;if(["input","textarea","select"].includes(t.target.localName)||t.target.isContentEditable)return;if(t.ctrlKey||t.altKey||t.shiftKey||t.metaKey)return;let a;switch(1===e.zoom_hotkey_custom_in.length?t.key:t.code){case e.zoom_hotkey_custom_in:a=1;break;case e.zoom_hotkey_custom_out:a=-1}a&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),(step=+e.zoom_step*Math.sign(a))&&l(n+step))}),{capture:!0}):e.zoom_hotkey&&a.addEventListener("wheel",(t=>{t.preventDefault(),t.stopPropagation(),!t[e.zoom_hotkey]&&("none"!=e.zoom_hotkey||t.ctrlKey||t.altKey||t.shiftKey||t.metaKey)||(step=+e.zoom_step*Math.sign(t.wheelDelta))&&l(n+step)}),{capture:!0}),(hotkey=e.zoom_auto_max_width_hotkey_toggle)&&document.addEventListener("keyup",(e=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||["input","textarea","select"].includes(e.target.localName)||e.target.isContentEditable||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(1===hotkey.length?e.key:e.code)===hotkey&&(maxZoomPercent=o())&&l(n===maxZoomPercent?100:maxZoomPercent)})),e["save-channel-state"]&&NOVA.runOnPageLoad((async()=>{"watch"!=NOVA.currentPage&&"embed"!=NOVA.currentPage||!(userZoom=await NOVA.storage_obj_manager.getParam("zoom"))||l(100*userZoom)})),e.zoom_auto_max_width&&NOVA.waitSelector("video").then((e=>{e.addEventListener("loadeddata",(()=>{!(()=>{const t=NOVA.aspectRatio.getAspectRatio({width:e.videoWidth,height:e.videoHeight});return"4:3"==t||"1:1"==t})()&&(maxZoomPercent=o())&&100!==Math.trunc(maxZoomPercent)&&Math.trunc(maxZoomPercent)<175&&l(maxZoomPercent)}))})),NOVA.css.push(`.${t} {\ntransition: transform 100ms linear;\ntransform-origin: center;\n}\n.${t} video {\nposition: relative !important;\n}`)}))},options:{zoom_hotkey:{_tagName:"select",label:"Hotkey","label:zh":"热键","label:ja":"ホットキー","label:pl":"Klawisz skrótu",options:[{label:"none"},{label:"wheel",value:"none"},{label:"shift+wheel",value:"shiftKey"},{label:"ctrl+wheel",value:"ctrlKey"},{label:"alt+wheel",value:"altKey"},{label:"keyboard",value:"keyboard",selected:!0}]},zoom_hotkey_custom_in:{_tagName:"select",label:"Hotkey zoom in",options:[{label:"+",value:"+",selected:!0},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","-",",",".","/","<",";","\\"],"data-dependent":{zoom_hotkey:["keyboard"]}},zoom_hotkey_custom_out:{_tagName:"select",label:"Hotkey zoom out",options:[{label:"-",value:"-",selected:!0},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ"},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+",",",".","/","<",";","\\"],"data-dependent":{zoom_hotkey:["keyboard"]}},zoom_step:{_tagName:"input",label:"Hotkey step","label:zh":"步","label:ja":"ステップ","label:pl":"Krok",type:"number",title:"in %",placeholder:"%",step:5,min:5,max:50,value:10},zoom_auto_max_width:{_tagName:"input",label:"Auto fit to width",type:"checkbox"},zoom_auto_max_width_hotkey_toggle:{_tagName:"select",label:"Hotkey toggle fit to width",title:"exception square video",options:[{label:"none",value:!1},{label:"ShiftL",value:"ShiftLeft"},{label:"ShiftR",value:"ShiftRight"},{label:"CtrlL",value:"ControlLeft"},{label:"CtrlR",value:"ControlRight"},{label:"AltL",value:"AltLeft"},{label:"AltR",value:"AltRight"},{label:"A",value:"KeyA"},{label:"B",value:"KeyB"},{label:"C",value:"KeyC"},{label:"D",value:"KeyD"},{label:"E",value:"KeyE"},{label:"F",value:"KeyF"},{label:"G",value:"KeyG"},{label:"H",value:"KeyH"},{label:"I",value:"KeyI"},{label:"J",value:"KeyJ"},{label:"K",value:"KeyK"},{label:"L",value:"KeyL"},{label:"M",value:"KeyM"},{label:"N",value:"KeyN"},{label:"O",value:"KeyO"},{label:"P",value:"KeyP"},{label:"Q",value:"KeyQ",selected:!0},{label:"R",value:"KeyR"},{label:"S",value:"KeyS"},{label:"T",value:"KeyT"},{label:"U",value:"KeyU"},{label:"V",value:"KeyV"},{label:"W",value:"KeyW"},{label:"X",value:"KeyX"},{label:"Y",value:"KeyY"},{label:"Z",value:"KeyZ"},0,1,2,3,4,5,6,7,8,9,"]","[","+","-",",",".","/","<",";","\\"]}}}),window.nova_plugins.push({id:"playlist-collapse",title:"Collapse playlist","title:zh":"播放列表自动折叠","title:ja":"プレイリストの自動折りたたみ","title:pl":"Automatyczne zwijanie listy odtwarzania",run_on_pages:"watch, -mobile",section:"playlist",_runtime:e=>{location.search.includes("list=")&&NOVA.waitSelector("#secondary #playlist:not([collapsed]) #expand-button button").then((e=>{e.click()}))}}),window.nova_plugins.push({id:"playlist-duration",title:"Show playlist duration","title:zh":"显示播放列表持续时间","title:ja":"プレイリストの期間を表示","title:pl":"Pokaż czas trwania playlisty",run_on_pages:"watch, playlist, -mobile",restart_on_location_change:!0,section:"playlist",_runtime:e=>{const t="nova-playlist-duration";if(NOVA.queryURL.get("list"))switch(NOVA.currentPage){case"playlist":NOVA.waitSelector("#owner-text a").then((e=>{(duration=function(){const e=(document.body.querySelector("ytd-app")?.data?.response||window.ytInitialData).contents.twoColumnBrowseResultsRenderer?.tabs[0].tabRenderer?.content?.sectionListRenderer?.contents[0].itemSectionRenderer?.contents[0].playlistVideoListRenderer?.contents||document.body.querySelector("ytd-watch-flexy")?.__data.playlistData?.contents||document.body.querySelector("ytd-watch-flexy")?.data?.playlist?.playlist?.contents,t=e?.reduce(((e,t)=>e+(+t.playlistVideoRenderer?.lengthSeconds||0)),0);if(t)return n(t)}())?l({container:e,text:duration}):a("#primary #thumbnail #overlays #text:not(:empty)")?.then((t=>l({container:e,text:t})))}));break;case"watch":NOVA.waitSelector("#secondary .index-message-wrapper",{destroy_after_page_leaving:!0}).then((t=>{const o=setInterval((()=>{const n=movie_player.getPlaylist()?.length,r=document.body.querySelector("yt-playlist-manager")?.currentPlaylistData_?.contents.filter((e=>e.playlistPanelVideoRenderer?.lengthText?.simpleText)).map((e=>NOVA.formatTimeOut.hmsToSec(e.playlistPanelVideoRenderer.lengthText.simpleText)));console.assert(r?.length===n,"playlist loading:",r?.length+"/"+n),n&&r?.length===n&&(clearInterval(o),(duration=i(r))?(l({container:t,text:duration}),NOVA.waitSelector("#movie_player video",{destroy_after_page_leaving:!0}).then((e=>{e.addEventListener("ratechange",(()=>{l({container:t,text:i(r)})}))}))):e.playlist_duration_progress_type||a("#playlist #playlist-items #unplayableText[hidden]")?.then((e=>l({container:t,text:e}))))}),2e3);function i(t){const a=movie_player.getPlaylistIndex();let l=[...t];switch(e.playlist_duration_progress_type){case"done":l.splice(a);break;case"left":l.splice(0,a)}const o=e=>e.reduce(((e,t)=>e+ +t),0);return n(o(l),!!e.playlist_duration_percentage&&o(t))}}))}function a(e=required()){return!container||container instanceof HTMLElement?new Promise((t=>{let a=!1;const l=setInterval((()=>{const o=document.body.querySelectorAll(e),i=movie_player.getPlaylist()?.length||document.body.querySelector("ytd-player")?.player_?.getPlaylist()?.length||o.length,r=function(e){const t=[...e].map((e=>NOVA.formatTimeOut.hmsToSec(e.textContent))).filter(Number);return t.length&&t.reduce(((e,t)=>e+ +t),0)}(o);console.assert(o.length===i,"playlist loading:",o.length+"/"+i),+r&&o.length&&(o.length===i||a)?(clearInterval(l),t(n(r))):a||setTimeout((()=>a=!0),3e3)}),500)})):console.error("container not HTMLElement:",container)}function n(t=0,a){let n=[NOVA.formatTimeOut.HMS.digit("watch"==NOVA.currentPage&&NOVA.videoElement?.playbackRate?t/NOVA.videoElement.playbackRate:t)];return a&&(n.push(`(${Math.trunc(100*t/a)+"%"})`),e.playlist_duration_progress_type&&n.push(e.playlist_duration_progress_type))," - "+n.join(" ")}function l({text:e="",container:a=required()}){if(!(a instanceof HTMLElement))return console.error("container not HTMLElement:",a);(a.querySelector(`#${t}`)||function(){const e=document.createElement("span");return e.id=t,a.appendChild(e)}()).textContent=" "+e}},options:{playlist_duration_progress_type:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",label:"Time display mode","title:zh":"时间显示方式","title:ja":"時間表示モード","title:pl":"Tryb wyświetlania czasu",options:[{label:"done",value:"done","label:zh":"结束","label:ja":"終わり","label:pl":"zakończone"},{label:"left",value:"left","label:zh":"剩下","label:ja":"残り","label:pl":"pozostało"},{label:"total",value:!1,selected:!0,"label:zh":"全部的","label:ja":"全て","label:pl":"w sumie"}]},playlist_duration_percentage:{_tagName:"input",label:"Add %","label:zh":"显示百分比","label:ja":"パーセンテージを表示","label:pl":"Pokaż procenty",type:"checkbox","data-dependent":{playlist_duration_progress_type:["done","left"]}}}}),window.nova_plugins.push({id:"playlist-extended",title:"Playlist extended section","title:zh":"播放列表扩展部分","title:ja":"プレイリスト拡張セクション",run_on_pages:"watch, -mobile",section:"playlist",_runtime:e=>{let t=90;if(e["move-to-sidebar"]&&"info"===e.move_to_sidebar_target)t=84;NOVA.css.push(`ytd-watch-flexy:not([theater]) #secondary #playlist {\n--ytd-watch-flexy-panel-max-height: ${t}vh !important;\n}`)}}),window.nova_plugins.push({id:"playlist-reverse",title:"Add playlist reverse order button","title:zh":"添加按钮反向播放列表顺序","title:ja":"ボタンの逆プレイリストの順序を追加","title:pl":"Dodaj przycisk odtwarzania w odwrotnej kolejności",run_on_pages:"watch, -mobile",section:"playlist",_runtime:e=>{const t="nova-playlist-reverse-btn",a="#"+t,n="nova-playlist-reverse-on";function l(){NOVA.waitSelector("ytd-watch-flexy.ytd-page-manager:not([hidden]) ytd-playlist-panel-renderer:not([collapsed]) #playlist-action-menu .top-level-buttons:not([hidden]), #secondary #playlist #playlist-action-menu #top-level-buttons-computed",{destroy_after_page_leaving:!0}).then((e=>function(e=required()){if(!(e instanceof HTMLElement))return console.error("container not HTMLElement:",e);document.getElementById(t)?.remove();const a=document.createElement("div"),l=()=>a.title="Reverse playlist order is "+(window.nova_playlistReversed?"ON":"OFF");window.nova_playlistReversed&&(a.className=n);a.id=t,l(),a.innerHTML='<yt-icon-button>\n<svg viewBox="0 0 381.399 381.399" height="100%" width="100%">\n<g>\n<path d="M233.757,134.901l-63.649-25.147v266.551c0,2.816-2.286,5.094-5.104,5.094h-51.013c-2.82,0-5.099-2.277-5.099-5.094 V109.754l-63.658,25.147c-2.138,0.834-4.564,0.15-5.946-1.669c-1.389-1.839-1.379-4.36,0.028-6.187L135.452,1.991 C136.417,0.736,137.91,0,139.502,0c1.576,0,3.075,0.741,4.041,1.991l96.137,125.061c0.71,0.919,1.061,2.017,1.061,3.109 c0,1.063-0.346,2.158-1.035,3.078C238.333,135.052,235.891,135.735,233.757,134.901z M197.689,378.887h145.456v-33.62H197.689 V378.887z M197.689,314.444h145.456v-33.622H197.689V314.444z M197.689,218.251v33.619h145.456v-33.619H197.689z"/>\n</g>\n</svg>\n</yt-icon-button>',a.addEventListener("click",(()=>{a.classList.toggle(n),window.nova_playlistReversed=!window.nova_playlistReversed,window.nova_playlistReversed?(o(),l(),document.getElementById("nova-playlist-duration").innerHTML="&nbsp; [out of reach] &nbsp;",(autoplayBtn=document.getElementById("nova-playlist-autoplay-btn"))&&(autoplayBtn.disabled=!0,autoplayBtn.title="out of reach")):location.reload()})),e.append(a)}(e)))}async function o(){if(window.nova_playlistReversed){if((ytdWatch=await NOVA.waitSelector("ytd-watch-flexy",{destroy_after_page_leaving:!0}))&&(data=await NOVA.waitUntil((()=>ytdWatch.data?.contents?.twoColumnWatchNextResults),100))&&(playlist=data.playlist?.playlist)&&(autoplay=data.autoplay?.autoplay)){playlist.contents.reverse(),playlist.currentIndex=playlist.totalVideos-playlist.currentIndex-1,playlist.localCurrentIndex=playlist.contents.length-playlist.localCurrentIndex-1;for(const e of autoplay.sets)e.autoplayVideo=e.previousButtonVideo,e.previousButtonVideo=e.nextButtonVideo,e.nextButtonVideo=e.autoplayVideo;ytdWatch.updatePageData_(data),(manager=document.body.querySelector("yt-playlist-manager"))&&(ytdPlayer=document.getElementById("ytd-player"))&&(ytdPlayer.updatePlayerComponents(null,autoplay,null,playlist),manager.autoplayData=autoplay,manager.setPlaylistData(playlist),ytdPlayer.updatePlayerPlaylist_(playlist))}!function(e=required()){if(!(e instanceof HTMLElement))return console.error("targetEl not HTMLElement:",e);const t=e.parentElement;t.scrollTop=e.offsetTop-t.offsetTop}(document.body.querySelector("#secondary #playlist-items[selected], ytm-playlist .item[selected=true]"))}}window.nova_playlistReversed,NOVA.css.push(a+` {\nbackground: none;\nborder: 0;\n}\nyt-icon-button {\nwidth: 40px;\nheight: 40px;\npadding: 10px;\n}\n${a} svg {\nfill: white;\nfill: var(--yt-spec-text-secondary);\n}\n${a}:hover svg { fill: #66afe9; }\n${a}:active svg,\n${a}.${n} svg { fill: #2196f3; }`),e.playlist_reverse_auto_enabled&&!window.nova_playlistReversed&&(window.nova_playlistReversed=!0),NOVA.runOnPageLoad((async()=>{location.search.includes("list=")&&"watch"==NOVA.currentPage&&(o(),document.addEventListener("yt-page-data-updated",l,{capture:!0,once:!0}))}))},options:{playlist_reverse_auto_enabled:{_tagName:"input",label:"Default enabled state","label:zh":"默认启用","label:ja":"デフォルトで有効になっています","label:pl":"Domyślnie włączone",type:"checkbox"}}}),window.nova_plugins.push({id:"playlist-toggle-autoplay",title:"Add playlist autoplay control button","title:zh":"播放列表自动播放控制","title:ja":"プレイリストの自動再生コントロール","title:pl":"Kontrola autoodtwarzania listy odtwarzania",run_on_pages:"watch, -mobile",section:"playlist",_runtime:e=>{const t="nova-playlist-autoplay-btn",a="#"+t;let n=e.playlist_autoplay;NOVA.css.push(`#playlist-action-menu .top-level-buttons {\nalign-items: center;\n}\n${a}[type=checkbox] {\n--height: 1em;\nwidth: 2.2em;\n}\n${a}[type=checkbox]:after {\ntransform: scale(1.5);\n}\n${a}[type=checkbox] {\n--opacity: .7;\n--color: white;\nheight: var(--height);\nline-height: 1.6em;\nborder-radius: 3em;\nbackground-color: var(--paper-toggle-button-unchecked-bar-color, black);\nappearance: none;\n-webkit-appearance: none;\nposition: relative;\ncursor: pointer;\noutline: 0;\nborder: none;\n}\n${a}[type=checkbox]:after {\nposition: absolute;\ntop: 0;\nleft: 0;\ncontent: '';\nwidth: var(--height);\nheight: var(--height);\nborder-radius: 50%;\nbackground-color: var(--color);\nbox-shadow: 0 0 .25em rgba(0, 0, 0, .3);\n}\n${a}[type=checkbox]:checked:after {\nleft: calc(100% - var(--height));\n--color: var(--paper-toggle-button-checked-button-color, var(--primary-color));\n}\n${a}[type=checkbox]:focus, input[type=checkbox]:focus:after {\ntransition: all 200ms ease-in-out;\n}\n${a}[type=checkbox]:disabled {\nopacity: .3;\n}`),NOVA.runOnPageLoad((()=>{location.search.includes("list=")&&"watch"==NOVA.currentPage&&function(){function e(e=required()){if(!(e instanceof HTMLElement))return console.error("container not HTMLElement:",e);document.getElementById(t)?.remove();const a=document.createElement("input");function l(){async function e(){const e=document.body.querySelector("ytd-watch-flexy");let t;await NOVA.waitUntil((()=>{if((t=e?.data?.contents?.twoColumnWatchNextResults?.playlist?.playlist?.contents||e?.data?.playlist?.playlist?.contents)&&t.length)return!0}),1e3);movie_player.getPlaylistIndex()===t.findIndex((e=>e.hasOwnProperty("messageRenderer")))-1&&(manager.canAutoAdvance_=!1,alert("Nova [playlist-toggle-autoplay]:\nPlaylist has hide video. Playlist autoplay disabled"),a.checked=!1)}(manager=document.body.querySelector("yt-playlist-manager"))?(manager.interceptedForAutoplay=!0,manager.canAutoAdvance_=a.checked,a.checked=manager?.canAutoAdvance_,a.title="Playlist Autoplay is "+(manager?.canAutoAdvance_?"ON":"OFF"),a.checked&&e()):console.error("Error playlist-autoplay. Playlist manager is",manager)}a.id=t,a.type="checkbox",a.title="Playlist toggle autoplay",a.addEventListener("change",(({target:e})=>{n=e.checked,l()})),e.append(a),a.checked=n,l()}NOVA.waitSelector("ytd-watch-flexy.ytd-page-manager:not([hidden]) ytd-playlist-panel-renderer:not([collapsed]) #playlist-action-menu .top-level-buttons:not([hidden]), #secondary #playlist #playlist-action-menu #top-level-buttons-computed",{destroy_after_page_leaving:!0}).then((t=>e(t)))}()}))},options:{playlist_autoplay:{_tagName:"select",label:"Default state","label:zh":"默认状态","label:ja":"デフォルト状態","label:pl":"Stan domyślny",options:[{label:"play",value:!0,selected:!0},{label:"stop",value:!1}]}}}),window.nova_plugins.push({id:"move-to-sidebar",title:"Move to sidebar","title:zh":"转移到侧边栏","title:ja":"サイドバーに転送","title:pl":"Przenieś na pasek boczny",run_on_pages:"watch, -mobile",section:"sidebar","plugins-conflict":"description-popup",_runtime:e=>{if("info"!=e.move_to_sidebar_target&&location.search.includes("list="))return;const t="ytd-watch-flexy:not([fullscreen])",a=`${t} #below`,n=`${t} #secondary`;switch(e.move_to_sidebar_target){case"info":o();break;case"description":if(e["description-popup"])return;NOVA.waitSelector(`${a} #description.ytd-watch-metadata`,{destroy_after_page_leaving:!0}).then((t=>{NOVA.waitSelector(`${n}-inner`,{destroy_after_page_leaving:!0}).then((async l=>{document.body.querySelector("#chat:not([collapsed])")||(l.prepend(t),o(),e["description-popup"]||e["video-date-format"]?document.body.querySelector(`${n} #info-container`)?.remove():document.body.querySelector(`${a} ytd-watch-metadata #title`)?.append(document.body.querySelector(`${n} #info-container`)),NOVA.css.push(n+` #owner {\nmargin: 0;\n}\n${n} #description.ytd-watch-metadata {\nheight: fit-content !important;\nmax-height: 80vh !important;\noverflow-y: auto;\n}\n${n} #description #collapse {\ndisplay: none;\n}\n#ytd-watch-info-text, #info-container a {\ndisplay: none;\n}`),document.body.querySelector(`${n} #description #expand`)?.click())}))})),l();break;case"comments":if("disable"==e.comments_visibility_mode||e["comments-popup"])return;NOVA.waitSelector(`${a} #comments`,{destroy_after_page_leaving:!0}).then((e=>{document.body.querySelector("#chat:not([collapsed])")||(document.body.querySelector(`${n}`)?.appendChild(e),e.style.cssText="height:100vh; overflow-y:auto;")})),l()}function l(){NOVA.waitSelector(`${n} #related`,{destroy_after_page_leaving:!0}).then((e=>{document.body.querySelector("#chat:not([collapsed])")||document.body.querySelector("#below")?.appendChild(e)}))}function o(){NOVA.waitSelector(`${n}-inner`,{destroy_after_page_leaving:!0}).then((e=>{NOVA.waitSelector(`${a} ytd-watch-metadata #owner`,{destroy_after_page_leaving:!0}).then((t=>{e.prepend(t)}))}))}},options:{move_to_sidebar_target:{_tagName:"select",label:"Target of movement","label:zh":"运动目标","label:ja":"移動の対象",options:[{label:"info",value:"info"},{label:"info + description",value:"description",selected:!0},{label:"comments",value:"comments"}]}}}),window.nova_plugins.push({id:"related-visibility",title:"Collapse related section","title:zh":"收起相关栏目","title:ja":"関連セクションを折りたたむ","title:pl":"Zwiń powiązaną sekcję",run_on_pages:"watch, -mobile",section:"sidebar",_runtime:e=>{NOVA.collapseElement({selector:"#secondary #related",label:"related",remove:"disable"==e.related_visibility_mode})},options:{related_visibility_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"collapse",value:"hide",selected:!0,"label:pl":"zwiń"},{label:"remove",value:"disable","label:zh":"消除","label:ja":"削除","label:pl":"usunąć"}]}}}),window.nova_plugins.push({id:"livechat-toggle-mode",title:'"Livechat" mode instead of "Top chat"',run_on_pages:"live_chat, -mobile",restart_on_location_change:!0,section:"sidebar",_runtime:e=>{NOVA.waitSelector('#chat-messages #menu a[aria-selected="false"]').then((async e=>{await e.click()}))}}),window.nova_plugins.push({id:"sidebar-thumbs-channel-link-patch",title:"Fix channel links in sidebar","title:zh":"修复侧边栏中的频道链接","title:ja":"サイドバーのチャネルリンクを修正","title:pl":"Napraw linki do kanałów na pasku bocznym",run_on_pages:"watch, -mobile",section:"sidebar",_runtime:e=>{function t(t){if(t.isTrusted&&"watch"==NOVA.currentPage&&t.target.closest("#channel-name")&&(link=t.target.closest("a"))&&(data=t.target.closest("ytd-compact-video-renderer, ytd-video-meta-block")?.data)&&(res=NOVA.seachInObjectBy.key({obj:data,keys:"navigationEndpoint",match_fn:e=>"WEB_PAGE_TYPE_CHANNEL"==e?.commandMetadata?.webCommandMetadata?.webPageType})?.data)){const a=link.data,n=link.href;link.data=res,link.href=link.data.commandMetadata.webCommandMetadata.url+=e["channel-default-tab"]&&e.channel_default_tab||"/videos",t.target.addEventListener("mouseout",(({target:e})=>{link.data=a,link.href=n}),{capture:!0,once:!0})}}document.addEventListener("click",(e=>t(e)),{capture:!0}),document.addEventListener("auxclick",(e=>1===e.button&&t(e)),{capture:!0})}}),window.nova_plugins.push({id:"livechat-visibility",title:"Collapse livechat","title:zh":"隐藏实时聊天","title:ja":"ライブチャットを非表示","title:pl":"Ukryj czat na żywo",run_on_pages:"watch, -mobile",restart_on_location_change:!0,section:"sidebar",_runtime:e=>{"disable"==e.livechat_visibility_mode?NOVA.waitSelector("#chat",{destroy_after_page_leaving:!0}).then((e=>{e.remove()})):NOVA.waitSelector("#chat:not([collapsed]) #show-hide-button button",{destroy_after_page_leaving:!0}).then((e=>{e.click()}))},options:{livechat_visibility_mode:{_tagName:"select",label:"Mode","label:zh":"模式","label:ja":"モード","label:pl":"Tryb",options:[{label:"collapse",value:"hide",selected:!0,"label:pl":"zwiń"},{label:"remove",value:"disable","label:zh":"消除","label:ja":"削除","label:pl":"usunąć"}]}}}),window.nova_plugins.push({id:"thumbs-hide",title:"Thumbnails filter","title:zh":"缩略图过滤","title:ja":"サムネイルのフィルタリング","title:pl":"Ukryj kilka miniatur",run_on_pages:"home, results, feed, channel, watch, -mobile",section:"thumbs",_runtime:e=>{const t="nova-thumbs-hide",a=["ytd-rich-item-renderer","ytd-video-renderer","ytd-playlist-renderer","ytd-compact-video-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"].map((e=>`${e}:not(.${t})`)).join(",");function n(){NOVA.waitSelector('#filter-button, ytd-shelf-renderer #title-container a[href="/feed/channels"]',{destroy_after_page_leaving:!0}).then((e=>{const t=document.createElement("button");t.className="style-scope yt-formatted-string bold yt-spec-button-shape-next--tonal yt-spec-button-shape-next--mono yt-spec-button-shape-next--size-m yt-spec-button-shape-next--text",t.innerHTML='<span class="yt-spec-button-shape-next__icon" style="height:100%">\n<svg viewBox="-50 -50 400 400" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M128.25,175.6c1.7,1.8,2.7,4.1,2.7,6.6v139.7l60-51.3v-88.4c0-2.5,1-4.8,2.7-6.6L295.15,65H26.75L128.25,175.6z" />\n</g>\n</svg>\n</span>',t.title="Toggle NOVA plugin [thumbs-hide]",Object.assign(t.style,{border:0,cursor:"pointer",scale:.7}),t.addEventListener("click",(()=>{document.body.classList.toggle("nova-thumbs-unhide")})),e.after(t)}))}if(document.addEventListener("yt-action",(e=>{switch(e.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-rich-grid-layout-refreshed":case"yt-store-grafted-ve-action":switch(NOVA.currentPage){case"home":case"watch":l.live(),l.mix(),l.watched();break;case"results":l.live(),l.shorts(),l.mix();break;case"feed":l.live(),l.streamed(),l.shorts(),l.durationLimits(),l.premieres(),l.mix(),l.watched()}}})),document.addEventListener("yt-navigate-finish",(()=>NOVA.queryURL.has("flow")&&n())),n(),NOVA.css.push(`body.nova-thumbs-unhide .${t} {\nborder: 2px dashed orange;\n}\nbody:not(.nova-thumbs-unhide) .${t} {\ndisplay: none\n}`),e.thumbs_hide_shorts){const e=["ytd-reel-shelf-renderer","ytd-rich-grid-row + ytd-rich-section-renderer","[is-shorts]"];CSS.supports("selector(:has(*))")&&e.push('ytd-guide-entry-renderer:has(path[d^="M10 14.65v-5.3L15"])'),NOVA.css.push(e.join(",\n")+"{ display: none !important; }")}const l={shorts(){e.thumbs_hide_shorts&&("channel"==NOVA.currentPage&&"shorts"==NOVA.channelTab||document.body.querySelectorAll('a#thumbnail[href*="shorts/"]').forEach((e=>{(thumb=e.closest(a))&&thumb.classList.add(t)})))},durationLimits(){if(!+e.thumbs_hide_min_duration)return;const n="#thumbnail #overlays #text:not(:empty)";NOVA.waitSelector(n).then((()=>{document.body.querySelectorAll(n).forEach((n=>{(thumb=n.closest(a))&&(timeSec=NOVA.formatTimeOut.hmsToSec(n.textContent.trim()))&&timeSec*(e.rate_default||1)<(+e.thumbs_hide_min_duration||60)&&thumb.classList.add(t)}))}))},premieres(){e.thumbs_hide_premieres&&(document.body.querySelectorAll('#thumbnail #overlays [aria-label="Premiere"],\n#thumbnail #overlays [aria-label="Upcoming"]').forEach((e=>{(thumb=e.closest(a))&&thumb.classList.add(t)})),document.body.querySelectorAll('[class*="badge"] [class*="live-now"]').forEach((e=>{(thumb=e.closest(a))&&thumb.classList.add(t)})))},live(){if(!e.thumbs_hide_live)return;if("channel"==NOVA.currentPage&&"streams"==NOVA.channelTab)return;const n=NOVA.strToArray(e.thumbs_hide_live_channels_exception?.toLowerCase());document.body.querySelectorAll('#thumbnail img[src*="_live.jpg"]').forEach((l=>{if(thumb=l.closest(a)){if(n?.includes(thumb.querySelector("#channel-name a")?.textContent.trim().toLowerCase()))return void(e["search-filter"]&&(thumb.style.display="block"));thumb.classList.add(t)}}))},streamed(){if(!e.thumbs_hide_streamed)return;if("channel"==NOVA.currentPage&&"streams"==NOVA.channelTab)return;const n=NOVA.strToArray(e.thumbs_hide_live_channels_exception?.toLowerCase());document.body.querySelectorAll("#metadata").forEach((l=>{if(4===l.querySelector("#metadata-line > span:last-of-type")?.textContent?.split(" ").length&&(thumb=l.closest(a))){if(n?.includes(thumb.querySelector("#channel-name a")?.textContent.trim().toLowerCase()))return void(e["search-filter"]&&(thumb.style.display="block"));thumb.classList.add(t)}}))},mix(){e.thumbs_hide_mix&&document.body.querySelectorAll('a[href*="list="][href*="start_radio="]:not([hidden]),\n#video-title[title^="Mix -"]:not([hidden])').forEach((e=>{(thumb=e.closest("ytd-radio-renderer, ytd-compact-radio-renderer,"+a))&&thumb.classList.add(t)}))},watched(){if(!e.thumbs_hide_watched)return;if(!e["thumbs-watched"])return;const n=+e.thumbs_hide_watched_percent_complete||90;document.body.querySelectorAll('#thumbnail #overlays #progress[style*="width"]').forEach((e=>{parseInt(e.style.width)>n&&(thumb=e.closest(a))&&thumb.classList.add(t)}))}};e.thumbs_hide_mix&&NOVA.css.push("ytd-radio-renderer {\ndisplay: none !important;\n}")},options:{thumbs_hide_shorts:{_tagName:"input",label:"Hide Shorts","label:zh":"隐藏短裤","label:ja":"ショーツを隠す","label:pl":"Ukryj YouTube Shorts",type:"checkbox"},thumbs_hide_min_duration:{_tagName:"input",label:"Min duration in sec (for regular video)","label:zh":"最短持续时间（以秒为单位）","label:ja":"秒単位の最小期間","label:pl":"Poniżej czasu trwania w sekundach",type:"number",title:"in sec / 0 - disable",placeholder:"60-3600",step:1,min:0,max:3600,value:0},thumbs_hide_premieres:{_tagName:"input",label:"Hide Premieres/Upcoming","label:zh":"隐藏首映/即将上映","label:ja":"プレミア公開/近日公開を非表示","label:pl":"Ukrywaj premiery",type:"checkbox",title:"Premiere Announcements"},thumbs_hide_live:{_tagName:"input",label:"Hide Live now streams","label:zh":"隐藏直播","label:ja":"ライブ ストリームを非表示にする","label:pl":"Ukryj strumień (na żywo)",type:"checkbox",title:"Now airing","title:zh":"正在播出","title:ja":"放映中","title:pl":"Teraz wietrzenie"},thumbs_hide_live_channels_exception:{_tagName:"textarea",label:"Live channels exception","label:zh":"异常通道列表","label:ja":"例外チャネルのリスト",title:'separator: "," or ";" or "new line"',"title:zh":'分隔器： "," 或 ";" 或 "新队"',"title:ja":'セパレータ： "," または ";" または "改行"',"title:pl":'separator: "," lub ";" lub "now linia"',placeholder:"channel1\nchannel2","data-dependent":{thumbs_hide_live:!0}},thumbs_hide_streamed:{_tagName:"input",label:"Hide finished streams","label:zh":"隐藏完成的流","label:ja":"終了したストリームを非表示にする","label:pl":"Ukryj po streamie",type:"checkbox","data-dependent":{thumbs_hide_live:!0}},thumbs_hide_mix:{_tagName:"input",label:"Hide 'Mix' thumbnails","label:zh":"隐藏[混合]缩略图","label:ja":"「Mix」サムネイルを非表示","label:pl":'Ukryj miniaturki "Mix"',type:"checkbox",title:"[Mix] offers to rewatch what has already saw","title:zh":"[混合]提供重新观看已经看过的内容","title:ja":"「Mix」は、すでに見たものを再視聴することを提案します","title:pl":"[Mix] proponuje ponowne obejrzenie już obejrzanych filmów"},thumbs_hide_watched:{_tagName:"input",label:"Hide watched","label:zh":"隐藏观看","label:ja":"監視対象を非表示","label:pl":"Ukryj oglądane",type:"checkbox",title:"Need to Turn on [YouTube History]"},thumbs_hide_watched_percent_complete:{_tagName:"input",label:"Threshold percent",type:"number",title:"in %",placeholder:"%",step:5,min:5,max:100,value:90,"data-dependent":{thumbs_hide_watched:!0}}}}),window.nova_plugins.push({id:"thumbs-clear",title:"Thumbnails preview image","title:zh":"清除缩略图","title:ja":"サムネイルをクリアする","title:pl":"Wyczyść miniatury",run_on_pages:"home, feed, channel, watch",section:"thumbs",desc:"Replaces the predefined clickbait thumbnails","desc:zh":"替换预定义的缩略图","desc:ja":"事前定義されたサムネイルを置き換えます","desc:pl":"Zastępuje predefiniowaną miniaturkę",_runtime:e=>{const t="nova-thumb-preview-cleared",a=["ytd-rich-item-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"];let n=!1;function l(t){if((re=/(\w{2}default|hq\d+)./i)&&re.test(t))return t.replace(re,(e.thumbs_clear_preview_timestamp||"hq2")+".")}NOVA.watchElements({selectors:['#thumbnail:not(.ytd-playlist-thumbnail):not([class*=markers]):not([href*="/shorts/"]) img[src]:not([src*="_live.jpg"])','a:not([href*="/shorts/"]) img.video-thumbnail-img[src]:not([src*="_live.jpg"])'],attr_mark:t,callback:async e=>{"results"!=NOVA.currentPage&&(window.yt?.config_?.DISABLE_YT_IMG_DELAY_LOADING&&n!==window.yt?.config_?.DISABLE_YT_IMG_DELAY_LOADING&&(n=window.yt?.config_?.DISABLE_YT_IMG_DELAY_LOADING,await NOVA.delay(100),document.body.querySelectorAll(`[${t}]`).forEach((e=>e.removeAttribute(t)))),(thumb=e.closest(a))&&thumb.querySelector('#badges [class*="live-now"],\n#overlays [aria-label="PREMIERE"],\n#overlays [overlay-style="UPCOMING"]')||(src=l(e.src))&&(e.src=l(src)))}}),e.thumbs_clear_overlay&&NOVA.css.push("#hover-overlays {\nvisibility: hidden !important;\n}")},options:{thumbs_clear_preview_timestamp:{_tagName:"select",label:"Timestamps moment","label:zh":"缩略图时间戳","label:ja":"サムネイルのタイムスタンプ","label:pl":"Znaczniki czasowe miniatur",title:"Show thumbnail from video time position","title:zh":"从视频时间位置显示缩略图","title:ja":"ビデオの時間位置からサムネイルを表示","title:pl":"Pokaż miniaturkę z pozycji czasu wideo",options:[{label:"start",value:"hq1","label:zh":"开始","label:ja":"始まり","label:pl":"początek"},{label:"middle",value:"hq2",selected:!0,"label:zh":"中间","label:ja":"真ん中","label:pl":"środek"},{label:"end",value:"hq3","label:zh":"结尾","label:ja":"終わり","label:pl":"koniec"}]},thumbs_clear_overlay:{_tagName:"input",label:"Hide overlay buttons on a thumbnail","label:zh":"隐藏覆盖在缩略图上的按钮","label:ja":"サムネイルにオーバーレイされたボタンを非表示にする","label:pl":"Ukryj przyciski nakładki na miniaturce",type:"checkbox",title:"Hide [ADD TO QUEUE] [WATCH LATER]"}}}),window.nova_plugins.push({id:"thumbs-title-normalize",title:"Decapitalize thumbnails title","title:zh":"从大写中删除缩略图标题","title:ja":"サムネイルのタイトルを大文字から外す","title:pl":"Zmniejsz czcionkę w tytule miniatur",run_on_pages:"home, feed, channel, watch",section:"thumbs",desc:"Upper Case thumbnails title back to normal","plugins-conflict":"thumbs-title-lang",_runtime:e=>{if(e["thumbs-title-lang"])return;const t=["#video-title",'a > [class*="media-item-headline"]'].map((e=>e+":not(:empty)")),a=+e.thumbs_title_normalize_smart_max_words||2,n="nova-thumb-title-normalized";e.thumbs_title_show_full&&NOVA.css.push(t.join(",")+"{\ndisplay: block !important;\nmax-height: unset !important;\n}");const l=new RegExp("([-0-9A-ZÀ-ÖØ-ÞĀĂĄĆĈĊČĎĐĒĔĖĘĚĜĞĠĢĤĦĨĪĬĮİĲĴĶĹĻĽĿŁŃŅŇŊŌŎŐŒŔŖŘŚŜŞŠŢŤŦŨŪŬŮŰŲŴŶŸ-ŹŻŽƁ-ƂƄƆ-ƇƉ-ƋƎ-ƑƓ-ƔƖ-ƘƜ-ƝƟ-ƠƢƤƦ-ƧƩƬƮ-ƯƱ-ƳƵƷ-ƸƼǄǇǊǍǏǑǓǕǗǙǛǞǠǢǤǦǨǪǬǮǱǴǶ-ǸǺǼǾȀȂȄȆȈȊȌȎȐȒȔȖȘȚȜȞȠȢȤȦȨȪȬȮȰȲȺ-ȻȽ-ȾɁɃ-ɆɈɊɌɎͰͲͶΆΈ-ΊΌΎ-ΏΑ-ΡΣ-ΫϏϒ-ϔϘϚϜϞϠϢϤϦϨϪϬϮϴϷϹ-ϺϽ-ЯѠѢѤѦѨѪѬѮѰѲѴѶѸѺѼѾҀҊҌҎҐҒҔҖҘҚҜҞҠҢҤҦҨҪҬҮҰҲҴҶҸҺҼҾӀ-ӁӃӅӇӉӋӍӐӒӔӖӘӚӜӞӠӢӤӦӨӪӬӮӰӲӴӶӸӺӼӾԀԂԄԆԈԊԌԎԐԒԔԖԘԚԜԞԠԢԱ-Ֆ֊־٠-٩۰-۹߀-߉०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩၀-၉႐-႙Ⴀ-Ⴥ០-៩᠆᠐-᠙᥆-᥏᧐-᧙᭐-᭙᮰-᮹᱀-᱉᱐-᱙ḀḂḄḆḈḊḌḎḐḒḔḖḘḚḜḞḠḢḤḦḨḪḬḮḰḲḴḶḸḺḼḾṀṂṄṆṈṊṌṎṐṒṔṖṘṚṜṞṠṢṤṦṨṪṬṮṰṲṴṶṸṺṼṾẀẂẄẆẈẊẌẎẐẒẔẞẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼẾỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỲỴỶỸỺỼỾἈ-ἏἘ-ἝἨ-ἯἸ-ἿὈ-ὍὙὛὝὟὨ-ὯᾸ-ΆῈ-ΉῘ-ΊῨ-ῬῸ-Ώ‐-―ℂℇℋ-ℍℐ-ℒℕℙ-ℝℤΩℨK-ℭℰ-ℳℾ-ℿⅅↃⰀ-ⰮⱠⱢ-ⱤⱧⱩⱫⱭ-ⱯⱲⱵⲀⲂⲄⲆⲈⲊⲌⲎⲐⲒⲔⲖⲘⲚⲜⲞⲠⲢⲤⲦⲨⲪⲬⲮⲰⲲⲴⲶⲸⲺⲼⲾⳀⳂⳄⳆⳈⳊⳌⳎⳐⳒⳔⳖⳘⳚⳜⳞⳠⳢ⸗⸚〜〰゠꘠-꘩ꙀꙂꙄꙆꙈꙊꙌꙎꙐꙒꙔꙖꙘꙚꙜꙞꙢꙤꙦꙨꙪꙬꚀꚂꚄꚆꚈꚊꚌꚎꚐꚒꚔꚖꜢꜤꜦꜨꜪꜬꜮꜲꜴꜶꜸꜺꜼꜾꝀꝂꝄꝆꝈꝊꝌꝎꝐꝒꝔꝖꝘꝚꝜꝞꝠꝢꝤꝦꝨꝪꝬꝮꝹꝻꝽ-ꝾꞀꞂꞄꞆꞋ꣐-꣙꤀-꤉꩐-꩙︱-︲﹘﹣－０-９Ａ-Ｚ]|\ud801[\udc00-\udc27\udca0-\udca9]|\ud835[\udc00-\udc19\udc34-\udc4d\udc68-\udc81\udc9c\udc9e-\udc9f\udca2\udca5-\udca6\udca9-\udcac\udcae-\udcb5\udcd0-\udce9\udd04-\udd05\udd07-\udd0a\udd0d-\udd14\udd16-\udd1c\udd38-\udd39\udd3b-\udd3e\udd40-\udd44\udd46\udd4a-\udd50\udd6c-\udd85\udda0-\uddb9\uddd4-\udded\ude08-\ude21\ude3c-\ude55\ude70-\ude89\udea8-\udec0\udee2-\udefa\udf1c-\udf34\udf56-\udf6e\udf90-\udfa8\udfca\udfce-\udfff]){2,}","g");function o(){const e="#video-title-link[title]";"videos"==NOVA.channelTab&&document.body.querySelectorAll(`${e} ${t}[${n}]`).forEach((t=>{(oldTitle=t.closest(e)?.title)&&(t.innerText=oldTitle,t.removeAttribute(n))}))}NOVA.css.push({"text-transform":"uppercase"},t.map((e=>`${e}[${n}]::first-letter`)),"important"),NOVA.watchElements({selectors:t,attr_mark:n,callback:async t=>{if("results"==NOVA.currentPage)return;let n=0;var o;e.thumbs_title_clear_emoji&&(t.textContent=(o=t.innerText,o.replace(/[^<>=\p{L}\p{N}\p{P}\p{Z}{\^\$}]/gu," ").replace(/\s{2,}/g," ")).trim()),e.thumbs_title_clear_symbols&&(t.textContent=(e=>e.replace(/[\u2011-\u26FF]/g," ").replace(/\s{2,}/g," "))(t.innerText).trim());const i=t.innerText.replace(l,(e=>(++n,/\d/.test(e)||1===e.length&&/[A-Z]/.test(e)||e.length<5&&e.length>1&&["HD","UHD","USB","TV","CPU","GPU","APU","AMD","XT","RX","GTX","RTX","GT","FX","SE","HP","SSD","RAM","PC","FPS","RDNA","FSR","DLSS","MSI","VR","GOTY","AAA","UI","BBC","WWE","OS","OP","ED","MV","PV","OST","NCS","BGM","EDM","GMV","AMV","MMD","MAD","SQL","CAPS"].includes(e)||e.length<5&&/(M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}))/i.test(e)?e:e.toLowerCase())));(n>a||n>1&&i.split(/\s+/).length===n)&&(t.innerText=i)}}),document.addEventListener("yt-action",(e=>{"yt-chip-cloud-chip-select-action"==e.detail?.actionName&&window.addEventListener("transitionend",o,{capture:!0,once:!0})}))},options:{thumbs_title_show_full:{_tagName:"input",label:"Show full title","label:zh":"显示完整标题","label:ja":"完全なタイトルを表示","label:pl":"Pokaż pełny tytuł",type:"checkbox"},thumbs_title_normalize_smart_max_words:{_tagName:"input",label:"Max words in uppercase","label:zh":"大写字数上限","label:ja":"大文字の最大単語数","label:pl":"Maksymalna liczba słów pisanych wielkimi literami",type:"number",placeholder:"1-10",min:1,max:10,value:2},thumbs_title_clear_emoji:{_tagName:"input",label:"Remove emoji","label:zh":"从表情符号中清除标题","label:ja":"クリア絵文字","label:pl":"Usuń emoji",type:"checkbox"},thumbs_title_clear_symbols:{_tagName:"input",label:"Remove symbols",type:"checkbox"}}}),window.nova_plugins.push({id:"thumbs-grid-count",title:"Thumbnails count in row",run_on_pages:"feed, channel, -mobile",section:"thumbs",_runtime:e=>{const t=Math.min,a=+e.thumbs_grid_count||1;Math.min=function(){return t.apply(Math,arguments)+(/calcElementsPerRow/gim.test(Error().stack||"")?a-1:0)}},options:{thumbs_grid_count:{_tagName:"input",label:"Add to row",type:"number",placeholder:"1-10",step:1,min:1,max:10,value:1}}}),window.nova_plugins.push({id:"thumbs-watch-later",title:'Add "Watch Later" button on thumbnails (for feed page)',run_on_pages:"feed, -mobile",section:"thumbs",desc:"You must be logged in",_runtime:e=>{const t="nova-thumb-overlay",a="nova-thumbs-watch-later-btn",n=["ytd-rich-item-renderer","ytd-compact-video-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"].map((e=>`${e}:not(.${a})`)).join(",");document.addEventListener("yt-action",(e=>{switch(e.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-rich-grid-layout-refreshed":case"yt-store-grafted-ve-action":if("feed"===NOVA.currentPage)document.body.querySelectorAll(n).forEach((e=>{if(e.classList.add(a),container=e.querySelector("a#thumbnail.ytd-thumbnail")){const n=document.createElement("div");n.id=t,n.append(function(e=required()){const t=document.createElement("button");return t.className=a,t.innerHTML='<svg viewBox="0 0 24 24" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M14.97 16.95 10 13.87V7h2v5.76l4.03 2.49-1.06 1.7zM12 3c-4.96 0-9 4.04-9 9s4.04 9 9 9 9-4.04 9-9-4.04-9-9-9m0-1c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2z" />\n</g>\n</svg>',t.title="Watch Later",t.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),(menu=e.querySelector("#menu button"))&&(menu.click(),await NOVA.waitSelector("#menu [menu-active]",{container:e,destroy_after_page_leaving:!0}),(menuItemEl=document.body.querySelector('tp-yt-iron-dropdown [role="menuitem"]:has(path[d^="M14.97"])'))&&(menuItemEl.style.backgroundColor="red",await menuItemEl.click(),menuItemEl.style.removeProperty("backgroundColor")),document.body.click())})),t}(e)),container.append(n)}}))}})),NOVA.css.push(`#${t} {\nposition: absolute;\ntop: 0;\nleft: 0;\nz-index: 999;\n}\nbutton.${a} {\nborder: 0;\ncursor: pointer;\nheight: 1.3em;\nfont-size: 2em;\nbackground-color: transparent;\nbackground-color: var(--yt-spec-static-overlay-background-heavy);\ncolor: var(--yt-spec-static-overlay-text-primary);\n}`)}}),window.nova_plugins.push({id:"thumbs-watched",title:"Mark watched thumbnails","title:zh":"标记您观看的缩略图","title:ja":"視聴したサムネイルにマークを付ける","title:pl":"Oznacz obejrzane miniaturki",run_on_pages:"home, results, feed, channel, playlist, watch, -mobile",section:"thumbs",_runtime:e=>{NOVA.css.push(`a#thumbnail,\na[class*="thumbnail"] {\noutline: 1px solid var(--yt-spec-general-background-a);\n}\na#thumbnail:visited,\na[class*="thumbnail"]:visited {\noutline: 1px solid ${e.thumbs_watched_frame_color||"red"} !important;\n}\nytd-playlist-panel-video-renderer a:visited #meta * {\ncolor: ${e.thumbs_watched_title_color||"#ff4500"} !important;\n}`),e.thumbs_watched_title&&NOVA.css.push(`a#video-title:visited:not(:hover),\n#description a:visited {\ncolor: ${e.thumbs_watched_title_color} !important;\n}`)},options:{thumbs_watched_frame_color:{_tagName:"input",label:"Frame color","label:zh":"框架颜色","label:ja":"フレームカラー","label:pl":"Kolor ramki",type:"color",value:"#FF0000"},thumbs_watched_title:{_tagName:"input",label:"Set title color","label:zh":"您要更改标题颜色吗？","label:ja":"タイトルの色を変更しますか？","label:pl":"Ustaw kolor tytułu",type:"checkbox"},thumbs_watched_title_color:{_tagName:"input",label:"Choose title color","label:zh":"选择标题颜色","label:ja":"タイトルの色を選択","label:pl":"Wybierz kolor tytułu",type:"color",value:"#ff4500","data-dependent":{thumbs_watched_title:!0}}}}),window.nova_plugins.push({id:"search-filter",title:"Blocked channels","title:zh":"屏蔽频道列表","title:ja":"ブロックされたチャネルのリスト","title:pl":"Zablokowane kanały",run_on_pages:"results, feed, -mobile",section:"thumbs",desc:"Hide channels on the search page","desc:zh":"在搜索页面上隐藏频道","desc:ja":"検索ページでチャンネルを非表示にする","desc:pl":"Ukryj kanały na stronie wyszukiwania",_runtime:e=>{const t=NOVA.strToArray(e.search_filter_channels_blocklist?.toLowerCase()),a=["ytd-rich-item-renderer","ytd-video-renderer","ytd-playlist-renderer","ytm-compact-video-renderer"].join(",");NOVA.isMobile?NOVA.watchElements({selectors:["#channel-name"],attr_mark:"nova-thumb-channel-filtered",callback:e=>{t.includes(e.textContent.trim().toLowerCase())&&(thumb=e.closest(a))&&thumb.remove()}}):(document.addEventListener("yt-action",(e=>{switch(e.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-rich-grid-layout-refreshed":case"yt-store-grafted-ve-action":document.body.querySelectorAll("#channel-name a[href]:first-child").forEach((e=>{t.forEach((t=>{t.startsWith("@")&&e.href.includes(t)&&(thumb=e.closest(a))?thumb.remove():e.textContent.trim().toLowerCase()==t&&(thumb=e.closest(a))&&(thumb.style.display="none")}))}))}})),"object"==typeof GM_info&&NOVA.waitSelector('tp-yt-iron-dropdown:not([aria-hidden="true"]) ytd-menu-popup-renderer[slot="dropdown-content"] [role="menuitem"]').then((t=>{const a=document.createElement("div");a.classList="style-scope ytd-menu-service-item-renderer",Object.assign(a.style,{"font-size":"14px",padding:"9px 15px 9px 56px",cursor:"pointer"}),a.innerHTML="<b>Nova block channel</b>",a.title="Nova block channel",a.addEventListener("click",(()=>{const t=document.querySelector("#menu [menu-active]").closest("#details, #meta").querySelector("#channel-name a")?.textContent;t&&confirm(`Add channel [${t}] to the blacklist?`)&&(e.search_filter_channels_blocklist+="\n"+t,GM_setValue(configStoreName,e))})),t.after(a)})))},options:{search_filter_channels_blocklist:{_tagName:"textarea",label:"List","label:zh":"频道列表","label:ja":"チャンネルリスト","label:pl":"Lista",title:'separator: "," or ";" or "new line"',"title:zh":'分隔器： "," 或 ";" 或 "新队"',"title:ja":'セパレータ： "," または ";" または "改行"',"title:pl":'separator: "," lub ";" lub "now linia"',placeholder:"channel1\nchannel2",required:!0}}}),window.nova_plugins.push({id:"thumbs-title-filter",title:"Block thumbnails by title","title:zh":"按标题阻止缩略图","title:ja":"タイトルでサムネイルをブロックする","title:pl":"Blokuj miniatury według tytułu",run_on_pages:"*, -embed, -mobile, -live_chat",section:"thumbs",_runtime:e=>{const t=NOVA.strToArray(e.thumbs_filter_title_blocklist?.toLowerCase()),a=["ytd-rich-item-renderer","ytd-video-renderer","ytd-playlist-renderer","ytd-compact-video-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"].join(",");if(NOVA.isMobile)NOVA.watchElements({selectors:["#video-title:not(:empty)"],attr_mark:"nova-thumb-title-filtered",callback:e=>{t.forEach((t=>{e.textContent.trim().toLowerCase().includes(t)&&(thumb=channel_name.closest(a))}))}});else{document.addEventListener("yt-action",(e=>{switch(e.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-rich-grid-layout-refreshed":case"yt-store-grafted-ve-action":document.body.querySelectorAll("#video-title").forEach((e=>{t.forEach((t=>{e.textContent.toLowerCase().includes(t)&&(thumb=e.closest(a))&&thumb.remove()}))}))}}))}},options:{thumbs_filter_title_blocklist:{_tagName:"textarea",label:"Words list","label:zh":"单词列表","label:ja":"単語リスト","label:pl":"Lista słów",title:'separator: "," or ";" or "new line"',"title:zh":'分隔器： "," 或 ";" 或 "新队"',"title:ja":'セパレータ： "," または ";" または "改行"',"title:pl":'separator: "," lub ";" lub "now linia"',placeholder:"text1\ntext2",required:!0}}}),window.nova_plugins.push({id:"thumbs-not-interested",title:'Add "Not Interested" button on thumbnails',run_on_pages:"feed, channel, watch, -mobile",section:"thumbs",desc:"You must be logged in",_runtime:e=>{const t="nova-thumb-overlay",a="nova-thumbs-not-interested-btn",n=["ytd-rich-item-renderer","ytd-compact-video-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"].map((e=>`${e}:not(.${a})`)).join(",");function l(e=required()){const t=document.createElement("button");return t.className=a,t.innerHTML='<svg viewBox="0 0 24 24" height="100%" width="100%">\n<g fill="currentColor">\n<path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zM3 12c0 2.31.87 4.41 2.29 6L18 5.29C16.41 3.87 14.31 3 12 3c-4.97 0-9 4.03-9 9zm15.71-6L6 18.71C7.59 20.13 9.69 21 12 21c4.97 0 9-4.03 9-9 0-2.31-.87-4.41-2.29-6z" />\n</g>\n</svg>',t.title="Not Interested",t.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),(menu=e.querySelector("#menu button"))&&(menu.click(),await NOVA.waitSelector("#menu [menu-active]",{container:e,destroy_after_page_leaving:!0}),(menuItemEl=document.body.querySelector('tp-yt-iron-dropdown [role="menuitem"]:has(path[d^="M12 2c5.52"])'))&&(menuItemEl.style.backgroundColor="red",await menuItemEl.click(),menuItemEl.style.removeProperty("backgroundColor")))})),t}document.addEventListener("yt-action",(o=>{switch(o.detail?.actionName){case"yt-append-continuation-items-action":case"ytd-update-grid-state-action":case"yt-rich-grid-layout-refreshed":case"yt-store-grafted-ve-action":case"yt-forward-redux-action-to-live-chat-iframe":switch(NOVA.currentPage){case"feed":case"watch":document.body.querySelectorAll(n).forEach((n=>{if(n.classList.add(a),container=n.querySelector("a#thumbnail.ytd-thumbnail"))if(e["thumbs-watch-later"])NOVA.waitSelector(`#${t}`,{container:container}).then((e=>{e.append(l(n))}));else{const e=document.createElement("div");e.id=t,e.append(l(n)),container.append(e)}}))}}})),e["thumbs-watch-later"]||NOVA.css.push(`#${t} {\nposition: absolute;\ntop: 0;\nleft: 0;\nz-index: 999;\n}`),NOVA.css.push(`button.${a} {\nborder: 0;\ncursor: pointer;\nheight: 1.3em;\nfont-size: 2em;\nbackground-color: transparent;\nbackground-color: var(--yt-spec-static-overlay-background-heavy);\ncolor: var(--yt-spec-static-overlay-text-primary);\n}`)}}),window.nova_plugins.push({id:"thumbs-title-lang",title:"Show titles original language","title:zh":"显示缩略图标题原始语言","title:ja":"サムネイルのタイトルを元の言語で表示する",run_on_pages:"feed, channel, watch",section:"thumbs",opt_api_key_warn:!0,"plugins-conflict":"thumbs-title-normalize",_runtime:e=>{const t="thumbs-title",a="nova-thumbs-title-lang",n=["ytd-rich-item-renderer","ytd-compact-video-renderer","yt-append-continuation-items-action","ytm-compact-video-renderer","ytm-item-section-renderer"].map((e=>`${e}:has(a#thumbnail[${a}][href*="%id%"]) #video-title`)).join(",");NOVA.css.push(`#video-title[${a}] {\ncolor: #86d2ed\n}\n*:hover > #video-title[${a}],\n*:not(:hover) > #video-title[${a}] + #video-title {\ndisplay: none !important;\n}`);let l,o=[],i={};function r(a=1){clearTimeout(l),l=setTimeout((()=>{!function(e={}){i={};const a=JSON.parse(sessionStorage.getItem(t))||{};sessionStorage.setItem(t,JSON.stringify(Object.assign(e,a)))}(i),function(a=[]){if(!a.length)return;o=[];const n=JSON.parse(sessionStorage.getItem(t));!function(t=[]){function a(e=[],t=0){let a=[];for(;e.length;)a.push(e.splice(0,+t));return a}a(t,50).forEach((t=>{NOVA.request.API({request:"videos",params:{id:t.join(","),part:"snippet"},api_key:e["user-api-key"]}).then((e=>{e?.items?.forEach((e=>{s({id:e.id,text:e.snippet.title}),i[e.id]={text:e.snippet.title}})),r(3)}))}))}(a.filter((e=>!n?.hasOwnProperty(e)||!(cacheItem=n[e])||(s({id:e,text:cacheItem.text}),!1))))}(o)}),1e3*a)}function s({id:e=required(),text:t=required()}){document.querySelectorAll(n.replaceAll("%id%",e)).forEach((e=>{if(e.textContent?.trim()==t)return;const n=e.cloneNode(!0);e.before(n),n.setAttribute(a,!0),n.textContent=t}))}NOVA.watchElements({selectors:"a#thumbnail[href].ytd-thumbnail",attr_mark:a,callback:e=>{(id=NOVA.queryURL.get("v",e.href))&&(o.push(id),r())}})}});const Plugins={run:({user_settings:e,app_ver:t})=>{if(!window.nova_plugins?.length)return console.error("nova_plugins empty",window.nova_plugins);if(!e)return console.error("user_settings empty",e);NOVA.currentPage=function(){const e=location.pathname.split("/").filter(Boolean),{page:t,channelTab:a}=function(e="home",t){switch(e){case"":e="home";break;case"live_chat":case"live_chat_replay":e="live_chat";break;case"channel":case"c":case"user":e="channel";break;case"watch":case"clip":e="watch";break;default:(e?.startsWith("@")||/[A-Z\d_]/.test(e))&&(e="channel")}switch(t){case"featured":case"videos":case"shorts":case"streams":case"podcasts":case"releases":case"playlists":case"community":case"channels":case"about":case"search":e="channel";break;default:t?.startsWith("UC")&&(e="channel"),t=!1}return{page:e,channelTab:t}}(e[0],e.pop());return NOVA.channelTab=a,t}(),NOVA.isMobile="m.youtube.com"==location.host;let a,n,l=[];window.nova_plugins?.forEach((o=>{const i=o?.run_on_pages?.split(",").map((e=>e.trim().toLowerCase())).filter(Boolean);if(n=0,a=!1,function(e){const t=e?.id&&e.run_on_pages&&"function"==typeof e._runtime;t||console.error("plugin invalid:\n",{id:e?.id,run_on_pages:e?.run_on_pages,_runtime:"function"==typeof e?._runtime});return t}(o))if(o.was_init&&!o.restart_on_location_change)a="skiped";else if(e.hasOwnProperty(o.id)){if((i?.includes(NOVA.currentPage)||i?.includes("*")&&!i?.includes("-"+NOVA.currentPage))&&(!NOVA.isMobile||NOVA.isMobile&&!i?.includes("-mobile")))try{const t=performance.now();o.was_init=!0,o._runtime(e),n=(performance.now()-t).toFixed(2),a=!0}catch(n){console.groupEnd("plugins status"),console.error(`[ERROR PLUGIN] ${o.id}\n${n.stack}\n\nPlease report the bug: https://github.com/raingart/Nova-YouTube-extension/issues/new?body=`+encodeURIComponent(t+" | "+navigator.userAgent)),e.report_issues&&_pluginsCaptureException({trace_name:o.id,err_stack:n.stack,app_ver:t,confirm_msg:`ERROR in Nova YouTube™\n\nCrash plugin: "${o.title||o.id}"\nPlease report the bug or disable the plugin\n\nSend the bug report to developer?`}),console.groupCollapsed("plugins status"),a="ERROR"}}else a="off";else console.error("Plugin invalid\n",o),alert("Plugin invalid: "+o?.id),a="INVALID";l.push({launched:a,name:o?.id,"time init (ms)":n})})),console.table(l),console.groupEnd("plugins status")}};console.log("%c /• %s •/","color:#0096fa; font-weight:bold;",GM_info.script.name+" v."+GM_info.script.version);const configPage="https://raingart.github.io/options.html",configStoreName="user_settings",user_settings=GM_getValue(configStoreName,null);if(user_settings?.exclude_iframe&&window.self!==window.top)return console.warn(GM_info.script.name+": processed in the iframe disable");if(registerMenuCommand(),location.hostname===new URL(configPage).hostname)setupConfigPage();else{if(window.self!==window.top&&!location.pathname.startsWith("/embed")&&!location.pathname.startsWith("/live_chat"))return console.warn("iframe skiped:",location.pathname);if(user_settings?.disable_setting_button||insertSettingButton(),user_settings&&Object.keys(user_settings).length){appLander();const e=Object.assign({},user_settings);delete e["user-api-key"],delete e.sponsor_block,delete e.sponsor_block_category,delete e.sponsor_block_url,delete e.thumbs_filter_title_blocklist,delete e.search_filter_channels_blocklist,delete e.thumbs_hide_live_channels_exception,delete e.comments_sort_blocklist,delete e.download_video_mode,delete e.video_unblock_region_domain,unsafeWindow.window.nova_settings=e}else confirm("Active plugins undetected. Open the settings page now?")&&window.open(configPage,"_blank"),user_settings.report_issues="on",GM_setValue(configStoreName,user_settings)}function setupConfigPage(){document.addEventListener("submit",(e=>{e.preventDefault();let t={};for(const[a,n]of new FormData(e.target))if(t.hasOwnProperty(a))t[a]+=","+n,t[a]=t[a].split(",");else switch(n){case"true":t[a]=!0;break;case"false":t[a]=!1;break;case"undefined":delete t[a];break;default:t[a]=n}console.debug(`update ${configStoreName}:`,t),GM_setValue(configStoreName,t)}),{capture:!0}),window.addEventListener("DOMContentLoaded",(()=>{localizePage(user_settings?.lang_code),storeData=user_settings,unsafeWindow.window.nova_plugins=window.nova_plugins})),window.addEventListener("load",(()=>{document.body?.classList?.remove("preload"),document.body.querySelector('a[href$="issues/new"]').addEventListener("click",(({target:e})=>{e.href+="?body="+encodeURIComponent(GM_info.script.version+" | "+navigator.userAgent)+"&labels=bug&template=bug_report.md"}))}))}function appLander(){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",a):a();let e=document.URL;const t=()=>e!=document.URL&&(e=document.URL);if(isMobile="m.youtube.com"==location.host)window.addEventListener("transitionend",(({target:e})=>"progress"==e.id&&t()&&a()));else{document.addEventListener("yt-navigate-start",(()=>t()&&a())),document.addEventListener("yt-action",(function e(n){"/watch"==location.pathname&&"yt-cache-miniplayer-page-action"==n.detail?.actionName&&t()&&(document.removeEventListener("yt-action",e),a())}))}function a(){console.groupCollapsed("plugins status"),Plugins.run({user_settings:user_settings,app_ver:GM_info.script.version})}}function registerMenuCommand(){GM_registerMenuCommand("Settings",(()=>window.open(configPage,"_blank"))),GM_registerMenuCommand("Import settings",(()=>{if(json=JSON.parse(prompt("Enter json file context")))e(json);else if(confirm("Import via file?")){const t=document.createElement("input");t.type="file",t.accept="application/JSON",t.style.display="none",t.addEventListener("change",(function(){if(1!==t.files.length)return alert("file empty");const a=new FileReader;a.addEventListener("load",(function(){try{e(JSON.parse(a.result))}catch(e){alert(`Error parsing settings\n${e.name}: ${e.message}`)}})),a.addEventListener("error",(e=>alert("Error loading file\n"+a?.error||e))),a.readAsText(t.files[0])})),document.body.append(t),t.click(),t.remove()}function e(e){GM_setValue(configStoreName,e),renameStorageKeys({disable_in_frame:"exclude_iframe","custom-api-key":"user-api-key","shorts-disable":"thumbs_hide_shorts",shorts_disable:"thumbs_hide_shorts","premiere-disable":"thumbs_hide_premieres","premieres-disable":"thumbs_hide_premieres",premieres_disable:"thumbs_hide_premieres",thumbs_min_duration:"thumbs_hide_min_duration",shorts_disable_min_duration:"thumbs_hide_min_duration","streams-disable":"thumbs_hide_live",streams_disable:"thumbs_hide_live",live_disable:"thumbs_hide_live","thumbnails-mix-hide":"thumbs_hide_mix",thumb_mix_disable:"thumbs_hide_mix",mix_disable:"thumbs_hide_mix",player_fullscreen_mode_exit:"player_fullscreen_mode_onpause","subtitle-transparent":"subtitle_transparent","video-description-expand":"description-expand",video_quality_in_music:"video_quality_in_music_playlist",player_float_progress_bar_color:"player_progress_bar_color","header-short":"header-compact","player-buttons-custom":"player-quick-buttons",shorts_thumbnails_time:"shorts-thumbnails-time","comments-sidebar-position-exchange":"move-in-sidebar",comments_sidebar_position_exchange_target:"move_in_sidebar_target",streamed_disable_channel_exception:"thumbs_hide_live_channels_exception",streamed_disable_channels_exception:"thumbs_hide_live_channels_exception",video_quality_in_music_quality:"video_quality_for_music",volume_normalization:"volume_loudness_normalization",button_no_labels_opacity:"details_buttons_opacity",details_button_no_labels_opacity:"details_buttons_opacity","button-no-labels":"details_buttons_label_hide",details_button_no_labels:"details_buttons_label_hide","volume-wheel":"video-volume","rate-wheel":"video-rate","video-stop-preload":"video-autostop",stop_preload_ignore_playlist:"video_autostop_ignore_playlist",stop_preload_ignore_live:"video_autostop_ignore_live",stop_preload_embed:"video_autostop_embed","disable-video-cards":"pages-clear",volume_level_default:"volume_default",thumb_filter_title_blocklist:"thumbs_filter_title_blocklist",search_filter_channel_blocklist:"search_filter_channels_blocklist",streamed_disable:"thumbs_hide_streamed",watched_disable:"thumbs_hide_watched",watched_disable_percent_complete:"thumbs_hide_watched_percent_complete","sidebar-channel-links-patch":"sidebar-thumbs-channel-link-patch","move-in-sidebar":"move-to-sidebar",move_in_sidebar_target:"move_to_sidebar_target",skip_into_step:"skip_into_sec","miniplayer-disable":"default-miniplayer-disable",thumbnails_title_normalize_show_full:"thumbs_title_show_full",thumbnails_title_normalize_smart_max_words:"thumbs_title_normalize_smart_max_words",thumbnails_title_clear_emoji:"thumbs_title_clear_emoji",thumbnails_title_clear_symbols:"thumbs_title_clear_symbols","thumbnails-clear":"thumbs-clear",thumbnails_clear_preview_timestamp:"thumbs_clear_preview_timestamp",thumbnails_clear_overlay:"thumbs_clear_overlay","thumbnails-grid-count":"thumbs-grid-count",thumbnails_grid_count:"thumbs_grid_count","thumbnails-watched":"thumbs-watched",thumbnails_watched_frame_color:"thumbs_watched_frame_color",thumbnails_watched_title:"thumbs_watched_title",thumbnails_watched_title_color:"thumbs_watched_title_color","details-buttons":"details-buttons-visibility",comments_sort_words_blocklist:"comments_sort_blocklist","thumbnails-title-normalize":"thumbs-title-normalize",time_remaining_mode:"time_remaining_format"}),alert("Settings imported!"),location.reload()}})),GM_registerMenuCommand("Export settings",(()=>{const e=document.createElement("a");e.style.display="none",e.download="nova_backup.json",e.href="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(user_settings)),document.body.append(e),e.click(),e.remove()}))}function renameStorageKeys(e=required()){let t;for(const a in user_settings)(newKey=e[a])&&(console.log(a,"=>",newKey),t=!0,delete Object.assign(user_settings,{[newKey]:user_settings[a]})[a]),t&&GM_setValue(configStoreName,user_settings)}function insertSettingButton(){NOVA.waitSelector("#masthead #end").then((e=>{const t="Nova Settings",a=document.createElement("a"),n="nova_settings_button";a.id=n,a.href=configPage,a.target="_blank",a.innerHTML='<yt-icon-button class="style-scope ytd-button-renderer style-default size-default">\n<svg viewBox="-4 0 20 16">\n<radialGradient id="nova-gradient" gradientUnits="userSpaceOnUse" cx="6" cy="22" r="18.5">\n<stop class="nova-gradient-start" offset="0"/>\n<stop class="nova-gradient-stop" offset="1"/>\n</radialGradient>\n<g fill="deepskyblue">\n<polygon points="0,16 14,8 0,0"/>\n</g>\n</svg>\n</yt-icon-button>',a.addEventListener("click",null,{capture:!0}),a.title=t;const l=document.createElement("tp-yt-paper-tooltip");l.className="style-scope ytd-topbar-menu-button-renderer",l.textContent=t,a.appendChild(l),NOVA.css.push(`#${n}[tooltip]:hover:after {\nposition: absolute;\ntop: 50px;\ntransform: translateX(-50%);\ncontent: attr(tooltip);\ntext-align: center;\nmin-width: 3em;\nmax-width: 21em;\nwhite-space: nowrap;\noverflow: hidden;\ntext-overflow: ellipsis;\npadding: 1.8ch 1.2ch;\nborder-radius: .6ch;\nbackground-color: #616161;\nbox-shadow: 0 1em 2em -0.5em rgb(0 0 0 / 35%);\ncolor: white;\nz-index: 1000;\n}\n#${n} {\nposition: relative;\nopacity: .3;\ntransition: opacity 300ms ease-out;\n}\n#${n}:hover {\nopacity: 1 !important;\n}\n#${n} path,\n#${n} polygon {\nfill: url(#nova-gradient);\n}\n#${n} .nova-gradient-start,\n#${n} .nova-gradient-stop {\ntransition: 600ms;\nstop-color: #7a7cbd;\n}\n#${n}:hover .nova-gradient-start {\nstop-color: #0ff;\n}\n#${n}:hover .nova-gradient-stop {\nstop-color: #0095ff;\n}`),e.prepend(a)}))}function _pluginsCaptureException({trace_name:e,err_stack:t,confirm_msg:a,app_ver:n}){confirm(a||`Error in ${GM_info.script.name}. Send the bug raport to developer?`)&&window.open("https://docs.google.com/forms/u/0/d/e/1FAIpQLScfpAvLoqWlD5fO3g-fRmj4aCeJP9ZkdzarWB8ge8oLpE5Cpg/viewform?entry.35504208="+encodeURIComponent(e)+"&entry.151125768="+encodeURIComponent(t)+"&entry.744404568="+encodeURIComponent(document.URL)+"&entry.1416921320="+encodeURIComponent(n+" | "+navigator.userAgent+" ["+window.navigator.language+"]"),"_blank")}user_settings.report_issues&&window.addEventListener("unhandledrejection",(e=>{(e.reason?.stack||e.stack)?.includes("Nova")&&!(e.reason?.stack||e.stack)?.includes("movie_player is not defined")&&(console.error("[ERROR PROMISE]\n",e.reason,"\nPlease report the bug: https://github.com/raingart/Nova-YouTube-extension/issues/new?body="+encodeURIComponent(GM_info.script.version+" | "+navigator.userAgent)),_pluginsCaptureException({trace_name:"unhandledRejection",err_stack:e.reason.stack||e.stack,app_ver:GM_info.script.version,confirm_msg:`Failure when async-call of one "${GM_info.script.name}" plugin.\nDetails in the console\n\nOpen tab to report the bug?`}))}));