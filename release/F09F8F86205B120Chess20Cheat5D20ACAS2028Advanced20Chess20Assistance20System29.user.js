// ==UserScript==
// @name        🏆 [#1 Chess Cheat] A.C.A.S (Advanced Chess Assistance System)
// @name:en     🏆 [#1 Chess Cheat] A.C.A.S (Advanced Chess Assistance System)
// @description        Enhance your chess performance with a cutting-edge real-time move analysis and strategy assistance system
// @homepageURL https://psyyke.github.io/A.C.A.S
// @supportURL  https://github.com/Psyyke/A.C.A.S/tree/main#why-doesnt-it-work
// @match       https://psyyke.github.io/A.C.A.S/*
// @match       http://localhost/*
// @match       https://www.chess.com/*
// @match       https://lichess.org/*
// @match       https://playstrategy.org/*
// @match       https://www.pychess.org/*
// @match       https://chess.org/*
// @match       https://papergames.io/*
// @match       https://vole.wtf/kilobytes-gambit/
// @match       https://chess.coolmathgames.com/*
// @match       https://www.coolmathgames.com/0-chess/*
// @match       https://immortal.game/*
// @match       https://chessarena.com/*
// @match       http://chess.net/*
// @match       https://chess.net/*
// @match       https://www.freechess.club/*
// @match       https://*chessclub.com/*
// @match       https://gameknot.com/*
// @match       https://chesstempo.com/*
// @match       https://www.redhotpawn.com/*
// @match       https://www.chessanytime.com/*
// @match       https://www.simplechess.com/*
// @match       https://chessworld.net/*
// @match       https://app.edchess.io/*
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_deleteValue
// @grant       GM_listValues
// @grant       GM_registerMenuCommand
// @grant       GM_openInTab
// @grant       GM_addStyle
// @grant       GM_setClipboard
// @grant       GM_notification
// @grant       unsafeWindow
// @run-at      document-start
// @require     https://greasyfork.org/scripts/470418-commlink-js/code/CommLinkjs.js
// @require     https://greasyfork.org/scripts/470417-universalboarddrawer-js/code/UniversalBoardDrawerjs.js
// @icon        https://raw.githubusercontent.com/Psyyke/A.C.A.S/main/assets/images/grey-logo.png
// @version     2.2.5
// @namespace   HKR
// @author      HKR
// @license     GPL-3.0
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/F09F8F86205B120Chess20Cheat5D20ACAS2028Advanced20Chess20Assistance20System29.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/F09F8F86205B120Chess20Cheat5D20ACAS2028Advanced20Chess20Assistance20System29.meta.js
// ==/UserScript==
const debugModeActivated=!1,onlyUseDevelopmentBackend=!1,domain=window.location.hostname.replace("www.",""),greasyforkURL="https://greasyfork.org/en/scripts/459137",backendConfig={hosts:{prod:"psyyke.github.io",dev:"localhost"},path:"/A.C.A.S/"},currentBackendUrlKey="currentBackendURL",isBackendUrlUpToDate=Object.values(backendConfig.hosts).some((e=>GM_getValue("currentBackendURL")?.includes(e)));function constructBackendURL(e){const t=window.location.protocol+"//",o=backendConfig.hosts;return t+(e||o?.prod||o?.path)+backendConfig.path}function isRunningOnBackend(){const e=Object.values(backendConfig.hosts).find((e=>e===window?.location?.host)),t=window?.location?.pathname?.includes(backendConfig.path);return!("string"!=typeof e||!t)&&(GM_setValue("currentBackendURL",constructBackendURL(e)),!0)}function prependProtocolWhenNeeded(e){return e.startsWith("http://")||e.startsWith("https://")?e:"http://"+e}function getCurrentBackendURL(e){const t=GM_getValue("currentBackendURL");return e||!t?constructBackendURL():prependProtocolWhenNeeded(t)}function createInstanceVariable(e){return{set:(t,o)=>GM_setValue(dbValues[e](t),{value:o,date:Date.now()}),get:t=>{const o=GM_getValue(dbValues[e](t));return o?.date&&(o.date=Date.now(),GM_setValue(dbValues[e](t),o)),o?.value}}}isBackendUrlUpToDate||GM_setValue("currentBackendURL",getCurrentBackendURL(!0));const tempValueIndicator="-temp-value-",dbValues={AcasConfig:"AcasConfig",playerColor:e=>"playerColor-temp-value-"+e,turn:e=>"turn-temp-value-"+e,fen:e=>"fen-temp-value-"+e},instanceVars={playerColor:createInstanceVariable("playerColor"),fen:createInstanceVariable("fen")};if(isRunningOnBackend())return void(unsafeWindow.USERSCRIPT={GM_info:GM_info,GM_getValue:e=>GM_getValue(e),GM_setValue:(e,t)=>GM_setValue(e,t),GM_deleteValue:e=>GM_deleteValue(e),GM_listValues:e=>GM_listValues(e),tempValueIndicator:"-temp-value-",dbValues:dbValues,instanceVars:instanceVars,CommLinkHandler:CommLinkHandler});function getUniqueID(){return([1e7]+-1e3+4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}const commLinkInstanceID=getUniqueID(),blacklistedURLs=[constructBackendURL(backendConfig?.hosts?.prod),constructBackendURL(backendConfig?.hosts?.dev),"https://www.chess.com/play","https://lichess.org/","https://chess.org/","https://papergames.io/en/chess","https://playstrategy.org/","https://www.pychess.org/","https://www.coolmathgames.com/0-chess","https://chess.net/"],configKeys={engineElo:"engineElo",moveSuggestionAmount:"moveSuggestionAmount",arrowOpacity:"arrowOpacity",displayMovesOnExternalSite:"displayMovesOnExternalSite",showMoveGhost:"showMoveGhost",showOpponentMoveGuess:"showOpponentMoveGuess",showOpponentMoveGuessConstantly:"showOpponentMoveGuessConstantly",onlyShowTopMoves:"onlyShowTopMoves",maxMovetime:"maxMovetime",chessVariant:"chessVariant",chessEngine:"chessEngine",lc0Weight:"lc0Weight",engineNodes:"engineNodes",chessFont:"chessFont",useChess960:"useChess960",onlyCalculateOwnTurn:"onlyCalculateOwnTurn",ttsVoiceEnabled:"ttsVoiceEnabled",ttsVoiceName:"ttsVoiceName",ttsVoiceSpeed:"ttsVoiceSpeed",chessEngineProfile:"chessEngineProfile",primaryArrowColorHex:"primaryArrowColorHex",secondaryArrowColorHex:"secondaryArrowColorHex",opponentArrowColorHex:"opponentArrowColorHex",reverseSide:"reverseSide",autoMove:"autoMove",autoMoveLegit:"autoMoveLegit",autoMoveRandom:"autoMoveRandom",autoMoveAfterUser:"autoMoveAfterUser",legitModeType:"legitModeType",moveDisplayDelay:"moveDisplayDelay"},config={};Object.values(configKeys).forEach((e=>{config[e]={get:t=>getGmConfigValue(e,commLinkInstanceID,t),set:null}}));let BoardDrawer=null,chessBoardElem=null,chesscomVariantPlayerColorsTable=null,activeGuiMoveMarkings=[],lastBoardRanks=null,lastBoardFiles=null,lastBoardSize=null,lastPieceSize=null,lastBoardMatrix=null,lastBoardOrientation=null,matchFirstSuggestionGiven=!1,lastMoveRequestTime=0,lastPieceAmount=0,isUserMouseDown=!1,activeAutomoves=[];const supportedSites={},pieceNameToFen={pawn:"p",knight:"n",bishop:"b",rook:"r",queen:"q",king:"k"};function getArrowStyle(e,t,o){const n=["stroke: rgb(0 0 0 / 50%);","stroke-width: 2px;","stroke-linejoin: round;"];switch(e){case"best":return[`fill: ${t||"limegreen"};`,`opacity: ${o||.9};`,...n].join("\n");case"secondary":return[...n,`fill: ${t||"dodgerblue"};`,`opacity: ${o||.7};`].join("\n");case"opponent":return[...n,`fill: ${t||"crimson"};`,`opacity: ${o||.3};`].join("\n")}}const CommLink=new CommLinkHandler(`frontend_${commLinkInstanceID}`,{singlePacketResponseWaitTime:1500,maxSendAttempts:3,statusCheckInterval:1,silentMode:!0});CommLink.commands.createInstance=async()=>await CommLink.send("mum","createInstance",{domain:domain,instanceID:commLinkInstanceID,chessVariant:getChessVariant(),playerColor:getPlayerColorVariable()}),CommLink.registerSendCommand("ping",{commlinkID:"mum",data:"ping"}),CommLink.registerSendCommand("pingInstance",{data:"ping"}),CommLink.registerSendCommand("log"),CommLink.registerSendCommand("updateBoardOrientation"),CommLink.registerSendCommand("updateBoardFen"),CommLink.registerSendCommand("calculateBestMoves"),CommLink.registerListener(`backend_${commLinkInstanceID}`,(e=>{try{switch(e.command){case"ping":return`pong (took ${Date.now()-e.date}ms)`;case"getFen":return getFen();case"removeSiteMoveMarkings":return boardUtils.removeMarkings(),!0;case"markMoveToSite":boardUtils.markMoves(e.data);const t=e.data?.[0]?.profile,o=getConfigValue(configKeys.autoMove,t),n=getConfigValue(configKeys.autoMoveAfterUser,t);if(o&&(!n||matchFirstSuggestionGiven)){const o=activeAutomoves.filter((e=>e.move.active));for(const e of o)e.move.stop();const n=getConfigValue(configKeys.autoMoveLegit,t),s=getConfigValue(configKeys.autoMoveRandom,t);makeMove(t,s?e.data[Math.floor(Math.random()*Math.random()*e.data.length)]?.player:e.data[0]?.player,n)}return matchFirstSuggestionGiven=!0,!0}}catch(e){return null}}));const boardUtils={markMoves:e=>{const t=e.length;e.forEach(((e,o)=>{const n=e.profile;0===o&&boardUtils.removeMarkings(n);const[s,a]=e.player,[i,r]=e.opponent,c=i&&r,l=o+1,d=getConfigValue(configKeys.showOpponentMoveGuess,n),m=getConfigValue(configKeys.showOpponentMoveGuessConstantly,n),u=getConfigValue(configKeys.arrowOpacity,n)/100,h=getConfigValue(configKeys.primaryArrowColorHex,n),p=getConfigValue(configKeys.secondaryArrowColorHex,n),g=getConfigValue(configKeys.opponentArrowColorHex,n);let f=null,y=null,w=getArrowStyle("best",h,u),C=30,b=80,v=60,M=30;if(0!==o){w=getArrowStyle("secondary",p,u);const e=2===t?.75:1-(l-1)/(t-1)*.5;C*=e,b*=e,v*=e}if(f=BoardDrawer.createShape("arrow",[s,a],{style:w,lineWidth:C,arrowheadWidth:b,arrowheadHeight:v,startOffset:M}),c&&d)if(y=BoardDrawer.createShape("arrow",[i,r],{style:getArrowStyle("opponent",g,u),lineWidth:C,arrowheadWidth:b,arrowheadHeight:v,startOffset:M}),m)y.style.display="block";else{const e=BoardDrawer.addSquareListener(s,(t=>{switch(y||e.remove(),t){case"enter":y.style.display="inherit";break;case"leave":y.style.display="none"}}))}if(0===o&&f){const e=f.parentElement;e.appendChild(f),y&&e.appendChild(y)}activeGuiMoveMarkings.push({...e,playerArrowElem:f,oppArrowElem:y,profile:n})}))},removeMarkings:e=>{let t=activeGuiMoveMarkings;e?(t=t.filter((t=>t.profile===e)),activeGuiMoveMarkings=activeGuiMoveMarkings.filter((t=>t.profile!==e))):activeGuiMoveMarkings=[],t.forEach((e=>{e.oppArrowElem?.remove(),e.playerArrowElem?.remove()}))},setBoardOrientation:e=>{BoardDrawer&&BoardDrawer.setOrientation(e)},setBoardDimensions:e=>{BoardDrawer&&BoardDrawer.setBoardDimensions(e)}};function displayImportantNotification(e,t){"function"==typeof GM_notification?GM_notification({title:e,text:t}):alert(`[${e}]\n\n`+t)}function filterInvisibleElems(e,t){return[...e].filter((e=>{const o=getComputedStyle(e),n=e.getBoundingClientRect(),s="hidden"===o.visibility||"none"===o.display||"0"===o.opacity||0==n.width||0==n.height;return t?s:!s}))}function getElementSize(e){const t=e.getBoundingClientRect();if(0!==t.width&&0!==t.height)return{width:t.width,height:t.height};const o=window.getComputedStyle(e);return{width:parseFloat(o.width),height:parseFloat(o.height)}}function extractElemTransformData(e){const t=window.getComputedStyle(e),o=new DOMMatrix(t.transform);return[o.e,o.f]}function getElemCoordinatesFromTransform(e,t){const o=t?.onlyFlipY;lastBoardSize=getElementSize(chessBoardElem);const[n,s]=getBoardDimensions();lastBoardRanks=s,lastBoardFiles=n;const a=getPlayerColorVariable();let[i,r]=extractElemTransformData(e);let c=lastBoardSize.width/lastBoardRanks;const l=Math.round(i/c),d=Math.round(r/c);if(o||"w"===a){return[l,lastBoardFiles-d-1]}return[lastBoardRanks-l-1,d]}function getElemCoordinatesFromLeftBottomPercentages(e){if(!lastBoardRanks||!lastBoardFiles){const[e,t]=getBoardDimensions();lastBoardRanks=t,lastBoardFiles=e}const t=getPlayerColorVariable(),o=parseFloat(e.style.left?.replace("%","")),n=parseFloat(e.style.bottom?.replace("%","")),s=Math.max(Math.round(o/(100/lastBoardRanks)),0),a=Math.max(Math.round(n/(100/lastBoardFiles)),0);if("w"===t)return[s,a];return[lastBoardRanks-(s+1),lastBoardFiles-(a+1)]}function getElemCoordinatesFromLeftTopPixels(e){const t=getElementSize(e);lastPieceSize=t;const o=parseFloat(e.style.left?.replace("px","")),n=parseFloat(e.style.top?.replace("px","")),s=Math.max(Math.round(o/t.width),0),a=Math.max(Math.round(n/t.width),0);if("w"===getPlayerColorVariable()){return[s,lastBoardFiles-(a+1)]}return[lastBoardRanks-(s+1),a]}function updateChesscomVariantPlayerColorsTable(){let e=[];document.querySelectorAll("*[data-color]").forEach((t=>{const o=Number(t?.dataset?.color);e?.includes(o)||e.push(o)})),e?.length>1&&(e=e.sort(((e,t)=>e-t)),chesscomVariantPlayerColorsTable={[e[0]]:"w",[e[1]]:"b"})}function getBoardDimensionsFromSize(){const e=getElementSize(chessBoardElem);lastBoardSize=e;const t=e?.width,o=e.height,n=getPieceElem();if(n){const e=getElementSize(n);lastPieceSize=getElementSize(n);const s=e?.width,a=e?.height,i=Math.floor(t/s),r=Math.floor(o/a);if(0<i&&i<=69&&(0<r&&r<=69))return[i,r]}}function chessCoordinatesToIndex(e){const t=e.charCodeAt(0)-97;let o=null;return o=":"===e.slice(1)?9:Number(e.slice(1))-1,[t,o]}function chessCoordinatesToMatrixIndex(e){const[t,o]=getBoardDimensions(),n=chessCoordinatesToIndex(e);let s,a;return a=o-(n[1]+1),s=n[0],[s,a]}function chessCoordinatesToDomIndex(e){const[t,o]=getBoardDimensions(),n=chessCoordinatesToIndex(e);let s,a;return"w"===getBoardOrientation()?(s=n[0],a=o-(n[1]+1)):(s=t-(n[0]+1),a=n[1]),[s,a]}function indexToChessCoordinates(e){const[t,o]=getBoardDimensions(),[n,s]=(getBoardOrientation(),e);let a;return a=t-s,`${String.fromCharCode("a".charCodeAt(0)+n)}${a}`}function isPawnPromotion(e){const[t,o]=e,n=getBoardPiece(t);if("string"!=typeof n||"p"!==n.toLowerCase())return!1;const s=parseInt(o[1],10);return"P"===n&&s===(lastBoardFiles??8)||"p"===n&&1===s}function fenCoordArrToDomCoord(e){const t=chessBoardElem.getBoundingClientRect(),o=getElementSize(getPieceElem()),n=o?.width,s=o?.height;lastPieceSize=o;const[a,i]=getBoardDimensions();return e.map((e=>{const[o,a]=chessCoordinatesToDomIndex(e);return[t.x+o*n+n/2,t.y+a*s+s/2]}))}function getRandomOwnPieceDomCoord(e,t){getBoardOrientation();let[o,n]=chessCoordinatesToMatrixIndex(e);const s=t[n][o];if(1===s)return null;const a=s===s.toUpperCase();let i=[];for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){const m=t[e][s];if(1===m||a&&m===m.toLowerCase()||!a&&m===m.toUpperCase())continue;const u=(r=n,c=o,l=e,d=s,Math.abs(r-l)+Math.abs(c-d));u<6&&i.push({distance:u,coord:[s,e],piece:m})}var r,c,l,d;if(i.length>0){return fenCoordArrToDomCoord([indexToChessCoordinates(i[Math.floor(Math.random()*i.length)].coord)])[0]}return null}function getPieceAmount(){return getPieceElem(!0)?.length??0}class AutomaticMove{constructor(e,t,o,n){if(this.id=getUniqueID(),activeAutomoves.push({id:this.id,move:this}),this.profile=e,this.fenMoveArr=t,this.isLegit=o,this.active=!0,this.isPromotingPawn=!1,this.onFinished=function(...e){activeAutomoves.filter((e=>e.id!==this.id)),this.active=!1,n(...e)},this.moveDomCoords=fenCoordArrToDomCoord(t),this.isPromotion=isPawnPromotion(t),this.isLegit){const e=getConfigValue(configKeys.legitModeType,this.profile)??"casual",t=[{minPieces:30,maxPieces:1/0},{minPieces:23,maxPieces:29},{minPieces:16,maxPieces:22},{minPieces:10,maxPieces:15},{minPieces:6,maxPieces:9},{minPieces:3,maxPieces:5},{minPieces:1,maxPieces:2}],o={beginner:[[2e3,4e3],[3e3,15e3],[5e3,25e3],[4e3,3e4],[3e3,15e3],[2e3,1e4],[1e3,4e3]],casual:[[900,3e3],[1e3,15e3],[3e3,2e4],[2e3,13e3],[1500,1e4],[1e3,9e3],[500,3e3]],intermediate:[[750,2e3],[1e3,1e4],[2e3,15e3],[1500,12e3],[1e3,8e3],[750,7e3],[500,2e3]],advanced:[[500,1500],[1e3,8e3],[750,8e3],[750,12e3],[750,5e3],[750,3e3],[500,1200]],master:[[333,999],[400,2e3],[400,3e3],[400,2500],[400,2e3],[400,1500],[333,750]],professional:[[333,666],[333,666],[333,1e3],[333,1500],[333,1e3],[333,666],[333,666]],god:[[50,333],[50,233],[50,300],[50,250],[50,200],[50,150],[50,100]]};this.timeRanges=t.map(((t,n)=>({...t,timeRange:o[e][n]}))),this.shouldHesitate=this.isLegit&&Math.random()<.15,this.shouldHesitateTwice=this.isLegit&&Math.random()<.25,this.hesitationTypeOne=this.isLegit&&Math.random()<.35;const n=this.calculateMoveTime(getPieceAmount()),s=Date.now()-lastMoveRequestTime,a=Math.max(n-s,500),i=this.generateDelaysForDesiredTime(a);for(const e of Object.keys(i))this[e]=i[e]}this.start()}generateDelaysForDesiredTime(e){const t=this.getRandomIntegerBetween(1e3,1111);if(e>6e3){const o=[{move:.4,to:.2,hesitation:.15,hesitationResolve:.15,secondHesitationResolve:.15},{move:.1,to:.3,hesitation:.25,hesitationResolve:.15,secondHesitationResolve:.2},{move:.2,to:.25,hesitation:.2,hesitationResolve:.2,secondHesitationResolve:.15}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:e*n.hesitation,hesitationResolveDelay:e*n.hesitationResolve,secondHesitationResolveDelay:e*n.secondHesitationResolve}}if(e>3e3){const o=[{move:.3,to:.2,hesitation:.25,hesitationResolve:.25},{move:.1,to:.3,hesitation:.45,hesitationResolve:.15},{move:.2,to:.25,hesitation:.2,hesitationResolve:.35}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:e*n.hesitation,hesitationResolveDelay:e*n.hesitationResolve,secondHesitationResolveDelay:-1}}{const o=[{move:.9,to:.1},{move:.45,to:.55},{move:.6,to:.4},{move:.4,to:.6},{move:.1,to:.9}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:-1,hesitationResolveDelay:-1,secondHesitationResolveDelay:-1}}}calculateMoveTime(e){for(let t of this.timeRanges)if(e>=t.minPieces&&e<=t.maxPieces)return this.getRandomIntegerBetween(t.timeRange[0],t.timeRange[1]);return 500}getRandomIntegerBetween(e,t){return Math.floor(Math.random()*(t-e+1))+e}getRandomIntegerNearAverage(e,t){const o=(e+t)/2,n=(t-e)/2;let s=Math.floor(o+(Math.random()-.5)*n*1.5);return Math.max(e,Math.min(t,s))}delay(e){return!this.active||new Promise((t=>setTimeout(t,e)))}async triggerPieceClick(e){if(!!!activeAutomoves.find((e=>e.move===this)))return;let t,o;if(e instanceof Element){const n=e.getBoundingClientRect();t=n.left+n.width/2,o=n.top+n.height/2}else{if("object"!=typeof e)return;t=e[0],o=e[1]}const n=Math.random()<.85?4:Math.random()<.15?3:2,s=Math.random()<.65?3:Math.random()<.35?2:4,a=(lastPieceSize?.width-4)/n,i=(lastPieceSize?.height-4)/s,r=t+2*(Math.random()-.5)*a,c=o+2*(Math.pow(Math.random(),.5)-.5)*i,l={bubbles:!0,cancelable:!0,clientX:r,clientY:c},d=e instanceof Element?e:document.elementFromPoint(t,o);if(d)switch(domain){case"chess.com":d.dispatchEvent(new PointerEvent("pointerdown",l)),this.isLegit&&await this.delay(this.getRandomIntegerNearAverage(35,125)),d.dispatchEvent(new PointerEvent("pointerup",l));break;case"lichess.org":case"chessarena.com":d.dispatchEvent(new MouseEvent("mousedown",l)),this.isLegit&&await this.delay(this.getRandomIntegerNearAverage(35,125)),d.dispatchEvent(new MouseEvent("mouseup",l))}}click(e){this.active&&this.triggerPieceClick(e)}async hesitate(){const e=getRandomOwnPieceDomCoord(this.fenMoveArr[0],getBoardMatrix());if(e&&(this.hesitationTypeOne&&(this.click(this.moveDomCoords[0]),await this.delay(this.hesitationDelay)),this.click(e),await this.delay(this.hesitationResolveDelay),this.shouldHesitateTwice&&-1!==this.secondHesitationResolveDelay)){const e=getRandomOwnPieceDomCoord(this.fenMoveArr[0],getBoardMatrix());this.click(e),await this.delay(this.secondHesitationResolveDelay)}this.finishMove(this.toSquareSelectDelay,this.promotionDelay)}async finishMove(e,t){this.click(this.moveDomCoords[0]),await this.delay(e),this.click(this.moveDomCoords[1]),this.isPromotion&&(this.isPromotingPawn=!0,await this.delay(t),this.click(this.moveDomCoords[1]),this.isPromotingPawn=!1),this.onFinished(!0)}async playLegit(){await this.delay(this.moveDelay),this.shouldHesitate&&-1!==this.hesitationDelay?this.hesitate():this.finishMove(this.toSquareSelectDelay,this.promotionDelay)}async start(){this.isLegit?this.playLegit():this.finishMove(5,1111)}async stop(){this.isPromotingPawn&&this.click(this.moveDomCoords[1]),this.onFinished(!1)}}async function makeMove(e,t,o){new AutomaticMove(e,t,o,(e=>{false}))}function getGmConfigValue(e,t,o){"object"==typeof o&&(o=o.name);const n=GM_getValue(dbValues.AcasConfig),s=n?.instance?.[t]?.[e],a=n?.global?.[e];if(void 0!==s)return s;if(void 0!==a)return a;if(o){const s=n?.global?.profiles?.[o]?.[e],a=n?.instance?.[t]?.profiles?.[o]?.[e];if(void 0!==a)return a;if(void 0!==s)return s}return null}function isBoardDrawerNeeded(){const e=GM_getValue(dbValues.AcasConfig),t=e?.global?.profiles,o=e?.instance?.[commLinkInstanceID]?.profiles;if(t){const e=Object.keys(t);for(profileName of e)if(t[profileName][configKeys.displayMovesOnExternalSite])return!0}if(o){const e=Object.keys(o);for(profileName of e)if(o[profileName][configKeys.displayMovesOnExternalSite])return!0}return!1}function getConfigValue(e,t){return config[e]?.get(t)}function setConfigValue(e,t){return config[e]?.set(t)}function squeezeEmptySquares(e){return e.replace(/1+/g,(e=>e.length))}function getPlayerColorVariable(){return instanceVars.playerColor.get(commLinkInstanceID)}function getFenPieceColor(e){return e==e.toUpperCase()?"w":"b"}function getFenPieceOppositeColor(e){return"w"==getFenPieceColor(e)?"b":"w"}function convertPieceStrToFen(e){if(!e||2!==e.length)return null;const t=e[0].toLowerCase(),o=e[1];return"w"===t?o.toUpperCase():"b"===t?o.toLowerCase():null}function getCanvasPixelColor(e,[t,o],n){const s=e.getContext("2d"),a=t*e.width,i=o*e.height,r=s.getImageData(a,i,1,1).data,c=(r[0]+r[1]+r[2])/3;if(n){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");o.drawImage(e,0,0),o.fillStyle="red",o.beginPath(),o.arc(a,i,1,0,2*Math.PI),o.fill();const n=t.toDataURL();console.log(e,r,n)}return c<128?"b":"w"}function canvasHasPixelAt(e,[t,o],n){t=Math.min(Math.max(t,0),100),o=Math.min(Math.max(o,0),100);const s=e.getContext("2d"),a=t*e.width,i=o*e.height,r=s.getImageData(a,i,1,1).data;if(n){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");o.drawImage(e,0,0),o.fillStyle="red",o.beginPath(),o.arc(a,i,1,0,2*Math.PI),o.fill();const n=t.toDataURL();console.log(e,r,n)}return 0!==r[3]}function getSiteData(e,t){let o={pathname:window.location.pathname};t&&"object"==typeof t&&(o={...o,...t});const n=supportedSites[domain]?.[e];if("function"!=typeof n)return null;return n(o)}function addSupportedChessSite(e,t){supportedSites[e]=t}function getBoardElem(){return getSiteData("boardElem")||null}function getPieceElem(e){const t=getBoardElem(),o=e?e=>[...t?.querySelectorAll(e)]:t?.querySelector?.bind(t);if("function"!=typeof o)return null;return getSiteData("pieceElem",{boardQuerySelector:o,getAll:e})||null}function getSquareElems(e){return getSiteData("squareElems",{element:e})||null}function getChessVariant(){return getSiteData("chessVariant")||null}function getBoardOrientation(){return getSiteData("boardOrientation")||null}function getPieceElemFen(e){return getSiteData("pieceElemFen",{pieceElem:e})||null}function getPieceElemCoords(e){return getSiteData("pieceElemCoords",{pieceElem:e})||null}function getBoardDimensions(){const e=getSiteData("boardDimensions");return e?(lastBoardRanks=e[0],lastBoardFiles=e[1],e):(lastBoardRanks=8,lastBoardFiles=8,[8,8])}function isMutationNewMove(e){return getSiteData("isMutationNewMove",{mutationArr:e})||!1}function getBoardMatrix(){const[e,t]=getBoardDimensions(),o=Array.from({length:t},(()=>Array(e).fill(1))),n=getPieceElem(!0);return(Array.isArray(n)||n instanceof NodeList)&&n.forEach((e=>{const n=getPieceElemFen(e),s=getPieceElemCoords(e);try{const[e,a]=s;o[t-(a+1)][e]=n}catch(e){false}})),lastBoardMatrix=o,o}function getBoardPiece(e){const[t,o]=getBoardDimensions(),n=chessCoordinatesToIndex(e);return getBoardMatrix()?.[o-(n[1]+1)]?.[n[0]]}function getRights(){let e="";const t=getBoardPiece("e1"),o=getBoardPiece("h1"),n=getBoardPiece("a1");"K"==t&&"R"==o&&(e+="K"),"K"==t&&"R"==n&&(e+="Q");const s=getBoardPiece("e8"),a=getBoardPiece("h8"),i=getBoardPiece("a8");return"k"==s&&"r"==a&&(e+="k"),"k"==s&&"r"==i&&(e+="q"),e||"-"}function getBasicFen(){return squeezeEmptySquares(getBoardMatrix().map((e=>e.join(""))).join("/"))}function getFen(e){const t=getBasicFen();if(e)return t;return`${t} ${getPlayerColorVariable()} ${getRights()} - 0 1`}function resetCachedValues(){chesscomVariantPlayerColorsTable=null}function fenToArray(e){const t=e.split("/"),o=[];for(let e of t){const t=[];for(let o of e)isNaN(o)?t.push(o):t.push(...Array(parseInt(o)).fill(""));o.push(t)}return o}function onNewMove(e,t){const o=getFen();if(o!==instanceVars.fen.get(commLinkInstanceID)||t){false;const e=getPieceAmount();Math.abs(e-lastPieceAmount)>7&&(matchFirstSuggestionGiven=!1),resetCachedValues(),boardUtils.setBoardDimensions(getBoardDimensions());const t=getPlayerColorVariable();updatePlayerColor();const n=getPlayerColorVariable(),s=n!=t;s&&(CommLink.commands.log(`Player color (e.g. board orientation) changed from ${t} to ${n}!`),resetCachedValues(),matchFirstSuggestionGiven=!1,CommLink.commands.log(`Turn updated to ${n}!`)),boardUtils.removeMarkings(),CommLink.commands.updateBoardFen(o),lastMoveRequestTime=Date.now(),lastPieceAmount=e,s&&CommLink.commands.calculateBestMoves(o)}}function observeNewMoves(){new MutationObserver((e=>{if(isMutationNewMove(e)){false;try{"chess.org"===domain||"chessarena.com"===domain?setTimeout((()=>onNewMove(e)),250):onNewMove(e)}catch(e){false}}})).observe(chessBoardElem,{childList:!0,subtree:!0,attributes:!0})}async function updatePlayerColor(){const e=getBoardOrientation();(lastBoardOrientation!==e||BoardDrawer&&BoardDrawer?.orientation!==e)&&(lastBoardOrientation=e,instanceVars.playerColor.set(commLinkInstanceID,e),boardUtils.setBoardOrientation(e),await CommLink.commands.updateBoardOrientation(e))}async function isAcasBackendReady(){return!!await CommLink.commands.ping()}async function start(){await CommLink.commands.createInstance(commLinkInstanceID);const e=window.location.pathname,t="chess.com"===domain&&e?.includes("/variants"),o="app.edchess.io"===domain,n=getBoardOrientation();instanceVars.playerColor.set(commLinkInstanceID,n),instanceVars.fen.set(commLinkInstanceID,getFen()),isBoardDrawerNeeded()&&(BoardDrawer=new UniversalBoardDrawer(chessBoardElem,{window:window,boardDimensions:getBoardDimensions(),playerColor:getPlayerColorVariable(),zIndex:"chessarena.com"===domain?9999:500,prepend:!0,debugMode:false,adjustSizeByDimensions:!!t,adjustSizeConfig:{noLeftAdjustment:!0},ignoreBodyRectLeft:o})),await updatePlayerColor(),observeNewMoves(),CommLink.setIntervalAsync((async()=>{await CommLink.commands.createInstance(commLinkInstanceID)}),1e3)}function startWhenBackendReady(){let e=0;const t=CommLink.setIntervalAsync((async()=>{await isAcasBackendReady()?(start(),t.stop()):e<1&&(e++,GM_openInTab(getCurrentBackendURL(),!0))}),1e3)}function initializeIfSiteReady(){const e=getBoardElem(),t=getPieceElem(),o=e&&t,n="chess.com"===domain&&e?.className.includes("webgl-2d");(o||n)&&chessBoardElem!=e&&(chessBoardElem=e,chessBoardElem.addEventListener("mousedown",(()=>{isUserMouseDown=!0})),chessBoardElem.addEventListener("mouseup",(()=>{isUserMouseDown=!1})),chessBoardElem.addEventListener("touchstart",(()=>{isUserMouseDown=!0})),chessBoardElem.addEventListener("touchend",(()=>{isUserMouseDown=!1})),blacklistedURLs.includes(window.location.href)||startWhenBackendReady())}addSupportedChessSite("chess.com",{boardElem:e=>{const t=e.pathname;return t?.includes("/variants")?document.querySelector(".TheBoard-layers"):document.querySelector("#board-layout-chessboard > .board")},pieceElem:e=>{const t=e.pathname,o=e.getAll;if(t?.includes("/variants")){const e=filterInvisibleElems(document.querySelectorAll(".TheBoard-layers *[data-piece]")).filter((e=>"x"!==e?.dataset?.piece?.toLowerCase()));return o?e:e[0]}return e.boardQuerySelector(".piece")},squareElems:e=>{const t=e.pathname,o=e.element;if(t?.includes("/variants"))return[...o.querySelectorAll(".square")]},chessVariant:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=t.match(/variants\/([^\/]*)/)?.[1].replaceAll("-chess","").replaceAll("-","");return{"doubles-bughouse":"bughouse","paradigm-chess30":"paradigm"}[e]||e}},boardOrientation:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=document.querySelector(".playerbox-bottom [data-player]")?.dataset?.player;return e?"0"===e?"w":"b":"w"}const o=getBoardElem();return o?.classList.contains("flipped")?"b":"w"},pieceElemFen:e=>{const t=e.pathname,o=e.pieceElem;let n=null,s=null;if(t?.includes("/variants")){chesscomVariantPlayerColorsTable||updateChesscomVariantPlayerColorsTable();n=chesscomVariantPlayerColorsTable?.[o?.dataset?.color],s=o?.dataset?.piece,s?.length>1&&(s=s[0])}else{const e=[...o.classList].find((e=>e.match(/^(b|w)[prnbqk]{1}$/)));[n,s]=e.split("")}return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pathname,o=e.pieceElem;if(t?.includes("/variants")){return getElemCoordinatesFromTransform(o)}return o.classList.toString()?.match(/square-(\d)(\d)/)?.slice(1)?.map((e=>Number(e)-1))},boardDimensions:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=document.querySelector(".TheBoard-squares");let t=0,o=0;return[...e.childNodes].forEach(((e,n)=>{const s=filterInvisibleElems([...e.childNodes]);s?.length>0&&(t+=1,s.length>o&&(o=s.length))})),[t,o]}return[8,8]},isMutationNewMove:e=>{const t=e.pathname,o=e.mutationArr;if(t?.includes("/variants"))return!!o.find((e=>"childList"===e.type));if(1==o.length)return!1;const n=!!o.find((e=>e?.target?.classList?.contains("hover-square"))),s=!!o.find((e=>e?.target?.classList?.contains("highlight"))),a=!!o.find((e=>e?.target?.classList?.contains("element-pool"))),i=!!o.filter((e=>e?.target?.classList?.contains("highlight"))).map((e=>e?.target?.style?.["background-color"])).find((e=>"rgb(244, 42, 50)"===e));return(o.length>=4&&!n||o.length>=7||s||a)&&!i}}),addSupportedChessSite("lichess.org",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>{const t=document.querySelector(".variant-link");if(t){let e=t?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check"}[e]||e}},boardOrientation:e=>{const t=document.querySelector("coords.files");return t?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("playstrategy.org",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector('piece[class*="-piece"]:not(.ghost)'),chessVariant:e=>{const t=document.querySelector(".variant-link");if(t){let e=t?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check","five-check":"5check","no-castling":"nocastle"}[e]||e}},boardOrientation:e=>{const t=document.querySelector(".cg-wrap");return t.classList?.contains("orientation-p1")?"w":"b"},pieceElemFen:e=>{const t=e.pieceElem,o=getPlayerColorVariable(),n=t?.classList?.contains("ally")?o:"w"==o?"b":"w";let s=null;if([...t?.classList]?.forEach((e=>{if(e?.includes("-piece")){const t=e?.split("-piece")?.[0];t&&1===t?.length&&(s=t)}})),n&&s)return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>getBoardDimensionsFromSize(),isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("pychess.org",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector('piece[class*="-piece"]:not(.ghost)'),chessVariant:e=>{const t=document.querySelector("#main-wrap .tc .user-link");if(t){let e=t?.innerText?.toLowerCase()?.replaceAll(" ","")?.replaceAll("-","");return{correspondence:"chess",koth:"kingofthehill",nocastling:"nocastle","gorogoro+":"gorogoro",oukchaktrang:"cambodian"}[e]||e}},boardOrientation:e=>{const t=document.querySelector(".cg-wrap");return t.classList?.contains("orientation-black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=getPlayerColorVariable(),n=t?.classList?.contains("ally")?o:"w"==o?"b":"w";let s=null;if([...t?.classList]?.forEach((e=>{if(e?.includes("-piece")){const t=e?.split("-piece")?.[0];t&&1===t?.length&&(s=t)}})),n&&s)return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>getBoardDimensionsFromSize(),isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("chess.org",{boardElem:e=>document.querySelector(".cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>{const t=unsafeWindow?.GameConfig?.instance?.variant,o=GameConfig?.VARIANT_NAMES?.[t]?.toLowerCase();if(o){return{standard:"chess"}[o]||o}},boardOrientation:e=>{const t=document.querySelector("coords.files");return t?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>getElemCoordinatesFromTransform(e.pieceElem),boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&(!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move"))))}}),addSupportedChessSite("chess.coolmathgames.com",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>"chess",boardOrientation:e=>{getBoardElem();return document.querySelector(".ranks.black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&(!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move"))))}}),addSupportedChessSite("papergames.io",{boardElem:e=>document.querySelector(".cm-chessboard"),pieceElem:e=>e.boardQuerySelector("*[data-piece][data-square]"),chessVariant:e=>"chess",boardOrientation:e=>{const t=getBoardElem();if(t){const e=[...t.querySelector(".coordinates").childNodes]?.[0].textContent;return"h"==e?"b":"w"}},pieceElemFen:e=>{const t=e.pieceElem;return convertPieceStrToFen(t?.dataset?.piece)},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.dataset?.square;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=12}),addSupportedChessSite("vole.wtf",{boardElem:e=>document.querySelector("#board"),pieceElem:e=>e.boardQuerySelector('*[data-t][data-l][data-p]:not([data-p="0"]'),chessVariant:e=>"chess",boardOrientation:e=>"w",pieceElemFen:e=>{const t=e.pieceElem,o=Number(t?.dataset?.p),n="pknbrq";return o>8?n[o-9].toUpperCase():n[o-1]},pieceElemCoords:e=>{const t=e.pieceElem;return[Number(t?.dataset?.l),7-Number(t?.dataset?.t)]},boardDimensions:e=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=12}),addSupportedChessSite("immortal.game",{boardElem:e=>document.querySelector("div.pawn.relative, div.knight.relative, div.bishop.relative, div.rook.relative, div.queen.relative, div.king.relative")?.parentElement?.parentElement,pieceElem:e=>e.boardQuerySelector("div.pawn.relative, div.knight.relative, div.bishop.relative, div.rook.relative, div.queen.relative, div.king.relative"),chessVariant:e=>"chess",boardOrientation:e=>{const t=[...document.querySelectorAll("svg text[x]")].find((e=>"a"==e?.textContent));return(Number(t?.getAttribute("x"))||10)<15?"w":"b"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"===o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem;return getElemCoordinatesFromTransform(t?.parentElement)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&t.length>=5}}),addSupportedChessSite("chessarena.com",{boardElem:e=>document.querySelector('*[data-component="GameLayoutBoard"] cg-board'),pieceElem:e=>e.boardQuerySelector('cg-piece:not(*[style*="visibility: hidden;"])'),chessVariant:e=>"chess",boardOrientation:e=>{const t=document.querySelector("cg-titles");return t?.classList?.contains("rotated")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.className?.[0],n=t?.className?.[1];if(o&&n){const e=n;return"w"===o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>getElemCoordinatesFromTransform(e.pieceElem,{onlyFlipY:!0}),boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&!!t.find((e=>"style"===e?.attributeName))}}),addSupportedChessSite("chess.net",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>{const t=document.querySelector(".variant-link");if(t){let e=t?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check"}[e]||e}},boardOrientation:e=>{const t=document.querySelector("coords.files");return t?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("freechess.club",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>"chess",boardOrientation:e=>{const t=document.querySelector("coords.files");return t?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("play.chessclub.com",{boardElem:e=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:e=>"chess",boardOrientation:e=>{const t=document.querySelector("coords.files");return t?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find((e=>Object.keys(pieceNameToFen).includes(e)));if(o&&n){const e=pieceNameToFen[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return chessCoordinatesToIndex(o)},boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find((e=>"childList"===e.type)))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("gameknot.com",{boardElem:e=>document.querySelector("#chess-board-acboard"),pieceElem:e=>e.boardQuerySelector('*[class*="chess-board-piece"] > img[src*="chess56."][style*="visible"]'),chessVariant:e=>"chess",boardOrientation:e=>document.querySelector("#chess-board-my-side-color .player_white")?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,o=Number(t.style.left.replace("px","")),n="kqrnbp"[-1*Number(t.style.top.replace("px",""))/60];return"w"===(o>=0?"w":"b")?n.toUpperCase():n.toLowerCase()},pieceElemCoords:e=>getElemCoordinatesFromLeftTopPixels(e.pieceElem.parentElement),boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!t.find((e=>"childList"===e.type))||!!t.find((e=>e?.target?.classList?.contains("last-move")))}}),addSupportedChessSite("chesstempo.com",{boardElem:e=>document.querySelector(".ct-board-squares"),pieceElem:e=>e.boardQuerySelector('*[class*="ct-pieceClass"][class*="ct-piece-"]'),chessVariant:e=>"chess",boardOrientation:e=>"a"===document.querySelector(".ct-coord-column").innerText?"w":"b",pieceElemFen:e=>{const t=[...e.pieceElem.classList].find((e=>e?.includes("ct-piece-"))),o=t?.split("ct-piece-")?.pop(),n=o.startsWith("white")?"w":"b",s=o.substring(5),a=pieceNameToFen[s];return"w"===n?a.toUpperCase():a.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return[t?.ct?.piece?.piece?.column,t?.ct?.piece?.piece?.row]},boardDimensions:e=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=4}),addSupportedChessSite("redhotpawn.com",{boardElem:e=>document.querySelector("#board-0_1"),pieceElem:e=>e.boardQuerySelector('li.piece[id*="-pc-"]'),chessVariant:e=>"chess",boardOrientation:e=>Number([...document.querySelectorAll(".boardCoordinate")].find((e=>"a"===e?.innerText))?.style?.left?.replace("px",""))<200?"w":"b",pieceElemFen:e=>{const t=e.pieceElem;return(t?.id?.match(/-pc-(.*?)-/)||[])[1]},pieceElemCoords:e=>getElemCoordinatesFromLeftTopPixels(e.pieceElem),boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&t.length>=4}}),addSupportedChessSite("simplechess.com",{boardElem:e=>document.querySelector("#chessboard"),pieceElem:e=>{const t=e.getAll,o=[...document.querySelectorAll("canvas.canvas_piece")].filter((e=>canvasHasPixelAt(e,[.5,.5])));return t?o:o[0]},chessVariant:e=>"chess",boardOrientation:e=>"8"===document.querySelector("#chessboard_coordy0")?.innerText?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,o=[{name:"k",coords:[52/60,26/60]},{name:"q",coords:[8/60,16/60]},{name:"n",coords:[.85,.7]},{name:"b",coords:[.15,50/60]},{name:"r",coords:[.75,.25]},{name:"p",coords:[.5,.5]}],n={k:[.7,.45],q:[.5,50/60],n:[38/60,41/60],b:[.5,20/60]};let s=null;for(e of o){if(canvasHasPixelAt(t,e.coords)){s=e.name;break}}if(s){return"w"===getCanvasPixelColor(t,n[s]||[.5,.5])?s.toUpperCase():s.toLowerCase()}},pieceElemCoords:e=>getElemCoordinatesFromLeftTopPixels(e.pieceElem),boardDimensions:e=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!isUserMouseDown&&t.length>=7}}),addSupportedChessSite("chessworld.net",{boardElem:e=>document.querySelector("#ChessWorldChessBoard"),pieceElem:e=>e.boardQuerySelector('img[src*="merida"'),chessVariant:e=>"chess",boardOrientation:e=>document.querySelector('div[style*="boardb.jpg"]')?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,[o,n]=t?.src?.split("/")?.pop()?.replace(".png","")?.split("_"),s=pieceNameToFen[n];return"w"===("white"===o?"w":"b")?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return chessCoordinatesToIndex(t?.id)},boardDimensions:e=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=2}),addSupportedChessSite("app.edchess.io",{boardElem:e=>document.querySelector('*[data-boardid="chessboard"]'),pieceElem:e=>e.boardQuerySelector("*[data-piece]"),chessVariant:e=>"chess",boardOrientation:e=>"h1"==document.querySelector("*[data-square]")?.dataset?.square?"b":"w",pieceElemFen:e=>{const t=e.pieceElem,[o,n]=t?.dataset?.piece?.split("");return"w"===o?n.toUpperCase():n.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return chessCoordinatesToIndex(t?.parentElement?.parentElement?.dataset?.square)},boardDimensions:e=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=2}),"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("[u] Open GreasyFork Page",(e=>{GM_openInTab(greasyforkURL,!0)}),"u"),GM_registerMenuCommand("[o] Open GUI Manually",(e=>{GM_openInTab(getCurrentBackendURL(),!0)}),"o"),GM_registerMenuCommand("[s] Start Manually",(e=>{chessBoardElem?start():displayImportantNotification("Failed to start manually","No chessboard element found!")}),"s"),GM_registerMenuCommand("[g] Get Moves Manually",(e=>{chessBoardElem?onNewMove(null,!0):displayImportantNotification("Failed to get moves","No chessboard element found!")}),"g"),GM_registerMenuCommand("[r] Render BoardDrawer Manually",(e=>{"function"==typeof BoardDrawer?.updateDimensions?BoardDrawer.updateDimensions():displayImportantNotification("Failed to render BoardDrawer","BoardDrawer not initialized or something else went wrong!")}),"r"),"function"==typeof GM_setClipboard&&GM_registerMenuCommand("[c] Copy FEN to Clipboard",(e=>{chessBoardElem?GM_setClipboard(getFen()):displayImportantNotification("Failed to get FEN","No chessboard element found!")}),"c")),setInterval(initializeIfSiteReady,1e3);